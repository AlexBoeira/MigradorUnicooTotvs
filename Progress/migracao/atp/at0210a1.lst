        1   /********************************************************************************
        2   ** Copyright DATASUL S.A. (1997)
        3   ** Todos os Direitos Reservados.
        4   **
        5   ** Este fonte e de propriedade exclusiva da DATASUL, sua reproducao
        6   ** parcial ou total por qualquer meio, so podera ser feita mediante
        7   ** autorizacao expressa.
        8   *******************************************************************************/
        9   *** Encrypted Source ***
       10   *** Encrypted Source ***
       11   *** Encrypted Source ***
       12   *** Encrypted Source ***
       13   *** Encrypted Source ***
       14   *** Encrypted Source ***
       15   *** Encrypted Source ***
       16   *** Encrypted Source ***
       17   *** Encrypted Source ***
       18   *** Encrypted Source ***
       19   *** Encrypted Source ***
       20   *** Encrypted Source ***
       21   *** Encrypted Source ***
       22   *** Encrypted Source ***
       23   *** Encrypted Source ***
       24   *** Encrypted Source ***
       25   *** Encrypted Source ***
       26   *** Encrypted Source ***
       27   *** Encrypted Source ***
       28   *** Encrypted Source ***
       29   *** Encrypted Source ***
       30   *** Encrypted Source ***
       31   *** Encrypted Source ***
       32   *** Encrypted Source ***
       33   *** Encrypted Source ***
       34   *** Encrypted Source ***
       35   *** Encrypted Source ***
       36   *** Encrypted Source ***
       37   *** Encrypted Source ***
       38   *** Encrypted Source ***
       39   *** Encrypted Source ***
       40   *** Encrypted Source ***
       41   *** Encrypted Source ***
       42   *** Encrypted Source ***
       43   *** Encrypted Source ***
       44   *** Encrypted Source ***
       45   *** Encrypted Source ***
       46   *** Encrypted Source ***
       47   *** Encrypted Source ***
       48   *** Encrypted Source ***
       49   *** Encrypted Source ***
       50   *** Encrypted Source ***
       51   *** Encrypted Source ***
       52   *** Encrypted Source ***
       53   *** Encrypted Source ***
       54   *** Encrypted Source ***
       55   *** Encrypted Source ***
       56   *** Encrypted Source ***
       57   *** Encrypted Source ***
       58   *** Encrypted Source ***
       59   *** Encrypted Source ***
       60   *** Encrypted Source ***
       61   *** Encrypted Source ***
       62   *** Encrypted Source ***
       63   *** Encrypted Source ***
       64   *** Encrypted Source ***
       65   *** Encrypted Source ***
       66   *** Encrypted Source ***
       67   *** Encrypted Source ***
       68   *** Encrypted Source ***
       69   *** Encrypted Source ***
       70   *** Encrypted Source ***
       71   *** Encrypted Source ***
       72   *** Encrypted Source ***
       73   *** Encrypted Source ***
       74   *** Encrypted Source ***
       75   *** Encrypted Source ***
       76   *** Encrypted Source ***
       77   *** Encrypted Source ***
       78   *** Encrypted Source ***
       79   *** Encrypted Source ***
       80   *** Encrypted Source ***
       81   *** Encrypted Source ***
       82   *** Encrypted Source ***
       83   *** Encrypted Source ***
       84   *** Encrypted Source ***
       85   *** Encrypted Source ***
       86   *** Encrypted Source ***
       87   *** Encrypted Source ***
       88   *** Encrypted Source ***
       89   *** Encrypted Source ***
       90   *** Encrypted Source ***
       91   *** Encrypted Source ***
       92   *** Encrypted Source ***
       93   *** Encrypted Source ***
       94   *** Encrypted Source ***
       95   *** Encrypted Source ***
       96   *** Encrypted Source ***
       97   *** Encrypted Source ***
       98   *** Encrypted Source ***
       99   *** Encrypted Source ***
      100   *** Encrypted Source ***
      101   *** Encrypted Source ***
      102   *** Encrypted Source ***
      103   *** Encrypted Source ***
      104   *** Encrypted Source ***
      105   *** Encrypted Source ***
      106   *** Encrypted Source ***
      107   *** Encrypted Source ***
      108   *** Encrypted Source ***
      109   *** Encrypted Source ***
      110   *** Encrypted Source ***
      111   *** Encrypted Source ***
      112   *** Encrypted Source ***
      113   *** Encrypted Source ***
      114   *** Encrypted Source ***
      115   *** Encrypted Source ***
      116   *** Encrypted Source ***
      117   *** Encrypted Source ***
      118   *** Encrypted Source ***
      119   *** Encrypted Source ***
      120   *** Encrypted Source ***
      121   *** Encrypted Source ***
      122   *** Encrypted Source ***
      123   *** Encrypted Source ***
      124   *** Encrypted Source ***
      125   *** Encrypted Source ***
      126   *** Encrypted Source ***
      127   *** Encrypted Source ***
      128   *** Encrypted Source ***
      129   *** Encrypted Source ***
      130   *** Encrypted Source ***
      131   *** Encrypted Source ***
      132   *** Encrypted Source ***
      133   *** Encrypted Source ***
      134   *** Encrypted Source ***
      135   *** Encrypted Source ***
      136   *** Encrypted Source ***
      137   *** Encrypted Source ***
      138   *** Encrypted Source ***
      139   *** Encrypted Source ***
      140   *** Encrypted Source ***
      141   *** Encrypted Source ***
      142   *** Encrypted Source ***
      143   *** Encrypted Source ***
      144   *** Encrypted Source ***
      145   *** Encrypted Source ***
      146   *** Encrypted Source ***
      147   *** Encrypted Source ***
      148   *** Encrypted Source ***
      149   *** Encrypted Source ***
      150   *** Encrypted Source ***
      151   *** Encrypted Source ***
      152   *** Encrypted Source ***
      153   *** Encrypted Source ***
      154   *** Encrypted Source ***
      155   *** Encrypted Source ***
      156   *** Encrypted Source ***
      157   *** Encrypted Source ***
      158   *** Encrypted Source ***
      159   *** Encrypted Source ***
      160   *** Encrypted Source ***
      161   *** Encrypted Source ***
      162   *** Encrypted Source ***
      163   *** Encrypted Source ***
      164   *** Encrypted Source ***
      165   *** Encrypted Source ***
      166   *** Encrypted Source ***
      167   *** Encrypted Source ***
      168   *** Encrypted Source ***
      169   *** Encrypted Source ***
      170   *** Encrypted Source ***
      171   *** Encrypted Source ***
      172   *** Encrypted Source ***
      173   *** Encrypted Source ***
      174     /*** 010000 ***/ 
      175   
      176   &IF "" >= "1.00" &THEN
      177   
      178   &ENDIF
      179   
      180   /******************************************************************************
      181       Programa .....: AT0210A1.p
      182       Data .........: 18/05/2015
      183       Empresa ......: TOTVS
      184       Programador ..: Jeferson Dal Molin
      185       Objetivo .....: Migracao das guias de autorizacao do Unicoo para o GPS
      186   *-----------------------------------------------------------------------------*/
      187   
      188   def input param in-batch-online-par          AS CHAR NO-UNDO.
      189   DEF INPUT PARAM in-status-monitorar-par      AS CHAR NO-UNDO.
      190       
      191   hide all no-pause.
      192   
      193   *** Encrypted Source ***
      194   *** Encrypted Source ***
      195   *** Encrypted Source ***
      196   *** Encrypted Source ***
      197   *** Encrypted Source ***
      198   *** Encrypted Source ***
      199   *** Encrypted Source ***
      200   *** Encrypted Source ***
      201   *** Encrypted Source ***
      202   *** Encrypted Source ***
      203   *** Encrypted Source ***
      204   *** Encrypted Source ***
      205   *** Encrypted Source ***
      206   *** Encrypted Source ***
      207   *** Encrypted Source ***
      208   *** Encrypted Source ***
      209   *** Encrypted Source ***
      210   *** Encrypted Source ***
      211   *** Encrypted Source ***
      212   *** Encrypted Source ***
      213   *** Encrypted Source ***
      214   *** Encrypted Source ***
      215   *** Encrypted Source ***
      216   *** Encrypted Source ***
      217   *** Encrypted Source ***
      218   *** Encrypted Source ***
      219   *** Encrypted Source ***
      220   *** Encrypted Source ***
      221   *** Encrypted Source ***
      222   *** Encrypted Source ***
      223   *** Encrypted Source ***
      224   *** Encrypted Source ***
      225   *** Encrypted Source ***
      226   *** Encrypted Source ***
      227   *** Encrypted Source ***
      228   *** Encrypted Source ***
      229   *** Encrypted Source ***
      230   *** Encrypted Source ***
      231   *** Encrypted Source ***
      232   *** Encrypted Source ***
      233   *** Encrypted Source ***
      234   *** Encrypted Source ***
      235   *** Encrypted Source ***
      236   *** Encrypted Source ***
      237   *** Encrypted Source ***
      238   *** Encrypted Source ***
      239   *** Encrypted Source ***
      240   *** Encrypted Source ***
      241   *** Encrypted Source ***
      242   *** Encrypted Source ***
      243   *** Encrypted Source ***
      244   *** Encrypted Source ***
      245   *** Encrypted Source ***
      246   *** Encrypted Source ***
      247   *** Encrypted Source ***
      248   *** Encrypted Source ***
      249   *** Encrypted Source ***
      250   *** Encrypted Source ***
      251   *** Encrypted Source ***
      252   *** Encrypted Source ***
      253   *** Encrypted Source ***
      254   *** Encrypted Source ***
      255   *** Encrypted Source ***
      256   *** Encrypted Source ***
      257   *** Encrypted Source ***
      258   *** Encrypted Source ***
      259   *** Encrypted Source ***
      260   *** Encrypted Source ***
      261   *** Encrypted Source ***
      262   *** Encrypted Source ***
      263   *** Encrypted Source ***
      264   *** Encrypted Source ***
      265   *** Encrypted Source ***
      266   *** Encrypted Source ***
      267   *** Encrypted Source ***
      268   *** Encrypted Source ***
      269   *** Encrypted Source ***
      270   *** Encrypted Source ***
      271   *** Encrypted Source ***
      272   *** Encrypted Source ***
      273   *** Encrypted Source ***
      274   *** Encrypted Source ***
      275   *** Encrypted Source ***
      276   *** Encrypted Source ***
      277   *** Encrypted Source ***
      278   *** Encrypted Source ***
      279   *** Encrypted Source ***
      280   *** Encrypted Source ***
      281   *** Encrypted Source ***
      282   *** Encrypted Source ***
      283   *** Encrypted Source ***
      284   *** Encrypted Source ***
      285   *** Encrypted Source ***
      286   *** Encrypted Source ***
      287   *** Encrypted Source ***
      288   *** Encrypted Source ***
      289   *** Encrypted Source ***
      290   *** Encrypted Source ***
      291   *** Encrypted Source ***
      292   *** Encrypted Source ***
      293   *** Encrypted Source ***
      294   *** Encrypted Source ***
      295   *** Encrypted Source ***
      296   *** Encrypted Source ***
      297   *** Encrypted Source ***
      298   *** Encrypted Source ***
      299   *** Encrypted Source ***
      300   *** Encrypted Source ***
      301   *** Encrypted Source ***
      302   *** Encrypted Source ***
      303   *** Encrypted Source ***
      304   *** Encrypted Source ***
      305   *** Encrypted Source ***
      306   *** Encrypted Source ***
      307   *** Encrypted Source ***
      308   *** Encrypted Source ***
      309   *** Encrypted Source ***
      310   *** Encrypted Source ***
      311   *** Encrypted Source ***
      312   *** Encrypted Source ***
      313   *** Encrypted Source ***
      314   *** Encrypted Source ***
      315   *** Encrypted Source ***
      316   *** Encrypted Source ***
      317   *** Encrypted Source ***
      318   *** Encrypted Source ***
      319   *** Encrypted Source ***
      320   *** Encrypted Source ***
      321   *** Encrypted Source ***
      322   *** Encrypted Source ***
      323   *** Encrypted Source ***
      324   *** Encrypted Source ***
      325   *** Encrypted Source ***
      326   *** Encrypted Source ***
      327   *** Encrypted Source ***
      328   *** Encrypted Source ***
      329   *** Encrypted Source ***
      330   *** Encrypted Source ***
      331   *** Encrypted Source ***
      332   *** Encrypted Source ***
      333   *** Encrypted Source ***
      334   *** Encrypted Source ***
      335   *** Encrypted Source ***
      336   *** Encrypted Source ***
      337   *** Encrypted Source ***
      338   *** Encrypted Source ***
      339   *** Encrypted Source ***
      340   *** Encrypted Source ***
      341   *** Encrypted Source ***
      342   *** Encrypted Source ***
      343   *** Encrypted Source ***
      344   *** Encrypted Source ***
      345   *** Encrypted Source ***
      346   *** Encrypted Source ***
      347   *** Encrypted Source ***
      348   *** Encrypted Source ***
      349   *** Encrypted Source ***
      350   *** Encrypted Source ***
      351   *** Encrypted Source ***
      352   *** Encrypted Source ***
      353   *** Encrypted Source ***
      354   *** Encrypted Source ***
      355   *** Encrypted Source ***
      356   *** Encrypted Source ***
      357   *** Encrypted Source ***
      358   *** Encrypted Source ***
      359   *** Encrypted Source ***
      360   *** Encrypted Source ***
      361   *** Encrypted Source ***
      362   *** Encrypted Source ***
      363   *** Encrypted Source ***
      364   *** Encrypted Source ***
      365   *** Encrypted Source ***
      366   *** Encrypted Source ***
      367   *** Encrypted Source ***
      368   *** Encrypted Source ***
      369   *** Encrypted Source ***
      370   *** Encrypted Source ***
      371   *** Encrypted Source ***
      372   *** Encrypted Source ***
      373   *** Encrypted Source ***
      374   *** Encrypted Source ***
      375   *** Encrypted Source ***
      376   *** Encrypted Source ***
      377   *** Encrypted Source ***
      378   *** Encrypted Source ***
      379   *** Encrypted Source ***
      380   *** Encrypted Source ***
      381   *** Encrypted Source ***
      382   *** Encrypted Source ***
      383   *** Encrypted Source ***
      384   *** Encrypted Source ***
      385   *** Encrypted Source ***
      386   *** Encrypted Source ***
      387   *** Encrypted Source ***
      388   *** Encrypted Source ***
      389   *** Encrypted Source ***
      390   *** Encrypted Source ***
      391   *** Encrypted Source ***
      392   *** Encrypted Source ***
      393   *** Encrypted Source ***
      394   *** Encrypted Source ***
      395   *** Encrypted Source ***
      396   *** Encrypted Source ***
      397   *** Encrypted Source ***
      398   *** Encrypted Source ***
      399   *** Encrypted Source ***
      400   *** Encrypted Source ***
      401   *** Encrypted Source ***
      402   *** Encrypted Source ***
      403   *** Encrypted Source ***
      404   *** Encrypted Source ***
      405   *** Encrypted Source ***
      406   *** Encrypted Source ***
      407   *** Encrypted Source ***
      408   *** Encrypted Source ***
      409   *** Encrypted Source ***
      410   *** Encrypted Source ***
      411   *** Encrypted Source ***
      412   *** Encrypted Source ***
      413   *** Encrypted Source ***
      414   *** Encrypted Source ***
      415   *** Encrypted Source ***
      416   *** Encrypted Source ***
      417   *** Encrypted Source ***
      418   *** Encrypted Source ***
      419   *** Encrypted Source ***
      420   *** Encrypted Source ***
      421   *** Encrypted Source ***
      422   *** Encrypted Source ***
      423   *** Encrypted Source ***
      424   *** Encrypted Source ***
      425   *** Encrypted Source ***
      426   *** Encrypted Source ***
      427   *** Encrypted Source ***
      428   *** Encrypted Source ***
      429   *** Encrypted Source ***
      430   *** Encrypted Source ***
      431   *** Encrypted Source ***
      432   *** Encrypted Source ***
      433   *** Encrypted Source ***
      434   *** Encrypted Source ***
      435   *** Encrypted Source ***
      436   *** Encrypted Source ***
      437   *** Encrypted Source ***
      438   *** Encrypted Source ***
      439   *** Encrypted Source ***
      440   *** Encrypted Source ***
      441   *** Encrypted Source ***
      442   *** Encrypted Source ***
      443   *** Encrypted Source ***
      444   *** Encrypted Source ***
      445   *** Encrypted Source ***
      446   *** Encrypted Source ***
      447   *** Encrypted Source ***
      448   *** Encrypted Source ***
      449   *** Encrypted Source ***
      450   *** Encrypted Source ***
      451   *** Encrypted Source ***
      452   *** Encrypted Source ***
      453   *** Encrypted Source ***
      454   *** Encrypted Source ***
      455   *** Encrypted Source ***
      456   *** Encrypted Source ***
      457   *** Encrypted Source ***
      458   *** Encrypted Source ***
      459   *** Encrypted Source ***
      460   *** Encrypted Source ***
      461   *** Encrypted Source ***
      462   *** Encrypted Source ***
      463   *** Encrypted Source ***
      464   *** Encrypted Source ***
      465   *** Encrypted Source ***
      466   *** Encrypted Source ***
      467   *** Encrypted Source ***
      468   *** Encrypted Source ***
      469   *** Encrypted Source ***
      470   *** Encrypted Source ***
      471   *** Encrypted Source ***
      472   *** Encrypted Source ***
      473   *** Encrypted Source ***
      474   *** Encrypted Source ***
      475   *** Encrypted Source ***
      476   *** Encrypted Source ***
      477   *** Encrypted Source ***
      478   *** Encrypted Source ***
      479   *** Encrypted Source ***
      480   *** Encrypted Source ***
      481   *** Encrypted Source ***
      482   *** Encrypted Source ***
      483   *** Encrypted Source ***
      484   *** Encrypted Source ***
      485   *** Encrypted Source ***
      486   *** Encrypted Source ***
      487   *** Encrypted Source ***
      488   *** Encrypted Source ***
      489   *** Encrypted Source ***
      490   *** Encrypted Source ***
      491   *** Encrypted Source ***
      492   *** Encrypted Source ***
      493   *** Encrypted Source ***
      494   *** Encrypted Source ***
      495   *** Encrypted Source ***
      496   *** Encrypted Source ***
      497   *** Encrypted Source ***
      498   *** Encrypted Source ***
      499   *** Encrypted Source ***
      500   *** Encrypted Source ***
      501   *** Encrypted Source ***
      502   *** Encrypted Source ***
      503   *** Encrypted Source ***
      504   *** Encrypted Source ***
      505   *** Encrypted Source ***
      506   *** Encrypted Source ***
      507   *** Encrypted Source ***
      508   *** Encrypted Source ***
      509   *** Encrypted Source ***
      510   *** Encrypted Source ***
      511   *** Encrypted Source ***
      512   *** Encrypted Source ***
      513   *** Encrypted Source ***
      514   *** Encrypted Source ***
      515   *** Encrypted Source ***
      516   *** Encrypted Source ***
      517   *** Encrypted Source ***
      518   *** Encrypted Source ***
      519   *** Encrypted Source ***
      520   *** Encrypted Source ***
      521   *** Encrypted Source ***
      522   *** Encrypted Source ***
      523   *** Encrypted Source ***
      524   *** Encrypted Source ***
      525   *** Encrypted Source ***
      526   *** Encrypted Source ***
      527   *** Encrypted Source ***
      528   *** Encrypted Source ***
      529   *** Encrypted Source ***
      530   *** Encrypted Source ***
      531   *** Encrypted Source ***
      532   *** Encrypted Source ***
      533   *** Encrypted Source ***
      534   *** Encrypted Source ***
      535   *** Encrypted Source ***
      536   *** Encrypted Source ***
      537   *** Encrypted Source ***
      538   *** Encrypted Source ***
      539   *** Encrypted Source ***
      540   *** Encrypted Source ***
      541   *** Encrypted Source ***
      542   *** Encrypted Source ***
      543   *** Encrypted Source ***
      544   *** Encrypted Source ***
      545   *** Encrypted Source ***
      546   *** Encrypted Source ***
      547   *** Encrypted Source ***
      548   *** Encrypted Source ***
      549   *** Encrypted Source ***
      550   *** Encrypted Source ***
      551   *** Encrypted Source ***
      552   *** Encrypted Source ***
      553   *** Encrypted Source ***
      554   *** Encrypted Source ***
      555   *** Encrypted Source ***
      556   *** Encrypted Source ***
      557   *** Encrypted Source ***
      558   *** Encrypted Source ***
      559   *** Encrypted Source ***
      560   *** Encrypted Source ***
      561   *** Encrypted Source ***
      562   *** Encrypted Source ***
      563   *** Encrypted Source ***
      564   *** Encrypted Source ***
      565   *** Encrypted Source ***
      566   *** Encrypted Source ***
      567   *** Encrypted Source ***
      568   *** Encrypted Source ***
      569   *** Encrypted Source ***
      570   *** Encrypted Source ***
      571   *** Encrypted Source ***
      572   *** Encrypted Source ***
      573   *** Encrypted Source ***
      574   *** Encrypted Source ***
      575   *** Encrypted Source ***
      576   *** Encrypted Source ***
      577   *** Encrypted Source ***
      578   *** Encrypted Source ***
      579   *** Encrypted Source ***
      580   *** Encrypted Source ***
      581   *** Encrypted Source ***
      582   *** Encrypted Source ***
      583   *** Encrypted Source ***
      584   *** Encrypted Source ***
      585   *** Encrypted Source ***
      586   *** Encrypted Source ***
      587   *** Encrypted Source ***
      588   *** Encrypted Source ***
      589   *** Encrypted Source ***
      590   *** Encrypted Source ***
      591   *** Encrypted Source ***
      592   *** Encrypted Source ***
      593   *** Encrypted Source ***
      594   *** Encrypted Source ***
      595   *** Encrypted Source ***
      596   *** Encrypted Source ***
      597   *** Encrypted Source ***
      598   *** Encrypted Source ***
      599   *** Encrypted Source ***
      600   *** Encrypted Source ***
      601   *** Encrypted Source ***
      602   *** Encrypted Source ***
      603   *** Encrypted Source ***
      604   *** Encrypted Source ***
      605   *** Encrypted Source ***
      606   *** Encrypted Source ***
      607   *** Encrypted Source ***
      608   *** Encrypted Source ***
      609   *** Encrypted Source ***
      610   *** Encrypted Source ***
      611   *** Encrypted Source ***
      612   *** Encrypted Source ***
      613   *** Encrypted Source ***
      614   *** Encrypted Source ***
      615   *** Encrypted Source ***
      616   *** Encrypted Source ***
      617   *** Encrypted Source ***
      618   *** Encrypted Source ***
      619   *** Encrypted Source ***
      620   *** Encrypted Source ***
      621   *** Encrypted Source ***
      622   *** Encrypted Source ***
      623   *** Encrypted Source ***
      624   *** Encrypted Source ***
      625   *** Encrypted Source ***
      626   *** Encrypted Source ***
      627   *** Encrypted Source ***
      628   *** Encrypted Source ***
      629   *** Encrypted Source ***
      630   *** Encrypted Source ***
      631   *** Encrypted Source ***
      632   *** Encrypted Source ***
      633   *** Encrypted Source ***
      634   *** Encrypted Source ***
      635   *** Encrypted Source ***
      636   *** Encrypted Source ***
      637   *** Encrypted Source ***
      638   *** Encrypted Source ***
      639   *** Encrypted Source ***
      640   *** Encrypted Source ***
      641   *** Encrypted Source ***
      642   *** Encrypted Source ***
      643   *** Encrypted Source ***
      644   *** Encrypted Source ***
      645    
      646   *** Encrypted Source ***
      647   *** Encrypted Source ***
      648   *** Encrypted Source ***
      649   *** Encrypted Source ***
      650   *** Encrypted Source ***
      651   *** Encrypted Source ***
      652   *** Encrypted Source ***
      653   *** Encrypted Source ***
      654   *** Encrypted Source ***
      655   *** Encrypted Source ***
      656   *** Encrypted Source ***
      657   *** Encrypted Source ***
      658   *** Encrypted Source ***
      659   *** Encrypted Source ***
      660   *** Encrypted Source ***
      661   *** Encrypted Source ***
      662   *** Encrypted Source ***
      663     
      664   
      665   /*****************************************************************************
      666   *      Programa .....: hdregarquexe.f                                        *
      667   *      Data .........: 17 de Fevereiro de 2004                               *
      668   *      Autor ........: DZSET SOLUCOES E SISTEMAS LTDA.                       *
      669   *      Sistema ......: HDP includes padraes                                  *
      670   *      Programador ..: Andreia                                               *
      671   *      Objetivo .....: Definicao de frames da regua executa                  *
      672   *----------------------------------------------------------------------------*
      673   *      VERSAO    DATA        RESPONSAVEL    MOTIVO                           *
      674   *****************************************************************************/
      675   
      676   /* --------------------------------------------------- FRAMES PARA UNIX --- */
      677   form tb-arquexe[1] format "x(7)"
      678        tb-arquexe[2] format "x(7)"
      679        tb-arquexe[3] format "x(3)"
      680        with no-labels attr row 21 no-box overlay centered frame f-arquexe.
      681                   
      682   /* ----------------------------------------------- FRAMES PARA WINDOWS --- */                
      683   DEFINE FRAME f-regua-arquexe
      684        b-arquivo   at row 1.48 col 32
      685        b-executa   at row 1.48 col 36
      686        b-fim       at row 1.48 col 58
      687        b-help      at row 1.48 col 62
      688        Retangulo-1 at row 1    col 2
      689        with 1 down no-box keep-tab-order overlay centered
      690            side-labels no-underline three-d 
      691            at col 1 row 1
      692            size 80 by 3.
      693     
      694      
      695   *** Encrypted Source ***
      696   *** Encrypted Source ***
      697   *** Encrypted Source ***
      698   *** Encrypted Source ***
      699   *** Encrypted Source ***
      700   *** Encrypted Source ***
      701   *** Encrypted Source ***
      702   *** Encrypted Source ***
      703   *** Encrypted Source ***
      704   *** Encrypted Source ***
      705   *** Encrypted Source ***
      706   *** Encrypted Source ***
      707   *** Encrypted Source ***
      708   *** Encrypted Source ***
      709   *** Encrypted Source ***
      710   *** Encrypted Source ***
      711   *** Encrypted Source ***
      712   *** Encrypted Source ***
      713   *** Encrypted Source ***
      714   *** Encrypted Source ***
      715   *** Encrypted Source ***
      716   *** Encrypted Source ***
      717   *** Encrypted Source ***
      718   *** Encrypted Source ***
      719   *** Encrypted Source ***
      720   *** Encrypted Source ***
      721   *** Encrypted Source ***
      722   *** Encrypted Source ***
      723   *** Encrypted Source ***
      724   *** Encrypted Source ***
      725   *** Encrypted Source ***
      726   *** Encrypted Source ***
      727   *** Encrypted Source ***
      728   *** Encrypted Source ***
      729   *** Encrypted Source ***
      730   *** Encrypted Source ***
      731   *** Encrypted Source ***
      732   *** Encrypted Source ***
      733   *** Encrypted Source ***
      734   *** Encrypted Source ***
      735   *** Encrypted Source ***
      736   *** Encrypted Source ***
      737   *** Encrypted Source ***
      738   *** Encrypted Source ***
      739   *** Encrypted Source ***
      740   *** Encrypted Source ***
      741   *** Encrypted Source ***
      742   *** Encrypted Source ***
      743    
      744   
      745   
      746   /******************************************************************************
      747   *      Programa .....: hdsistem.i                                             *
      748   *      Data .........: 11 de Agosto de 2000                                   *
      749   *      Autor ........: DZSET SOLUCOES E SISTEMAS LTDA.                        *
      750   *      Sistema ......: hd - include padrao                                    *
      751   *      Programador ..: Airton Nora                                            *
      752   *      Objetivo .....: Definicao do pre processos                             *
      753   *-----------------------------------------------------------------------------*
      754   *      VERSAO    DATA        RESPONSAVEL    MOTIVO                            *
      755   *      D.00.000  11/08/2000  Nora           Desenvolvimento                   *
      756   *      E.00.000  16/04/2001  Nora           Conversao Ems504                  *
      757   ******************************************************************************/
      758   &global-define sistema ems505        /* magnus ou ems ou ems505 */ 
      759   &global-define tipo-banco oracle     /* normal ou oracle */
      760   &global-define banco-unificado nao   /* sim ou nao */      
      761   &global-define gp_version 200
      762   /* ------------------------------------------------------------------------- */
      763   
      764   
      765    
      766   
      767   def var lg-executa-aux              as log   format "Sim/Nao"              no-undo.
      768   def var nr-reg-aux                  as dec                                 no-undo.
      769   def var lg-erro-aux                 as log                                 no-undo.
      770   def var ds-sit-ini-aux              as char                                no-undo.
      771   def var ix                          as int                                 no-undo.
      772   def var cd-esp-amb-aux              as int                                 no-undo.
      773   def var cd-grupo-proc-amb-aux       as int                                 no-undo.
      774   def var cd-procedimento-aux         as int                                 no-undo.
      775   def var dv-procedimento-aux         as int                                 no-undo.
      776   def var cd-modalidade-aux           like modalid.cd-modalidade             no-undo.
      777   def var cd-plano-aux                as int                                 no-undo.
      778   def var cd-tipo-plano-aux           as int                                 no-undo.
      779   def var nr-ter-adesao-aux           like ter-ade.nr-ter-adesao             no-undo.
      780   def var cd-usuario-aux              like usuario.cd-usuario                no-undo.
      781   def var nr-indice-aux               like clashosp.nr-indice-hierarquico    no-undo.
      782   def var cd-cla-hos-aux              like clashosp.cd-cla-hos               no-undo.
      783   def var cd-vinculo-principal-aux    as int                                 no-undo.
      784   def var cd-vinculo-solic-aux        as int                                 no-undo.
      785   def var cd-tipo-insumo-aux          as int                                 no-undo.
      786   def var cd-insumo-aux               as int                                 no-undo.
      787   def var aa-guia-atendimento-aux     as int INIT 0                          no-undo.
      788   def var nr-guia-atendimento-aux     as int                                 no-undo.
      789   def var ds-observacao-aux           as char                                no-undo.
      790   def var nr-guia-atend-ant-aux       as int                                 no-undo.
      791   def var aa-guia-atend-ant-aux       as int                                 no-undo.
      792   def var nr-processo-proc-aux        as int                                 no-undo.
      793   def var nr-seq-digitacao-ins-aux    as int                                 no-undo.
      794   def var id-face-dente-aux           as char                                no-undo.
      795   def var lg-erro-vinculo-aux         as log                                 no-undo.
      796   def var cd-vinculo-aux              as int                                 no-undo.
      797   def var cd-unidade-prestador-aux    as int                                 no-undo.
      798   def var cd-prestador-aux            as int                                 no-undo.
      799   def var cd-esp-prest-executante-aux as int                                 no-undo.
      800   def var in-tipo-guia-aux            as char                                no-undo.
      801   def var nr-seq-guia-aux             as int                                 no-undo.
      802   def var nr-seq-histor-aux           as int                                 no-undo.
      803   def var cod-guia-unimed-intercam-aux as char                               no-undo.
      804   def var lg-erro-guia-aux             as log                                no-undo.
      805   def var lg-arquivo-aux               as log                                no-undo.
      806   def var nr-guias-aux                 as dec format "99999999999"           no-undo.
      807   def var ds-rodape                    as char format "x(132)"  init ""      no-undo.
      808   def var ds-cabecalho                 as char format "x(30)"  initial ""    no-undo.
      809   def var hand1                        as int                                no-undo.
      810   DEF VAR cd-carteira-aux              AS DEC                                NO-UNDO.
      811   DEF VAR cd-unidade-carteira-aux      AS INT                                NO-UNDO.
      812   DEF VAR nr-carteira-aux              AS INT                                NO-UNDO.
      813   def var cd-pacote                    as char format "99999999999"          no-undo. 
      814   def var r-paproins                   as rowid.
      815   def var cd-modalidade-prop-aux       like propost.cd-modalidade            no-undo.
      816   def var cd-plano-prop-aux            like propost.cd-plano                 no-undo.
      817   def var cd-tipo-plano-prop-aux       like propost.cd-tipo-plano            no-undo.
      818   DEFINE VARIABLE char-aux1            AS CHARACTER                          NO-UNDO.
      819   DEFINE VARIABLE char-aux2            AS CHARACTER                          NO-UNDO.
      820   DEFINE VARIABLE char-aux3            AS CHARACTER                          NO-UNDO.
      821   DEFINE VARIABLE char-aux4            AS CHARACTER                          NO-UNDO.
      822   DEFINE VARIABLE char-aux5            AS CHARACTER                          NO-UNDO.
      823   DEFINE VARIABLE char-aux6            AS CHARACTER                          NO-UNDO.
      824   
      825   
      826   def buffer b-import-guia for import-guia.
      827   
      828   /* Temp que guarda o vinculo do prestador executante.
      829      Utilizada na criacao dos movimentos da guia */
      830   def temp-table tmp-prest-exec no-undo
      831       field in-tipo-guia        as char /* Chave da guia */
      832       field val-seqcial         as dec  /* Chave da guia */
      833       field cd-unidade          as int
      834       field cd-prestador        as int
      835       field cd-espec            as int
      836       field cd-vinculo          as int
      837       field nm-prest-exec-compl as char
      838       field nm-conselho         as char
      839       field nr-registro         as int
      840       field uf-conselho         as char
      841       field cd-cbo              as char
      842       index tmp1
      843             in-tipo-guia
      844             val-seqcial.
      845   
      846   def temp-table tmp-erro no-undo like erro-process-import.
      847   
      848   IF in-batch-online-par = "ONLINE"
      849   THEN DO:
      850          form header
      851               fill("-", 132) format "x(132)"                  skip
      852               ds-cabecalho                                    at 01
      853               "Relatorio de Erros"                            at 45
      854               "Folha:" at 123 page-number   format ">>9"            skip
      855               fill("-",110)                 format "x(110)"
      856               today format "99/99/9999"                      at 112
      857               "-"                                            at 123
      858               string(time,"hh:mm:ss")                        at 125 skip(01)
      859               with stream-io no-labels no-box page-top frame f-cabecalho width 132.
      860          
      861          form
      862              tmp-erro.num-seqcial-control column-label "Seq.Control."   format "999999999"
      863              tmp-erro.nom-tab-orig-erro   column-label "Tabela Origem"  format "x(20)" 
      864              tmp-erro.des-erro            column-label "Erro"           format "x(90)"
      865              with down stream-io no-box frame f-rel width 132.
      866          
      867          form header ds-rodape format "x(131)"
      868                      with stream-io no-labels no-box page-bottom frame f-rodape width 132.
      869        END.
      870   
      871   nm-cab-usuario = "Migracao Guias de Autorizacao".
      872   nm-prog        = " AT0210A1 ".
      873   c-versao       = c_prg_vrs.
      874   *** Encrypted Source ***
      875   *** Encrypted Source ***
      876   *** Encrypted Source ***
      877   *** Encrypted Source ***
      878   *** Encrypted Source ***
      879   *** Encrypted Source ***
      880   *** Encrypted Source ***
      881   *** Encrypted Source ***
      882   *** Encrypted Source ***
      883   *** Encrypted Source ***
      884   *** Encrypted Source ***
      885   *** Encrypted Source ***
      886   *** Encrypted Source ***
      887   *** Encrypted Source ***
      888   *** Encrypted Source ***
      889   *** Encrypted Source ***
      890   *** Encrypted Source ***
      891   *** Encrypted Source ***
      892   *** Encrypted Source ***
      893   *** Encrypted Source ***
      894   *** Encrypted Source ***
      895   *** Encrypted Source ***
      896   *** Encrypted Source ***
      897   *** Encrypted Source ***
      898   *** Encrypted Source ***
      899   *** Encrypted Source ***
      900   *** Encrypted Source ***
      901   *** Encrypted Source ***
      902   *** Encrypted Source ***
      903   *** Encrypted Source ***
      904   *** Encrypted Source ***
      905    
      906   
      907   *** Encrypted Source ***
      908   *** Encrypted Source ***
      909   *** Encrypted Source ***
      910   *** Encrypted Source ***
      911   *** Encrypted Source ***
      912   *** Encrypted Source ***
      913   *** Encrypted Source ***
      914   *** Encrypted Source ***
      915   *** Encrypted Source ***
      916   *** Encrypted Source ***
      917   *** Encrypted Source ***
      918   *** Encrypted Source ***
      919   *** Encrypted Source ***
      920   *** Encrypted Source ***
      921   *** Encrypted Source ***
      922   *** Encrypted Source ***
      923   *** Encrypted Source ***
      924   *** Encrypted Source ***
      925   *** Encrypted Source ***
      926   *** Encrypted Source ***
      927   *** Encrypted Source ***
      928   *** Encrypted Source ***
      929   *** Encrypted Source ***
      930   *** Encrypted Source ***
      931   *** Encrypted Source ***
      932   *** Encrypted Source ***
      933   *** Encrypted Source ***
      934   *** Encrypted Source ***
      935   *** Encrypted Source ***
      936   *** Encrypted Source ***
      937   *** Encrypted Source ***
      938   *** Encrypted Source ***
      939   *** Encrypted Source ***
      940   *** Encrypted Source ***
      941   *** Encrypted Source ***
      942   *** Encrypted Source ***
      943   *** Encrypted Source ***
      944   *** Encrypted Source ***
      945   *** Encrypted Source ***
      946   *** Encrypted Source ***
      947   *** Encrypted Source ***
      948   *** Encrypted Source ***
      949   *** Encrypted Source ***
      950   *** Encrypted Source ***
      951   *** Encrypted Source ***
      952   *** Encrypted Source ***
      953   *** Encrypted Source ***
      954   *** Encrypted Source ***
      955   *** Encrypted Source ***
      956   *** Encrypted Source ***
      957   *** Encrypted Source ***
      958   *** Encrypted Source ***
      959   *** Encrypted Source ***
      960   *** Encrypted Source ***
      961   *** Encrypted Source ***
      962   *** Encrypted Source ***
      963   *** Encrypted Source ***
      964   *** Encrypted Source ***
      965   *** Encrypted Source ***
      966   *** Encrypted Source ***
      967   *** Encrypted Source ***
      968   *** Encrypted Source ***
      969   *** Encrypted Source ***
      970   *** Encrypted Source ***
      971   *** Encrypted Source ***
      972   *** Encrypted Source ***
      973   *** Encrypted Source ***
      974   *** Encrypted Source ***
      975   *** Encrypted Source ***
      976   *** Encrypted Source ***
      977   *** Encrypted Source ***
      978   *** Encrypted Source ***
      979   *** Encrypted Source ***
      980   *** Encrypted Source ***
      981   *** Encrypted Source ***
      982   *** Encrypted Source ***
      983   *** Encrypted Source ***
      984   *** Encrypted Source ***
      985   *** Encrypted Source ***
      986   *** Encrypted Source ***
      987   *** Encrypted Source ***
      988   *** Encrypted Source ***
      989   *** Encrypted Source ***
      990   *** Encrypted Source ***
      991   *** Encrypted Source ***
      992   *** Encrypted Source ***
      993   *** Encrypted Source ***
      994   *** Encrypted Source ***
      995   *** Encrypted Source ***
      996   *** Encrypted Source ***
      997   *** Encrypted Source ***
      998   *** Encrypted Source ***
      999   *** Encrypted Source ***
     1000   *** Encrypted Source ***
     1001   *** Encrypted Source ***
     1002   *** Encrypted Source ***
     1003   *** Encrypted Source ***
     1004   *** Encrypted Source ***
     1005   *** Encrypted Source ***
     1006   *** Encrypted Source ***
     1007   *** Encrypted Source ***
     1008   *** Encrypted Source ***
     1009   *** Encrypted Source ***
     1010   *** Encrypted Source ***
     1011   *** Encrypted Source ***
     1012   *** Encrypted Source ***
     1013   *** Encrypted Source ***
     1014   *** Encrypted Source ***
     1015   *** Encrypted Source ***
     1016   *** Encrypted Source ***
     1017   *** Encrypted Source ***
     1018   *** Encrypted Source ***
     1019   *** Encrypted Source ***
     1020   *** Encrypted Source ***
     1021   *** Encrypted Source ***
     1022   *** Encrypted Source ***
     1023   *** Encrypted Source ***
     1024   *** Encrypted Source ***
     1025   *** Encrypted Source ***
     1026   *** Encrypted Source ***
     1027   *** Encrypted Source ***
     1028   *** Encrypted Source ***
     1029   *** Encrypted Source ***
     1030    
     1031   
     1032   /* ------------------- PROCEDURE GRAVA-ERRO --------------------- */
     1033   
     1034   /******************************************************************************
     1035       Programa .....: at0210a.i
     1036       Data .........: 18/05/2015
     1037       Empresa ......: TOTVS
     1038       Cliente ......: Unimed Joao Pessoa
     1039       Programador ..: Jeferson Dal Molin
     1040       Objetivo .....: Migracao das guias de autorizacao do Unicoo para o GPS
     1041   *-----------------------------------------------------------------------------*/
     1042   
     1043   procedure grava-erro:
     1044   
     1045       def input parameter num-seqcial-control-par as integer no-undo.
     1046       def input parameter nom-tab-orig-erro-par   as char    no-undo.
     1047       def input parameter des-erro-par            as char    no-undo.
     1048       def input parameter dat-erro-par            as date    no-undo.
     1049       def input parameter des-ajuda-par           as char    no-undo.
     1050   
     1051       def var nr-seq-aux                          as int     no-undo.
     1052   
     1053       /* ------------------------------------------------------------------------- */
     1054   /*    select max(erro-process-import.num-seqcial) into nr-seq-aux 
     1055              from erro-process-import 
     1056              where erro-process-import.num-seqcial-control = num-seqcial-control-par.*/
     1057       nr-seq-aux = next-value(erro-process-import-seq).
     1058   
     1059       if nr-seq-aux = ?
     1060       or nr-seq-aux = 0
     1061       then assign nr-seq-aux = 1.
     1062       else assign nr-seq-aux = nr-seq-aux + 1.
     1063   
     1064       /**
     1065        * Garantir unicidade da chave.
     1066        */
     1067       create erro-process-import.
     1068       REPEAT:
     1069           assign erro-process-import.num-seqcial         = nr-seq-aux
     1070                  erro-process-import.num-seqcial-control = num-seqcial-control-par NO-ERROR.
     1071           VALIDATE erro-process-import NO-ERROR.
     1072           IF ERROR-STATUS:ERROR
     1073           OR ERROR-STATUS:NUM-MESSAGES > 0
     1074           THEN do:
     1075                  ASSIGN nr-seq-aux = nr-seq-aux + 1.
     1076                  PAUSE(1). /* aguarda 1seg e busca novamente o proximo nr livre.*/
     1077                END.
     1078           else leave.    /* o nr gerado eh valido. continua o processo.*/
     1079       END.
     1080       
     1081   /*    validate erro-process-import.
     1082       release erro-process-import.*/
     1083       /* ------------------------------------------------------------------------- */
     1084   
     1085       ASSIGN lg-erro-guia-aux = true.
     1086   /*
     1087       create erro-process-import.
     1088       assign erro-process-import.num-seqcial         = nr-seq-aux
     1089              erro-process-import.num-seqcial-control = num-seqcial-control-par
     1090   */
     1091       assign
     1092              erro-process-import.nom-tab-orig-erro   = nom-tab-orig-erro-par
     1093              erro-process-import.des-erro            = des-erro-par
     1094              erro-process-import.dat-erro            = dat-erro-par
     1095              erro-process-import.des-ajuda           = des-ajuda-par.
     1096   
     1097       validate erro-process-import.
     1098       release erro-process-import.
     1099   
     1100       IF in-batch-online-par = "ONLINE"
     1101       THEN DO:
     1102               create tmp-erro.
     1103               assign tmp-erro.num-seqcial         = nr-seq-aux
     1104                      tmp-erro.num-seqcial-control = num-seqcial-control-par
     1105                      tmp-erro.nom-tab-orig-erro   = nom-tab-orig-erro-par
     1106                      tmp-erro.des-erro            = des-erro-par
     1107                      tmp-erro.dat-erro            = dat-erro-par
     1108                      tmp-erro.des-ajuda           = des-ajuda-par.
     1109               validate tmp-erro.
     1110               release tmp-erro.
     1111            END.
     1112   
     1113   end procedure.
     1114    
     1115   
     1116   /* -------------------------------------------------------------- */
     1117   *** Encrypted Source ***
     1118   *** Encrypted Source ***
     1119   *** Encrypted Source ***
     1120   *** Encrypted Source ***
     1121   *** Encrypted Source ***
     1122   *** Encrypted Source ***
     1123   *** Encrypted Source ***
     1124   *** Encrypted Source ***
     1125   *** Encrypted Source ***
     1126   *** Encrypted Source ***
     1127   *** Encrypted Source ***
     1128   *** Encrypted Source ***
     1129   *** Encrypted Source ***
     1130   *** Encrypted Source ***
     1131   *** Encrypted Source ***
     1132   *** Encrypted Source ***
     1133   *** Encrypted Source ***
     1134   *** Encrypted Source ***
     1135   *** Encrypted Source ***
     1136   *** Encrypted Source ***
     1137   *** Encrypted Source ***
     1138   *** Encrypted Source ***
     1139   *** Encrypted Source ***
     1140   *** Encrypted Source ***
     1141   *** Encrypted Source ***
     1142   *** Encrypted Source ***
     1143   *** Encrypted Source ***
     1144   *** Encrypted Source ***
     1145   *** Encrypted Source ***
     1146   *** Encrypted Source ***
     1147   *** Encrypted Source ***
     1148   *** Encrypted Source ***
     1149   *** Encrypted Source ***
     1150   *** Encrypted Source ***
     1151   *** Encrypted Source ***
     1152   *** Encrypted Source ***
     1153   *** Encrypted Source ***
     1154   *** Encrypted Source ***
     1155   *** Encrypted Source ***
     1156   *** Encrypted Source ***
     1157   *** Encrypted Source ***
     1158   *** Encrypted Source ***
     1159   *** Encrypted Source ***
     1160   *** Encrypted Source ***
     1161   *** Encrypted Source ***
     1162   *** Encrypted Source ***
     1163   *** Encrypted Source ***
     1164   *** Encrypted Source ***
     1165   *** Encrypted Source ***
     1166   *** Encrypted Source ***
     1167   *** Encrypted Source ***
     1168   *** Encrypted Source ***
     1169   *** Encrypted Source ***
     1170   *** Encrypted Source ***
     1171   *** Encrypted Source ***
     1172   *** Encrypted Source ***
     1173   *** Encrypted Source ***
     1174   *** Encrypted Source ***
     1175   *** Encrypted Source ***
     1176   *** Encrypted Source ***
     1177   *** Encrypted Source ***
     1178   *** Encrypted Source ***
     1179   *** Encrypted Source ***
     1180   *** Encrypted Source ***
     1181     /* ----------------- CARTEIRA DO BENEFICIARIO --- */
     1182   *** Encrypted Source ***
     1183   *** Encrypted Source ***
     1184   *** Encrypted Source ***
     1185   *** Encrypted Source ***
     1186   *** Encrypted Source ***
     1187   *** Encrypted Source ***
     1188   *** Encrypted Source ***
     1189   *** Encrypted Source ***
     1190   *** Encrypted Source ***
     1191   *** Encrypted Source ***
     1192   *** Encrypted Source ***
     1193   *** Encrypted Source ***
     1194   *** Encrypted Source ***
     1195   *** Encrypted Source ***
     1196   *** Encrypted Source ***
     1197   *** Encrypted Source ***
     1198   *** Encrypted Source ***
     1199   *** Encrypted Source ***
     1200   *** Encrypted Source ***
     1201   *** Encrypted Source ***
     1202   *** Encrypted Source ***
     1203   *** Encrypted Source ***
     1204   *** Encrypted Source ***
     1205   *** Encrypted Source ***
     1206   *** Encrypted Source ***
     1207   *** Encrypted Source ***
     1208   *** Encrypted Source ***
     1209   *** Encrypted Source ***
     1210   *** Encrypted Source ***
     1211   *** Encrypted Source ***
     1212   *** Encrypted Source ***
     1213   *** Encrypted Source ***
     1214   *** Encrypted Source ***
     1215   *** Encrypted Source ***
     1216   *** Encrypted Source ***
     1217   *** Encrypted Source ***
     1218   *** Encrypted Source ***
     1219   *** Encrypted Source ***
     1220   *** Encrypted Source ***
     1221   *** Encrypted Source ***
     1222   *** Encrypted Source ***
     1223   *** Encrypted Source ***
     1224   *** Encrypted Source ***
     1225   *** Encrypted Source ***
     1226     /* ------------------------ PRESTADOR VINCULO --- */
     1227   *** Encrypted Source ***
     1228   *** Encrypted Source ***
     1229   *** Encrypted Source ***
     1230   *** Encrypted Source ***
     1231   *** Encrypted Source ***
     1232   *** Encrypted Source ***
     1233   *** Encrypted Source ***
     1234   *** Encrypted Source ***
     1235   *** Encrypted Source ***
     1236   *** Encrypted Source ***
     1237   *** Encrypted Source ***
     1238   *** Encrypted Source ***
     1239   *** Encrypted Source ***
     1240   *** Encrypted Source ***
     1241   *** Encrypted Source ***
     1242   *** Encrypted Source ***
     1243   *** Encrypted Source ***
     1244   *** Encrypted Source ***
     1245   *** Encrypted Source ***
     1246   *** Encrypted Source ***
     1247   *** Encrypted Source ***
     1248   *** Encrypted Source ***
     1249   *** Encrypted Source ***
     1250   *** Encrypted Source ***
     1251   *** Encrypted Source ***
     1252   *** Encrypted Source ***
     1253   *** Encrypted Source ***
     1254   *** Encrypted Source ***
     1255   *** Encrypted Source ***
     1256   *** Encrypted Source ***
     1257     /* ----------------- ROTINA DA TABELA OUT-UNI --- */
     1258   
     1259   find first paramecp no-lock no-error.
     1260   
     1261   if not avail paramecp
     1262   then do:
     1263          message "Parametros do sistema nao cadastrados."
     1264              view-as alert-box title "Atencao!!!".
     1265          return.
     1266        end.
     1267   
     1268   find unimed where unimed.cd-unimed = paramecp.cd-unimed no-lock no-error.
     1269   
     1270   if available unimed
     1271   then assign ds-cabecalho   = unimed.nm-unimed.
     1272   
     1273   find first paramrc no-lock no-error.
     1274   
     1275   if not avail paramrc
     1276   then do:
     1277          message "Parametros do modulo Revisao de Contas nao cadastrados."
     1278              view-as alert-box title "Atencao!!!".
     1279          return.
     1280        end.
     1281   
     1282   assign ds-rodape = " " + nm-prog + " - " + c-versao
     1283      ds-rodape = fill("-", 132 - length(ds-rodape)) + ds-rodape.
     1284   
     1285   *** Encrypted Source ***
     1286   *** Encrypted Source ***
     1287   *** Encrypted Source ***
     1288   *** Encrypted Source ***
     1289   *** Encrypted Source ***
     1290   *** Encrypted Source ***
     1291   *** Encrypted Source ***
     1292   *** Encrypted Source ***
     1293   *** Encrypted Source ***
     1294   *** Encrypted Source ***
     1295   *** Encrypted Source ***
     1296   *** Encrypted Source ***
     1297   *** Encrypted Source ***
     1298   *** Encrypted Source ***
     1299   *** Encrypted Source ***
     1300   *** Encrypted Source ***
     1301   *** Encrypted Source ***
     1302   *** Encrypted Source ***
     1303   *** Encrypted Source ***
     1304   *** Encrypted Source ***
     1305   *** Encrypted Source ***
     1306   *** Encrypted Source ***
     1307   *** Encrypted Source ***
     1308   *** Encrypted Source ***
     1309   *** Encrypted Source ***
     1310   *** Encrypted Source ***
     1311   *** Encrypted Source ***
     1312   *** Encrypted Source ***
     1313   *** Encrypted Source ***
     1314   *** Encrypted Source ***
     1315   *** Encrypted Source ***
     1316   *** Encrypted Source ***
     1317   *** Encrypted Source ***
     1318   *** Encrypted Source ***
     1319   *** Encrypted Source ***
     1320   *** Encrypted Source ***
     1321   *** Encrypted Source ***
     1322   *** Encrypted Source ***
     1323   *** Encrypted Source ***
     1324   *** Encrypted Source ***
     1325   *** Encrypted Source ***
     1326   *** Encrypted Source ***
     1327   *** Encrypted Source ***
     1328   *** Encrypted Source ***
     1329   *** Encrypted Source ***
     1330   *** Encrypted Source ***
     1331   *** Encrypted Source ***
     1332   *** Encrypted Source ***
     1333   *** Encrypted Source ***
     1334   *** Encrypted Source ***
     1335   *** Encrypted Source ***
     1336   *** Encrypted Source ***
     1337   *** Encrypted Source ***
     1338   *** Encrypted Source ***
     1339   *** Encrypted Source ***
     1340   *** Encrypted Source ***
     1341   *** Encrypted Source ***
     1342   *** Encrypted Source ***
     1343   *** Encrypted Source ***
     1344   *** Encrypted Source ***
     1345   *** Encrypted Source ***
     1346   *** Encrypted Source ***
     1347   *** Encrypted Source ***
     1348   *** Encrypted Source ***
     1349   *** Encrypted Source ***
     1350   *** Encrypted Source ***
     1351   *** Encrypted Source ***
     1352   *** Encrypted Source ***
     1353   *** Encrypted Source ***
     1354   *** Encrypted Source ***
     1355   *** Encrypted Source ***
     1356   *** Encrypted Source ***
     1357   *** Encrypted Source ***
     1358   *** Encrypted Source ***
     1359   *** Encrypted Source ***
     1360   *** Encrypted Source ***
     1361   *** Encrypted Source ***
     1362   *** Encrypted Source ***
1MS-WINX     1363   *** Encrypted Source ***
     1364   *** Encrypted Source ***
     1365   *** Encrypted Source ***
     1366   *** Encrypted Source ***
     1367   *** Encrypted Source ***
     1368   *** Encrypted Source ***
     1369   *** Encrypted Source ***
     1370   *** Encrypted Source ***
     1371   *** Encrypted Source ***
     1372   *** Encrypted Source ***
     1373   *** Encrypted Source ***
     1374   *** Encrypted Source ***
     1375   *** Encrypted Source ***
     1376   *** Encrypted Source ***
     1377   *** Encrypted Source ***
     1378   *** Encrypted Source ***
     1379   *** Encrypted Source ***
     1380   *** Encrypted Source ***
     1381   *** Encrypted Source ***
     1382   *** Encrypted Source ***
     1383   *** Encrypted Source ***
     1384   *** Encrypted Source ***
     1385   *** Encrypted Source ***
     1386   *** Encrypted Source ***
     1387   *** Encrypted Source ***
     1388   *** Encrypted Source ***
     1389   *** Encrypted Source ***
     1390   *** Encrypted Source ***
     1391   *** Encrypted Source ***
     1392   *** Encrypted Source ***
     1393   *** Encrypted Source ***
     1394   *** Encrypted Source ***
     1395   *** Encrypted Source ***
     1396   *** Encrypted Source ***
     1397   *** Encrypted Source ***
     1398   *** Encrypted Source ***
     1399   *** Encrypted Source ***
     1400   *** Encrypted Source ***
     1401   *** Encrypted Source ***
     1402   *** Encrypted Source ***
     1403   *** Encrypted Source ***
     1404   *** Encrypted Source ***
     1405   *** Encrypted Source ***
     1406   *** Encrypted Source ***
     1407   *** Encrypted Source ***
     1408   *** Encrypted Source ***
     1409   *** Encrypted Source ***
     1410   *** Encrypted Source ***
     1411   *** Encrypted Source ***
     1412   *** Encrypted Source ***
     1413   *** Encrypted Source ***
     1414   *** Encrypted Source ***
     1415   *** Encrypted Source ***
     1416   *** Encrypted Source ***
     1417    
     1418   
     1419   assign lg-arquivo-aux  = no.
     1420   
     1421   /* -------------------------- BLOCO PRINCIPAL ---------------------- */
     1422   IF in-batch-online-par = "BATCH"
     1423   THEN DO:
     1424          run importa-dados.
     1425        END.
     1426   ELSE DO:
     1427          repeat on endkey undo, next with frame f-AT0210A1:
     1428             
     1429                  1430   *** Encrypted Source ***
     1431   *** Encrypted Source ***
     1432   *** Encrypted Source ***
     1433   *** Encrypted Source ***
     1434   *** Encrypted Source ***
     1435   *** Encrypted Source ***
     1436   *** Encrypted Source ***
     1437   *** Encrypted Source ***
     1438   *** Encrypted Source ***
     1439   *** Encrypted Source ***
     1440   *** Encrypted Source ***
     1441   *** Encrypted Source ***
     1442   *** Encrypted Source ***
     1443   *** Encrypted Source ***
     1444   *** Encrypted Source ***
     1445   *** Encrypted Source ***
     1446   *** Encrypted Source ***
     1447   *** Encrypted Source ***
     1448   *** Encrypted Source ***
     1449   *** Encrypted Source ***
     1450   *** Encrypted Source ***
     1451   *** Encrypted Source ***
     1452   *** Encrypted Source ***
     1453   *** Encrypted Source ***
     1454   *** Encrypted Source ***
     1455   *** Encrypted Source ***
     1456   *** Encrypted Source ***
     1457   *** Encrypted Source ***
     1458   *** Encrypted Source ***
     1459   *** Encrypted Source ***
     1460   *** Encrypted Source ***
     1461   *** Encrypted Source ***
     1462   *** Encrypted Source ***
     1463   *** Encrypted Source ***
     1464   *** Encrypted Source ***
     1465   *** Encrypted Source ***
     1466   *** Encrypted Source ***
     1467   *** Encrypted Source ***
     1468   *** Encrypted Source ***
     1469   *** Encrypted Source ***
     1470   *** Encrypted Source ***
     1471   *** Encrypted Source ***
     1472   *** Encrypted Source ***
     1473   *** Encrypted Source ***
     1474   *** Encrypted Source ***
     1475   *** Encrypted Source ***
     1476   *** Encrypted Source ***
     1477   *** Encrypted Source ***
     1478   *** Encrypted Source ***
     1479   *** Encrypted Source ***
     1480   *** Encrypted Source ***
     1481   *** Encrypted Source ***
     1482   *** Encrypted Source ***
     1483   *** Encrypted Source ***
     1484   *** Encrypted Source ***
     1485   *** Encrypted Source ***
     1486   *** Encrypted Source ***
     1487   *** Encrypted Source ***
     1488   *** Encrypted Source ***
     1489   *** Encrypted Source ***
     1490   *** Encrypted Source ***
     1491   *** Encrypted Source ***
     1492   *** Encrypted Source ***
     1493   *** Encrypted Source ***
     1494   *** Encrypted Source ***
     1495   *** Encrypted Source ***
     1496   *** Encrypted Source ***
     1497   *** Encrypted Source ***
     1498    
     1499          
     1500              if c-opcao = "Arquivo"
     1501              then do:
     1502                     assign lg-arquivo-aux  = no.
     1503          
     1504                          1505   *** Encrypted Source ***
     1506   *** Encrypted Source ***
     1507   *** Encrypted Source ***
     1508   *** Encrypted Source ***
     1509   *** Encrypted Source ***
     1510   *** Encrypted Source ***
     1511   *** Encrypted Source ***
     1512   *** Encrypted Source ***
     1513   *** Encrypted Source ***
     1514   *** Encrypted Source ***
     1515   *** Encrypted Source ***
     1516   *** Encrypted Source ***
     1517   *** Encrypted Source ***
     1518   *** Encrypted Source ***
     1519   *** Encrypted Source ***
     1520   *** Encrypted Source ***
     1521   *** Encrypted Source ***
     1522   *** Encrypted Source ***
     1523   *** Encrypted Source ***
     1524   *** Encrypted Source ***
     1525   *** Encrypted Source ***
     1526   *** Encrypted Source ***
     1527   *** Encrypted Source ***
     1528   *** Encrypted Source ***
     1529   *** Encrypted Source ***
     1530   *** Encrypted Source ***
     1531   *** Encrypted Source ***
     1532   *** Encrypted Source ***
     1533   *** Encrypted Source ***
     1534   *** Encrypted Source ***
     1535   *** Encrypted Source ***
     1536   *** Encrypted Source ***
     1537   *** Encrypted Source ***
     1538   *** Encrypted Source ***
     1539   *** Encrypted Source ***
     1540   *** Encrypted Source ***
     1541   *** Encrypted Source ***
     1542   *** Encrypted Source ***
     1543   *** Encrypted Source ***
     1544   *** Encrypted Source ***
     1545   *** Encrypted Source ***
     1546   *** Encrypted Source ***
     1547   *** Encrypted Source ***
     1548   *** Encrypted Source ***
     1549   *** Encrypted Source ***
     1550   *** Encrypted Source ***
     1551   *** Encrypted Source ***
     1552   *** Encrypted Source ***
     1553   *** Encrypted Source ***
     1554   *** Encrypted Source ***
     1555   *** Encrypted Source ***
     1556   *** Encrypted Source ***
     1557   *** Encrypted Source ***
     1558   *** Encrypted Source ***
     1559   *** Encrypted Source ***
     1560   *** Encrypted Source ***
     1561   *** Encrypted Source ***
     1562   *** Encrypted Source ***
     1563   *** Encrypted Source ***
     1564   *** Encrypted Source ***
     1565   *** Encrypted Source ***
     1566   *** Encrypted Source ***
     1567   *** Encrypted Source ***
     1568   *** Encrypted Source ***
     1569   *** Encrypted Source ***
     1570   *** Encrypted Source ***
     1571   *** Encrypted Source ***
     1572   *** Encrypted Source ***
     1573   *** Encrypted Source ***
     1574   *** Encrypted Source ***
     1575   *** Encrypted Source ***
     1576   *** Encrypted Source ***
     1577   *** Encrypted Source ***
     1578   *** Encrypted Source ***
     1579   *** Encrypted Source ***
     1580   *** Encrypted Source ***
     1581    
     1582          
     1583                     assign lg-arquivo-aux  = yes.
     1584                   end.
     1585          
     1586             if c-opcao = "Executa"
     1587             then do:
     1588                    if not lg-arquivo-aux
     1589                    then do:
     1590                           message "Voce deve passar pela opcao arquivo."
     1591                               view-as alert-box title "Atencao !!!".
     1592                           next.
     1593                         end.
     1594          
     1595                    assign lg-executa-aux = no.
     1596          
     1597                    select count(*) into nr-reg-aux
     1598                           from import-guia
     1599                           where import-guia.ind-sit-import = in-status-monitorar-par. /* Recebido */
     1600                    
     1601                    message "Existem " nr-reg-aux " guias pendentes de migracao." skip
     1602                            "Confirma a execucao?"
     1603                        view-as alert-box question buttons yes-no title "Atencao!!!" update lg-executa-aux.
     1604          
     1605                    if not lg-executa-aux
     1606                    then undo, retry.
     1607          
     1608                    RUN importa-dados.
     1609   
     1610                    /* ----------------------------------------------------------------------------- */
     1611          
     1612                    hide message no-pause.
     1613          
     1614                    if can-find(first tmp-erro)
     1615                    then run gera-rel-erro.
     1616          
     1617                    if can-find(first tmp-erro)
     1618                    then message "Processo concluido com erros. Verifique o relatorio de erros." skip
     1619                                 "Numero de guias criadas: " nr-guias-aux
     1620                            view-as alert-box info buttons ok.
     1621                    else message "Processo concluido." skip
     1622                                 "Numero de guias criadas: " nr-guias-aux
     1623                            view-as alert-box info buttons ok.
     1624             end.
     1625          
     1626             if c-opcao = "Fim"
     1627             then do:
     1628                    hide all no-pause.
     1629                    leave.
     1630                  end.
     1631          end.
     1632        END.
     1633   /* ----------------------------------------------------------------- */
     1634   
     1635   PROCEDURE importa-dados:
     1636       message "Processando! Aguarde...".
     1637       empty temp-table tmp-prest-exec.
     1638       empty temp-table tmp-erro.
     1639   
     1640       assign nr-guias-aux = 0.
     1641   
     1642       /* ----------------------------------------------------------------------------- */
     1643       for each import-guia where import-guia.ind-sit-import    = in-status-monitorar-par /* Recebido */
     1644                              and import-guia.num-seqcial-princ = 0 /* Considera primeiro as guias principais */
     1645                                  no-lock:
     1646   
     1647           message "Importando Guia Princ.: " import-guia.num-seqcial-control " Sit: " in-status-monitorar-par.
     1648   
     1649           run importa-guias.
     1650   
     1651           if lg-erro-guia-aux
     1652           then do:
     1653                  assign lg-erro-aux = yes.
     1654   
     1655                  do transaction:
     1656                      run atualiza-import-guia(input "PE", /* Erro */
     1657                                               input paramecp.cd-unimed,    
     1658                                               input aa-guia-atendimento-aux,
     1659                                               input nr-guia-atendimento-aux).
     1660                  end.
     1661                end.
     1662       end.
     1663   
     1664       for each import-guia where import-guia.ind-sit-import    = in-status-monitorar-par /* Recebido */
     1665                              and import-guia.num-seqcial-princ > 0 /* Considera as guias associadas */
     1666                              AND CAN-FIND(FIRST b-import-guia
     1667                                           WHERE b-import-guia.num-seqcial = import-guia.num-seqcial-princ
     1668                                             AND b-import-guia.aa-guia-atendimento <> 0
     1669                                             AND b-import-guia.nr-guia-atendimento <> 0)
     1670                                  no-lock:
     1671   
     1672           message "Importando Guia Assoc.: " import-guia.num-seqcial-control " Sit: " in-status-monitorar-par.
     1673   
     1674           run importa-guias.
     1675   
     1676           if lg-erro-guia-aux
     1677           then do:
     1678                  assign lg-erro-aux = yes.
     1679   
     1680                  do transaction:
     1681                      run atualiza-import-guia(input "PE", /* Erro */
     1682                                               input paramecp.cd-unimed,    
     1683                                               input aa-guia-atendimento-aux,
     1684                                               input nr-guia-atendimento-aux).
     1685                  end.
     1686                end.
     1687       end.            
     1688   
     1689   END PROCEDURE.
     1690   
     1691   /* ----------------------------------------------------------------- */
     1692   procedure importa-guias:
     1693   
     1694       run zera-vaiaveis-auxiliares.
     1695   
     1696       run consiste-dados-gerais(output lg-erro-guia-aux).
     1697   
     1698       if lg-erro-guia-aux
     1699       then return.
     1700   
     1701       /* ----------------------- VALIDA DADOS TISS ---------------------------- */
     1702       case trim(import-guia.ind-tip-guia):
     1703           when "C" /* Consulta */
     1704           then run valida-consulta(input-output lg-erro-guia-aux).
     1705   
     1706           when "S" /* SADT */
     1707           then run valida-sp-sadt(input-output lg-erro-guia-aux).
     1708   
     1709           when "I" /* Internacao */
     1710           then run valida-internacao(input-output lg-erro-guia-aux).
     1711   
     1712           when "P" /* Prorrogacao */
     1713           then run valida-prorrogacao(input-output lg-erro-guia-aux).
     1714   
     1715           when "O" /* Odontologia */
     1716           then run valida-odontologia(input-output lg-erro-guia-aux).
     1717       end case.
     1718   
     1719       if lg-erro-guia-aux
     1720       then return.
     1721   
     1722       /* --------------------- VALIDA ANEXOS CLINICOS TISS ----------------- */
     1723       for each import-anexo-solicit 
     1724          where import-anexo-solicit.num-seq-import = import-guia.num-seqcial
     1725                no-lock:
     1726   
     1727           run valida-dados-gerais-anexos(input-output lg-erro-guia-aux).
     1728   
     1729           case trim(import-anexo-solicit.ind-tip-anexo):
     1730               when "1" /* Quimioterapia */
     1731               then run valida-quimioterapia(input-output lg-erro-guia-aux).
     1732   
     1733               when "2" /* Radioterapia */
     1734               then run valida-radioterapia(input-output lg-erro-guia-aux).
     1735   
     1736               when "3" /* OPME */
     1737               then run valida-opme(input-output lg-erro-guia-aux).
     1738   
     1739               when "4" /* Odontologia */
     1740               then run valida-anexo-odonto(input-output lg-erro-guia-aux).
     1741           end case.
     1742   
     1743   /*TRATAR PARA CHECAR SE AGUIA  COMPLEMENTO. SE FOR, PREENCHER OS CAMPOS AA e NR-GUIA-ATENDIMENTO-ANT QUE SO TRATADOS 
     1744   NO CRIA-GUIA CHAMADO A SEGUIR
     1745   */
     1746           if lg-erro-guia-aux
     1747           then next.
     1748       end. /* each import-anexo-solicit */
     1749   
     1750       if lg-erro-guia-aux
     1751       then return.
     1752   
     1753       do transaction:
     1754           run cria-guia.
     1755       end.
     1756   
     1757       if lg-erro-guia-aux
     1758       then return.
     1759   
     1760       do transaction:
     1761           run atualiza-import-guia(input "IT", /* Integrado */
     1762                                    input paramecp.cd-unimed,
     1763                                    input aa-guia-atendimento-aux,
     1764                                    input nr-guia-atendimento-aux).
     1765       end.
     1766   
     1767       assign nr-guias-aux = nr-guias-aux + 1.
     1768   
     1769   end procedure.
     1770   
     1771   /* ----------------------------------------------------------------- */
     1772   procedure zera-vaiaveis-auxiliares:
     1773   
     1774       assign cd-modalidade-aux        = 0
     1775              nr-ter-adesao-aux        = 0
     1776              cd-usuario-aux           = 0
     1777              nr-indice-aux            = 0
     1778              cd-cla-hos-aux           = 0
     1779              cd-vinculo-principal-aux = 0
     1780              cd-vinculo-solic-aux     = 0
     1781              aa-guia-atend-ant-aux    = 0
     1782              nr-guia-atend-ant-aux    = 0
     1783              cd-plano-aux             = 0
     1784              cd-tipo-plano-aux        = 0
     1785              lg-erro-guia-aux         = no.
     1786   
     1787   end procedure.
     1788   
     1789   /* ----------------------------------------------------------------- */
     1790   procedure cria-guia:
     1791   
     1792       assign nr-guia-atendimento-aux = 0.
     1793   
     1794       run gera-seq-guia.
     1795   
     1796       assign cd-unidade-prestador-aux    = 0
     1797              cd-prestador-aux            = 0
     1798              cd-esp-prest-executante-aux = 0
     1799              cd-vinculo-aux              = 0
     1800              nr-processo-proc-aux        = 1
     1801              nr-seq-digitacao-ins-aux    = 1.
     1802   
     1803       /* ---------------- Preenche prestador executante --------------------- */
     1804       case trim(import-guia.ind-tip-guia):
     1805           when "C" /* Consulta */
     1806           then assign in-tipo-guia-aux = "CONS"
     1807                       nr-seq-guia-aux  = import-guia-con.num-seqcial-guia.
     1808   
     1809           when "S" /* SADT */
     1810           then assign in-tipo-guia-aux = "SADT"
     1811                       nr-seq-guia-aux  = import-guia-sadt.val-seqcial.
     1812   
     1813           when "I" /* Internacao */
     1814           then assign in-tipo-guia-aux = "INTE"
     1815                       nr-seq-guia-aux  = import-guia-intrcao.num-seqcial-guia.
     1816           
     1817           when "P" /* Prorrogacao */
     1818           then assign in-tipo-guia-aux = "PROR"
     1819                       nr-seq-guia-aux  = import-guia-prorrog.num-seqcial-guia.
     1820           
     1821           when "O" /* Odontologia */
     1822           then assign in-tipo-guia-aux = "ODON"
     1823                       nr-seq-guia-aux  = import-guia-odonto.num-seqcial-guia.
     1824       end case.
     1825   
     1826       find tmp-prest-exec where tmp-prest-exec.in-tipo-guia = in-tipo-guia-aux
     1827                             and tmp-prest-exec.val-seqcial  = nr-seq-guia-aux 
     1828                                 no-lock no-error.
     1829   
     1830       if avail tmp-prest-exec
     1831       then assign cd-unidade-prestador-aux    = tmp-prest-exec.cd-unidade
     1832                   cd-prestador-aux            = tmp-prest-exec.cd-prestador
     1833                   cd-esp-prest-executante-aux = tmp-prest-exec.cd-espec
     1834                   cd-vinculo-aux              = tmp-prest-exec.cd-vinculo.
     1835       /* -------------------------------------------------------------------- */
     1836   
     1837       assign ds-observacao-aux = "Numero autorizacao Unicoo: "
     1838                                + import-guia.cod-guia-operdra
     1839                                + chr(10)
     1840                                + fill("-",68)
     1841                                + chr(10)
     1842                                + import-guia.des-obs.
     1843   
     1844       RUN escrever-log("@@@@@criando guiautor ano: " + STRING(aa-guia-atendimento-aux) + " guia: " + STRING(nr-guia-atendimento-aux)).
     1845       create guiautor.
     1846       assign guiautor.cd-userid-auditor        = ""                                                     
     1847              guiautor.cd-unidade               = paramecp.cd-unimed                                     
     1848              guiautor.aa-guia-atendimento      = aa-guia-atendimento-aux                                
     1849              guiautor.nr-guia-atendimento      = nr-guia-atendimento-aux                                
     1850              guiautor.lg-guia-principal[1]     = (if import-guia.num-seqcial-princ = 0                  
     1851                                                   then yes                                              
     1852                                                   else no)                                              
     1853              guiautor.cd-tipo-guia             = import-guia.cd-tipo-guia                               
     1854              guiautor.cd-transacao             = import-guia.cd-transacao                               
     1855              guiautor.dt-emissao-guia          = import-guia.dat-solicit  
     1856              guiautor.dt-emissao               = import-guia.dat-solicit                                
     1857              guiautor.cd-unidade-carteira      = cd-unidade-carteira-aux                        
     1858              guiautor.cd-carteira-usuario      = cd-carteira-aux                         
     1859              guiautor.cd-unidade-solicitante   = import-guia.cd-unidade-solic                           
     1860              guiautor.cd-prestador-solicitante = int(import-guia.cd-prestador-solic)                        
     1861              guiautor.cd-vinculo-solicitante   = cd-vinculo-solic-aux                                   
     1862              guiautor.cd-especialid            = import-guia.cd-especialid                              
     1863              guiautor.cd-cla-hos               = cd-cla-hos-aux                                         
     1864              guiautor.cd-unidade-principal     = import-guia.cd-unidade-principal                       
     1865              guiautor.cd-prestador-principal   = import-guia.cd-prestador-principal                     
     1866              guiautor.cd-vinculo-principal     = cd-vinculo-principal-aux                               
     1867              guiautor.dt-cancel-guia           = ?                                                      
     1868              guiautor.cd-unidade-clinica       = paramecp.cd-unimed                                     
     1869              guiautor.cd-clinica               = import-guia.cd-clinica                                 
     1870              guiautor.dt-atualizacao           = today                                                  
     1871              guiautor.cd-userid                = v_cod_usuar_corren                                     
     1872              guiautor.ds-observacao            = ds-observacao-aux                                      
     1873              guiautor.ds-observacao-interna    = ""                                                     
     1874              guiautor.lg-via-orcamento         = no                                                     
     1875              guiautor.log-12                   = no /* Via Reembolso? */                                
     1876              guiautor.aa-guia-atendimento-ant  = aa-guia-atend-ant-aux                                  
     1877              guiautor.nr-guia-atendimento-ant  = nr-guia-atend-ant-aux                                  
     1878              guiautor.char-21                  = paramrc.char-25 /* Versao TISS */                      
     1879              guiautor.nm-prof-sol              = trim(import-guia.nom-prestdor-solic)                   
     1880              guiautor.char-14                  = trim(import-guia.cod-cons-profis)                      
     1881              guiautor.char-17                  = trim(import-guia.ind-nume-cons)                        
     1882              guiautor.char-18                  = caps(import-guia.uf-conselho)                          
     1883              guiautor.char-19                  = trim(string(import-guia.cdn-cbo))                      
     1884              guiautor.cd-modalidade            = cd-modalidade-aux                                      
     1885              guiautor.nr-ter-adesao            = nr-ter-adesao-aux                                      
     1886              guiautor.cd-usuario               = cd-usuario-aux                                         
     1887              guiautor.in-liberado-guias        = import-guia.ind-sit-guia                               
     1888              guiautor.nm-grupo-usuario         = import-guia.cod-livre-1                                
     1889              guiautor.nm-grupo                 = import-guia.cod-livre-3                                
     1890              guiautor.cd-local-autorizacao     = import-guia.num-livre-1
     1891              guiautor.u-int-1                  = import-guia.num-seqcial
     1892              guiautor.char-15                  = import-guia.cod-livre-1
     1893              guiautor.date-2                   = import-guia.dat-livre-2
     1894              guiautor.nr-via-carteira          = import-guia.nr-via-carteira.
     1895   
     1896   
     1897       /* Informacoes Intercambio Eletronico */
     1898       if import-guia.log-intercam-eletron
     1899       then do:
     1900              assign guiautor.ds-mens-intercambio = trim(import-guia.des-intercam)
     1901                     guiautor.int-11              = 5. /* Procedencia SCS */
     1902   
     1903              /*assign cod-guia-unimed-intercam-aux = string(dec(import-guia.cod-guia-unimed-intercam),"9999999999"). */
     1904   
     1905              if import-guia.cd-unidade-carteira = paramecp.cd-unimed
     1906              then do:
     1907                     assign guiautor.in-envio-intercambio = "EnvioOrigem".
     1908   
     1909                     /* --------------------- GUIA SOLIC -------------------------------------- */
     1910                     find first unimed where unimed.cd-unimed = import-guia.cd-unidade-carteira no-lock no-error.
     1911   
     1912                     if   avail unimed
     1913                     and  unimed.lg-tem-serious 
     1914                     then assign guiautor.aa-guia-atend-solic = int(substring(string(year(today)),1,2)
     1915                                                              + substring(import-guia.cod-guia-unimed-intercam,1,2))
     1916                                 guiautor.nr-guia-atend-solic = int(substring(import-guia.cod-guia-unimed-intercam,3,8)).
     1917                     else do:
     1918                            if length(trim(import-guia.cod-guia-unimed-intercam)) > 8
     1919                            then do:
     1920                                   if length(trim(import-guia.cod-guia-unimed-intercam)) > 9
     1921                                   then assign guiautor.aa-guia-atend-solic = int("00" + substring(import-guia.cod-guia-unimed-intercam,1,2))
     1922                                               guiautor.nr-guia-atend-solic = int(substring(import-guia.cod-guia-unimed-intercam,3,8)).
     1923                                   else assign guiautor.aa-guia-atend-solic = int("000" + substring(import-guia.cod-guia-unimed-intercam,1,1))
     1924                                               guiautor.nr-guia-atend-solic = int(substring(import-guia.cod-guia-unimed-intercam,2,8)).
     1925                                 end.
     1926                            else assign guiautor.aa-guia-atend-solic = 0
     1927                                        guiautor.nr-guia-atend-solic = int(string(import-guia.cod-guia-unimed-intercam)).
     1928                          end.
     1929                   end.
     1930              else do:
     1931                     assign guiautor.in-receb-intercambio = "RecebidoDestino".
     1932   
     1933                     find first unimed where unimed.cd-unimed = cd-unidade-prestador-aux no-lock no-error.
     1934   
     1935                     /*if   avail unimed
     1936                     and  unimed.lg-tem-serious
     1937                     then assign guiautor.aa-guia-atend-origem = int(substring(string(year(today)), 1, 2) + substring(import-guia.cod-guia-unimed-intercam,39,02))
     1938                                 guiautor.nr-guia-atend-origem = int(substring(import-guia.cod-guia-unimed-intercam,41,08)).
     1939                     else assign guiautor.aa-guia-atend-origem = int("00" + substring(import-guia.cod-guia-unimed-intercam,1,2))
     1940                                 guiautor.nr-guia-atend-origem = int(substring(import-guia.cod-guia-unimed-intercam,3,8)).*/
     1941   
     1942                     /* JP */
     1943   
     1944                     if length(string(import-guia.cod-guia-unimed-intercam)) <= 8
     1945                     then assign guiautor.nr-guia-atend-origem = int(import-guia.cod-guia-unimed-intercam).              
     1946   
     1947                     if length(string(import-guia.cod-guia-unimed-intercam)) = 9                                            
     1948                     then assign guiautor.aa-guia-atend-origem = int(substring(import-guia.cod-guia-unimed-intercam,1,1))    
     1949                                 guiautor.nr-guia-atend-origem = int(substring(import-guia.cod-guia-unimed-intercam,2,8)).   
     1950   
     1951                     if length(string(import-guia.cod-guia-unimed-intercam)) = 10                                            
     1952                     then assign guiautor.aa-guia-atend-origem = int(substring(import-guia.cod-guia-unimed-intercam,1,2))    
     1953                                 guiautor.nr-guia-atend-origem = int(substring(import-guia.cod-guia-unimed-intercam,3,8)).   
     1954   
     1955                     ASSIGN guiautor.aa-guia-atend-solic = 0
     1956                            guiautor.nr-guia-atend-solic = 0.
     1957                   end.
     1958            end.
     1959   
     1960       RUN escrever-log("@@@@@criando guia-autoriz-comp ano: " + STRING(aa-guia-atendimento-aux) + " guia:" + STRING(nr-guia-atendimento-aux)).
     1961   
     1962       create guia-autoriz-comp.
     1963       assign guia-autoriz-comp.cdn-unid             = paramecp.cd-unimed
     1964              guia-autoriz-comp.num-ano-guia-atendim = aa-guia-atendimento-aux
     1965              guia-autoriz-comp.num-guia-atendim     = nr-guia-atendimento-aux
     1966              guia-autoriz-comp.log-atendim-rn       = import-guia.log-atendim-rn.
     1967   
     1968       case trim(import-guia.ind-tip-guia):
     1969           when "C" /* Consulta */
     1970           then do:
     1971                  assign guiautor.in-acidente    = 0
     1972                         guiautor.int-30         = int(import-guia-con.ind-tip-con) /* Tipo de Consulta */
     1973                         guiautor.in-classe-nota = 01.
     1974   
     1975                  run cria-movimentos(input "CONS",
     1976                                      input import-guia-con.num-seqcial-guia).
     1977                end.
     1978   
     1979           when "S" /* SADT */
     1980           then do:
     1981                  assign guiautor.in-acidente    = int(import-guia-sadt.ind-tip-acid)
     1982                         guiautor.cr-solicitacao = trim(import-guia-sadt.ind-carac-solicit)
     1983                         guiautor.ds-ind-clinica = trim(import-guia-sadt.des-indic-clinic)
     1984                         guiautor.int-18         = int(import-guia-sadt.ind-tip-atendim)
     1985                         guiautor.int-30         = int(import-guia-sadt.ind-tip-con)
     1986                         guiautor.in-classe-nota = 02.
     1987   
     1988                  run cria-movimentos(input "SADT",
     1989                                      input import-guia-sadt.val-seqcial).
     1990                end.
     1991   
     1992           when "I" /* Internacao */
     1993           then do:
     1994                  assign guiautor.in-acidente                = int(import-guia-intrcao.idi-acid).
     1995   
     1996                  assign guiautor.int-5                      = int(import-guia-intrcao.cod-regim-intrcao)
     1997                         guiautor.cr-internacao              = trim(import-guia-intrcao.cod-caract-atendim)
     1998                         guia-autoriz-comp.dat-suger-intrcao = import-guia-intrcao.dt-internacao
     1999                         guia-autoriz-comp.log-prev-opme     = import-guia-intrcao.log-opme
     2000                         guia-autoriz-comp.log-prev-qui      = import-guia-intrcao.log-quimio
     2001                         guiautor.ds-ind-clinica             = trim(import-guia-intrcao.des-indcao-clinic)
     2002                         guiautor.tp-inter                   = int(import-guia-intrcao.cdn-tip-inter)
     2003                         guiautor.cd-cid                     = (if  import-guia-intrcao.cod-cid-princ <> ?
     2004                                                                and import-guia-intrcao.cod-cid-princ <> ""
     2005                                                                then caps(trim(import-guia-intrcao.cod-cid-princ))
     2006                                                                else "")
     2007                         guiautor.cd-cid1                    = (if  import-guia-intrcao.cod-cid-2 <> ?
     2008                                                                and import-guia-intrcao.cod-cid-2 <> ""
     2009                                                                then caps(trim(import-guia-intrcao.cod-cid-2))
     2010                                                                else "")
     2011                         guiautor.cd-cid2                    = (if  import-guia-intrcao.cod-cid-3 <> ?
     2012                                                                and import-guia-intrcao.cod-cid-3 <> ""
     2013                                                                then caps(trim(import-guia-intrcao.cod-cid-3))
     2014                                                                else "")
     2015                         guiautor.cd-cid3                    = (if import-guia-intrcao.cod-cid-4 <> ?
     2016                                                                and import-guia-intrcao.cod-cid-4 <> ""
     2017                                                                then caps(trim(import-guia-intrcao.cod-cid-4))
     2018                                                                else "").
     2019   
     2020                  case int(import-guia-intrcao.cdn-tip-inter):
     2021                      when 1 then guiautor.in-classe-nota = 4.  /* Clinica */
     2022                      when 2 then guiautor.in-classe-nota = 5.  /* Cirurgica */
     2023                      when 3 then guiautor.in-classe-nota = 6.  /* Obstetrica */
     2024                      when 4 then guiautor.in-classe-nota = 11. /* Pediatrica */
     2025                      when 5 then guiautor.in-classe-nota = 12. /* Psiquiatrica */
     2026                  end case.
     2027   
     2028                  run cria-movimentos(input "INTE",
     2029                                      input import-guia-intrcao.num-seqcial-guia).
     2030                end.
     2031   
     2032           when "P" /* Prorrogacao */
     2033           then do:
     2034                  assign guiautor.in-classe-nota               = 26
     2035                         guia-autoriz-comp.cdn-acomoda-solicit = int(trim(import-guia-prorrog.ind-tip-acomoda-solicitad))
     2036                         guiautor.ds-ind-clinica               = trim(import-guia-prorrog.des-indic-clinic).
     2037   
     2038                  run cria-movimentos(input "PROR",
     2039                                      input import-guia-prorrog.num-seqcial-guia).
     2040                end.
     2041   
     2042           when "O" /* Odontologia */
     2043           then do:
     2044                  assign guiautor.in-classe-nota        = 7                                      
     2045                         guiautor.dt-termino-tratamento = import-guia-odonto.dat-term-tratam     
     2046                         guiautor.tp-atend              = int(import-guia-odonto.ind-tip-atendim)
     2047                         guiautor.cd-faturamento        = trim(import-guia-odonto.ind-tip-faturam).
     2048   
     2049                  run cria-movimentos(input "ODON",
     2050                                      input import-guia-odonto.num-seqcial-guia).
     2051                end.
     2052       end case.
     2053   
     2054       /* ------------------ CRIA ANEXOS CLINICOS TISS ------------- */
     2055       assign guia-autoriz-comp.cod-livre-10     = ""
     2056              guia-autoriz-comp.des-cipa-his     = ""
     2057              guia-autoriz-comp.des-inf-re       = ""
     2058              guia-autoriz-comp.des-cirurgia-ant = "".
     2059   
     2060       for each import-anexo-solicit
     2061          where import-anexo-solicit.num-seq-import = import-guia.num-seqcial
     2062                no-lock:
     2063           
     2064           assign guia-autoriz-comp.cod-telef-solic = import-anexo-solicit.nr-telefone
     2065                  guia-autoriz-comp.nom-email-solic = import-anexo-solicit.nom-email.
     2066   
     2067           case trim(import-anexo-solicit.ind-tip-anexo):
     2068               when "1" /* Quimioterapia */
     2069               then do:
     2070                      find import-anexo-quimio where import-anexo-quimio.num-seqcial-import-anexo = import-anexo-solicit.num-seqcial
     2071                                                     no-lock no-error.
     2072   
     2073                      if avail import-anexo-quimio
     2074                      then assign guia-autoriz-comp.val-peso-bnfciar               = import-anexo-quimio.val-peso-bnfciar
     2075                                  guia-autoriz-comp.val-alt-bnfciar                = import-anexo-quimio.val-alt-bnfciar
     2076                                  guia-autoriz-comp.val-sup-cor-bnfciar            = import-anexo-quimio.val-sup-cor-bnfciar
     2077                                  guia-autoriz-comp.cdn-tip-qui                    = int(import-anexo-quimio.ind-tip-quimio)
     2078                                  guia-autoriz-comp.dat-diag                       = import-anexo-quimio.dat-diag
     2079                                  guia-autoriz-comp.cdn-estad                      = int(import-anexo-quimio.cod-estag)
     2080                                  guia-autoriz-comp.cdn-finalid-tratam             = int(import-anexo-quimio.ind-finalid-tratam)
     2081                                  guia-autoriz-comp.cdn-ecf                        = int(import-anexo-quimio.cod-classif-capac-funcnal)
     2082                                  guia-autoriz-comp.num-ciclo-previs               = import-anexo-quimio.num-ciclo
     2083                                  guia-autoriz-comp.num-ciclo-atual                = import-anexo-quimio.num-ciclo-atual
     2084                                  guia-autoriz-comp.num-interv-ciclo               = import-anexo-quimio.num-interv-ciclo
     2085                                  guia-autoriz-comp.des-plano-terap                = trim(import-anexo-quimio.des-plano-terap)
     2086                                              substr(guia-autoriz-comp.cod-livre-10,1001,1000) = string(trim(import-anexo-solicit.cod-livre-10),"x(1000)") /* Observacoes */
     2087                                              substr(guia-autoriz-comp.des-cipa-his,1,1000)    = string(trim(import-anexo-quimio.des-diag),"x(1000)")
     2088                                  substr(guia-autoriz-comp.des-inf-re,1,1000)      = string(trim(import-anexo-quimio.des-inform),"x(1000)")
     2089                                  substr(guia-autoriz-comp.des-cirurgia-ant,1,40)  = string(trim(import-anexo-quimio.des-cirurgia-ant),"x(40)")
     2090                                  guia-autoriz-comp.dat-realiz-cirurgia            = import-anexo-quimio.dt-realizacao
     2091                                  guia-autoriz-comp.des-area                       = trim(import-anexo-quimio.des-area)
     2092                                  guia-autoriz-comp.dat-aplic-radio                = import-anexo-quimio.dat-aplic-radio
     2093                                  guia-autoriz-comp.cod-livre-1                    = import-anexo-quimio.cod-cid-princ + ";"
     2094                                                                                   + import-anexo-quimio.cod-cid-2 + ";"
     2095                                                                                   + import-anexo-quimio.cod-cid-3 + ";"
     2096                                                                                   + import-anexo-quimio.cod-cid-4  
     2097                                  guia-autoriz-comp.cod-livre-6                    = trim(import-anexo-quimio.cod-livre-1) + ";" /* Nome do profissional solicitante */ 
     2098                                                                                   + trim(import-anexo-quimio.cod-livre-3) + ";" /* Telefone Profissional Solicitante */
     2099                                                                                   + trim(import-anexo-quimio.cod-livre-4).      /* Email profissional solicitante */   
     2100   
     2101                      run cria-movimentos(input "QUIM",
     2102                                          input import-anexo-quimio.num-seqcial).
     2103                    end.
     2104   
     2105               when "2" /* Radioterapia */
     2106               then do:
     2107                      find import-anexo-radio where import-anexo-radio.num-seqcial-import-anexo = import-anexo-solicit.num-seqcial
     2108                                                    no-lock no-error.
     2109   
     2110                      if avail import-anexo-radio
     2111                      then assign guia-autoriz-comp.num-campo                      = import-anexo-radio.qti-campos
     2112                                  guia-autoriz-comp.num-dosag-dia                  = import-anexo-radio.qtd-dosag-diaria
     2113                                  guia-autoriz-comp.num-dosag-tot                  = import-anexo-radio.qtd-dosag-tot
     2114                                  guia-autoriz-comp.num-dia-previs                 = import-anexo-radio.num-dias
     2115                                  guia-autoriz-comp.dat-previs-inic                = import-anexo-radio.dat-inic-adm
     2116                                  guia-autoriz-comp.dat-livre-1                    = import-anexo-radio.dat-diag /* Data do diagnostico */
     2117                                  guia-autoriz-comp.num-livre-1                    = int(import-anexo-radio.cod-estag)
     2118                                  guia-autoriz-comp.num-livre-3                    = int(import-anexo-radio.ind-finalid-tratam)
     2119                                  guia-autoriz-comp.cdn-diag-img                   = int(import-anexo-radio.cdn-diag-img)
     2120                                  guia-autoriz-comp.num-livre-2                    = int(import-anexo-radio.cod-classif-capac-funcnal)
     2121                                  guia-autoriz-comp.cod-livre-2                    = import-anexo-radio.cod-cid-princ + ";"
     2122                                                                                   + import-anexo-radio.cod-cid-2 + ";"
     2123                                                                                   + import-anexo-radio.cod-cid-3 + ";"
     2124                                                                                   + import-anexo-radio.cod-cid-4
     2125                                              substr(guia-autoriz-comp.cod-livre-10,2001,1000) = string(trim(import-anexo-solicit.cod-livre-10),"x(1000)") /* Observacoes */
     2126                                              substr(guia-autoriz-comp.des-cipa-his,1001,1000) = string(trim(import-anexo-radio.des-diag),"x(1000)")
     2127                                  substr(guia-autoriz-comp.des-inf-re,1001,1000)   = string(trim(import-anexo-radio.des-inform),"x(1000)")
     2128                                  substr(guia-autoriz-comp.des-cirurgia-ant,41,40) = string(trim(import-anexo-radio.des-cirurgia-ant),"x(40)")
     2129                                  guia-autoriz-comp.dat-livre-2                    = import-anexo-radio.dat-realiz
     2130                                  guia-autoriz-comp.des-qui                        = trim(import-anexo-radio.des-quimio)
     2131                                  guia-autoriz-comp.dat-aplic-qui                  = import-anexo-radio.dat-aplic
     2132                                  guia-autoriz-comp.cod-livre-7                    = trim(import-anexo-radio.cod-livre-1) + ";" /* Nome do profissional solicitante */
     2133                                                                                   + trim(import-anexo-radio.cod-livre-3) + ";" /* Telefone Profissional Solicitante */
     2134                                                                                   + trim(import-anexo-radio.cod-livre-4).      /* Email profissional solicitante */
     2135   
     2136                      run cria-movimentos(input "RADI",
     2137                                          input import-anexo-radio.num-seqcial).
     2138                    end.
     2139   
     2140               when "3" /* OPME */
     2141               then do:
     2142                      find import-anexo-opme where import-anexo-opme.num-seqcial-import-anexo = import-anexo-solicit.num-seqcial
     2143                                                   no-lock no-error.
     2144   
     2145                      if avail import-anexo-opme
     2146                      then assign guia-autoriz-comp.des-justif-tec                 = trim(import-anexo-opme.des-justificativa)      /* JUSTFICATIVA TECNICA  */
     2147                                  guia-autoriz-comp.des-espcif-mater               = trim(import-anexo-opme.des-especif-mater) /* ESPECIFICACAO MATERIAL */
     2148                                  guia-autoriz-comp.cod-livre-8                    = trim(import-anexo-opme.cod-livre-1) + ";" /* Nome do profissional solicitante */
     2149                                                                                   + trim(import-anexo-opme.cod-livre-3) + ";" /* Telefone Profissional Solicitante */
     2150                                                                                   + trim(import-anexo-opme.cod-livre-4)       /* Email profissional solicitante */
     2151                                  substr(guia-autoriz-comp.cod-livre-10,3001,1000) = string(trim(import-anexo-solicit.cod-livre-10),"x(1000)") /* Observacoes */.
     2152   
     2153                      run cria-movimentos(input "OPME",
     2154                                          input import-anexo-opme.num-seqcial).
     2155                    end.
     2156   
     2157               when "4" /* Odontologia */
     2158               then do:
     2159                      find import-anexo-odonto where import-anexo-odonto.num-seqcial-import-anexo = import-anexo-solicit.num-seqcial
     2160                                                     no-lock no-error.
     2161                     
     2162                      if avail import-anexo-odonto
     2163                      then do:
     2164                             RUN escrever-log("@@@@@criando guiainod ano: " + STRING(aa-guia-atendimento-aux) + " guia:" + STRING(nr-guia-atendimento-aux)).
     2165   
     2166                             create guiainod.
     2167                             assign guiainod.cd-unidade                = paramecp.cd-unimed     
     2168                                    guiainod.aa-guia-atendimento       = aa-guia-atendimento-aux
     2169                                    guiainod.nr-guia-atendimento       = nr-guia-atendimento-aux
     2170                                    guiainod.nr-sequencia              = 0
     2171                                    guiainod.lg-doencas-periodontais   = import-anexo-odonto.log-doenc-periodts
     2172                                    guiainod.lg-altera-tecidos-moles   = import-anexo-odonto.log-alter-tecidos-moles
     2173                                    guiainod.dt-registro               = today
     2174                                    guiainod.ds-observacao             = import-anexo-odonto.des-observacao
     2175                                    guiainod.cd-userid                 = v_cod_usuar_corren
     2176                                    guiainod.dt-atualizacao            = today.
     2177   
     2178                             if  import-anexo-odonto.cod-livre-6 <> ? 
     2179                             and import-anexo-odonto.cod-livre-6 <> ""
     2180                             then assign guiainod.nm-prest-exec-compl       = entry(1, import-anexo-odonto.cod-livre-6, ";")
     2181                                         guiainod.char-2                    = entry(2, import-anexo-odonto.cod-livre-6, ";")
     2182                                         guiainod.nr-conse-prest-exec-compl = entry(3, import-anexo-odonto.cod-livre-6, ";")
     2183                                         guiainod.uf-conse-prest-exec-compl = entry(4, import-anexo-odonto.cod-livre-6, ";")
     2184                                         guiainod.char-1                    = entry(5, import-anexo-odonto.cod-livre-6, ";").
     2185                             
     2186                             for each import-anexo-odonto-mov
     2187                                where import-anexo-odonto-mov.num-seqcial-anexo = import-anexo-odonto.num-seqcial
     2188                                      no-lock:
     2189                                 if import-anexo-odonto-mov.tp-dente-regiao <> ""
     2190                                 then assign guiainod.ds-situacao-inicial [int(import-anexo-odonto-mov.tp-dente-regiao)] = trim(import-anexo-odonto-mov.ind-sit-inicial).
     2191                             end. /* each import-anexo-odonto-mov */
     2192   
     2193                             validate guiainod.
     2194                             release guiainod.
     2195                           end.
     2196                    end.
     2197           end case.
     2198       end. /* each import-anexo-solicit */
     2199   
     2200       /* ----------------- GRAVA HISTORICO DA GUIA ------------------------ */
     2201       assign nr-seq-histor-aux = 1.
     2202   
     2203       for each import-guia-histor
     2204          where import-guia-histor.val-seq-guia = import-guia.num-seqcial
     2205                no-lock:
     2206   
     2207           RUN escrever-log("@@@@@criando guia-his ano: " + STRING(aa-guia-atendimento-aux) + " guia:" + STRING(nr-guia-atendimento-aux)).
     2208   
     2209           create guia-his.
     2210           assign guia-his.cd-unidade          = paramecp.cd-unimed
     2211                  guia-his.aa-guia-atendimento = aa-guia-atendimento-aux
     2212                  guia-his.nr-guia-atendimento = nr-guia-atendimento-aux
     2213                  guia-his.nr-sequencia-alt    = nr-seq-histor-aux
     2214                  guia-his.in-lib-guias-alt    = guiautor.in-liberado-guias
     2215                  guia-his.cd-userid-alt       = import-guia-histor.cd-userid-alt
     2216                  guia-his.dt-alt              = import-guia-histor.dt-alt
     2217                  guia-his.cd-userid           = v_cod_usuar_corren
     2218                  guia-his.dt-atualizacao      = today
     2219                  guia-his.char-4              = "AT0210A1".
     2220   
     2221           validate guia-his.
     2222           release guia-his.
     2223   
     2224           assign nr-seq-histor-aux = nr-seq-histor-aux + 1.
     2225       end. /* each import-guia-histor */
     2226       /* ----------------------------------------------------------------- */
     2227   
     2228       validate guiautor.
     2229       release guiautor.
     2230   
     2231       validate guia-autoriz-comp.
     2232       release guia-autoriz-comp.
     2233   
     2234   end procedure.
     2235   
     2236   /* ----------------------------------------------------------------- */
     2237   procedure cria-movimentos:
     2238   
     2239       def input parameter in-tipo-guia-par as char format "x(4)" no-undo.
     2240       def input parameter val-seq-guia-par as int                no-undo.
     2241   
     2242       RUN escrever-log("@@@@@vai ler import-guia-movto. in-tipo-guia-par: " + STRING(in-tipo-guia-par) + " val-seq-guia-par: " + string(val-seq-guia-par)).
     2243   
     2244       for each import-guia-movto
     2245          where import-guia-movto.ind-tip-guia = in-tipo-guia-par
     2246            and import-guia-movto.val-seq-guia = val-seq-guia-par
     2247                no-lock:
     2248   
     2249           RUN escrever-log("@@@@@servico: " + STRING(import-guia-movto.cod-movto-guia) + " tipo: " + import-guia-movto.ind-tip-movto-guia
     2250                            + " Pacote?: " + STRING(import-guia-movto.log-livre-1)).
     2251   
     2252           /* Logica de Pacotes*/
     2253           if import-guia-movto.log-livre-1
     2254           then do:
     2255                  assign cd-pacote = substr(string(int(import-guia-movto.cod-movto-guia),"99999999"),1,2) + 
     2256                                     substr(string(int(import-guia-movto.cod-movto-guia),"99999999"),3,2) +
     2257                                     substr(string(int(import-guia-movto.cod-movto-guia),"99999999"),5,3) +
     2258                                     substr(string(int(import-guia-movto.cod-movto-guia),"99999999"),8,1).           
     2259                  
     2260                  run filtra-paproins (input cd-modalidade-aux,                 
     2261                                       input nr-ter-adesao-aux,                    
     2262                                       input import-guia.cd-unidade-carteira,           
     2263                                       input today,                    
     2264                                       input cd-pacote,                     
     2265                                       input import-guia.cd-unidade-principal,          
     2266                                       input import-guia.cd-prestador-principal).              
     2267                                                                                                   
     2268                  if r-paproins <> ?                                                     
     2269                  then find paproins where rowid(paproins) = r-paproins no-lock no-error.
     2270           
     2271                  if not avail paproins
     2272                  then do:
     2273                         IF import-guia-movto.ind-tip-guia <> ?
     2274                         THEN char-aux1 = string(import-guia-movto.ind-tip-guia).
     2275                         ELSE char-aux1 = "nulo".
     2276                         IF import-guia-movto.val-seq-guia <> ?
     2277                         THEN char-aux2 = string(import-guia-movto.val-seq-guia).
     2278                         ELSE char-aux2 = "nulo".
     2279                         IF import-guia-movto.cod-movto-guia <> ?
     2280                         THEN char-aux3 = string(import-guia-movto.cod-movto-guia).
     2281                         ELSE char-aux3 = "nulo".
     2282                         
     2283                         run grava-erro(input import-guia.num-seqcial-control,                                        
     2284                                        input "import-guia",                                                          
     2285                                        input "Pacote nao cadastrado. Tp.Guia(import-guia-movto.ind-tip-guia): " + char-aux1 +
     2286                                              " Nro.Seq.Guia(import-guia-movto.val-seq-guia): "                  + char-aux2 + 
     2287                                              " Pacote: " + char-aux3,                      
     2288                                        input today,                                                                  
     2289                                        input "Informe um pacote Valido").                                                                                                                        
     2290                         return.                                                                                      
     2291                      end.
     2292           
     2293                  if avail paproins        
     2294                  then do:
     2295                          for each pacproce where pacproce.cd-pacote            =  paproins.cd-pacote    
     2296                                              and pacproce.cd-unidade           =  paproins.cd-unidade   
     2297                                              and pacproce.cd-prestador         =  paproins.cd-prestador 
     2298                                              and pacproce.cd-modalidade        =  paproins.cd-modalidade
     2299                                              and pacproce.cd-plano             =  paproins.cd-plano     
     2300                                              and pacproce.cd-tipo-plano        =  paproins.cd-tipo-plano
     2301                                              and pacproce.dt-inicio-vigencia   =  paproins.dt-inicio-vigencia
     2302                                              and pacproce.dt-limite            =  paproins.dt-limite no-lock:
     2303           
     2304                       
     2305                              create procguia.
     2306                              assign procguia.cd-unidade              = paramecp.cd-unimed
     2307                                     procguia.aa-guia-atendimento     = aa-guia-atendimento-aux
     2308                                     procguia.nr-guia-atendimento     = nr-guia-atendimento-aux
     2309                                     procguia.nr-processo             = nr-processo-proc-aux
     2310                                     procguia.nr-seq-digitacao        = 0
     2311                                     procguia.cd-esp-amb              = pacproce.cd-esp-amb        
     2312                                     procguia.cd-grupo-proc-amb       = pacproce.cd-grupo-proc-amb 
     2313                                     procguia.cd-procedimento         = pacproce.cd-procedimento   
     2314                                     procguia.dv-procedimento         = pacproce.dv-procedimento   
     2315                                     procguia.qt-procedimento         = import-guia-movto.qtd-autoriza
     2316                                     procguia.int-11                  = import-guia-movto.qtd-solicitad
     2317                                     procguia.in-nivel-prestador      = 01
     2318                                     procguia.dt-atualizacao          = today
     2319                                     procguia.dt-realizacao           = ?
     2320                                     procguia.hr-realizacao           = substring(string(time,"HH:MM"),1,2) + substring(string(time,"HH:MM"),4,2)
     2321                                     procguia.cd-modalidade           = cd-modalidade-aux 
     2322                                     procguia.cd-usuario              = cd-usuario-aux
     2323                                     procguia.nr-ter-adesao           = nr-ter-adesao-aux
     2324                                     procguia.cd-clinica              = import-guia.cd-clinica
     2325                                     procguia.cd-unidade-clinica      = paramecp.cd-unimed
     2326                                     procguia.cd-unidade-prestador    = cd-unidade-prestador-aux
     2327                                     procguia.cd-prestador            = cd-prestador-aux
     2328                                     procguia.cd-esp-prest-executante = cd-esp-prest-executante-aux
     2329                                     procguia.cd-tipo-vinculo         = cd-vinculo-aux
     2330                                     procguia.cd-validacao            = import-guia-movto.cd-validacao
     2331                                     procguia.cd-tipo-cob             = import-guia-movto.num-livre-3 /* Validacao para cobranca */
     2332                                     procguia.cd-tipo-pagamento       = import-guia-movto.num-livre-4 /* Validacao para pagamento */
     2333                                     procguia.cd-classe-erro          = import-guia-movto.num-livre-2
     2334                                     procguia.cd-cod-glo              = import-guia-movto.num-livre-1
     2335                                     procguia.cd-userid               = v_cod_usuar_corren
     2336                                     procguia.nm-prest-exec-compl     = tmp-prest-exec.nm-prest-exec-compl
     2337                                     procguia.char-3                  = tmp-prest-exec.nm-conselho
     2338                                     procguia.nr-registro             = string(tmp-prest-exec.nr-registro)
     2339                                     procguia.uf-conselho             = tmp-prest-exec.uf-conselho
     2340                                     procguia.char-2                  = tmp-prest-exec.cd-cbo
     2341                                     procguia.vl-principal            = pacproce.vl-procedimento
     2342                                     procguia.vl-taxa-participacao    = IF import-guia-movto.val-co-partic   = ? THEN 0 ELSE import-guia-movto.val-co-partic  
     2343                                     procguia.vl-movimento-total      = (procguia.vl-principal + import-guia-movto.val-taxas-adm)
     2344                                     procguia.cd-pacote               = int(import-guia-movto.cod-movto-guia).
     2345                               
     2346                             
     2347                              /* Busca do mdulo*/     
     2348                              
     2349                               find first pl-mo-am where pl-mo-am.cd-modalidade = cd-modalidade-aux                                                                          
     2350                                                     and pl-mo-am.cd-plano      = cd-plano-aux                                                                               
     2351                                                     and pl-mo-am.cd-tipo-plano = cd-tipo-plano-aux                                                                          
     2352                                                     and pl-mo-am.cd-amb        = int(string(pacproce.cd-esp-amb)        +  
     2353                                                                                      string(pacproce.cd-grupo-proc-amb) + 
     2354                                                                                      string(pacproce.cd-procedimento)   +
     2355                                                                                      string(pacproce.dv-procedimento))  no-lock no-error.                                    
     2356                               if avail pl-mo-am                                                                                                                             
     2357                               then do:                                                                                                                                      
     2358                                       assign procguia.cd-tab-preco = pl-mo-am.cd-tab-preco                                                                                  
     2359                                              procguia.cd-modulo    = pl-mo-am.cd-modulo.                                                                                    
     2360                                                                                                                                                                             
     2361                                       find first precproc where precproc.cd-tab-preco = pl-mo-am.cd-tab-preco no-lock no-error.                                             
     2362                                                                                                                                                                             
     2363                                       if avail precproc                                                                                                                     
     2364                                       then assign procguia.cd-forma-pagto     = precproc.cd-forma-pagto                                                                     
     2365                                                   procguia.cd-forma-pagto-cob = precproc.cd-forma-pagto.                                                                    
     2366                                                                                                                                                                             
     2367                                   end.                                                                                                                                      
     2368                               else do:                                                                                                                                      
     2369                                       /* ------------------- TABELA MOEDAS E CARENCIAS COBRANCA ------------------ */                                                       
     2370                                       find first plamodpr                                                                                                                   
     2371                                            where plamodpr.cd-modalidade          = cd-modalidade-aux                                                                        
     2372                                              and plamodpr.cd-plano               = cd-plano-aux                                                                             
     2373                                              and plamodpr.cd-tipo-plano          = cd-tipo-plano-aux                                                                        
     2374                                              and plamodpr.in-procedimento-insumo = "P"                                                                                      
     2375                                                  no-lock no-error.                                                                                                          
     2376                                                                                                                                                                             
     2377                                       if avail plamodpr                                                                                                                     
     2378                                       then do:                                                                                                                              
     2379                                              assign procguia.cd-tab-preco = plamodpr.cd-tab-preco
     2380                                                     procguia.cd-modulo    = plamodpr.cd-modulo.  
     2381                                                                                                                                                                             
     2382                                              find first precproc where precproc.cd-tab-preco = plamodpr.cd-tab-preco no-lock no-error.                                      
     2383                                                                                                                                                                             
     2384                                              if avail precproc                                                                                                              
     2385                                              then assign procguia.cd-forma-pagto     = precproc.cd-forma-pagto                                                              
     2386                                                          procguia.cd-forma-pagto-cob = precproc.cd-forma-pagto.                                                             
     2387                                            end.                                                                                                                             
     2388                                                                                                                                                                             
     2389                                   end.                                                                                                                                      
     2390           
     2391                              /* -------------- QTD MOEDA PAGTO ------------------------- */
     2392                              if paramecp.cd-unimed = import-guia.cd-unidade-carteira
     2393                              then do:
     2394                                     find propost where propost.cd-modalidade = cd-modalidade-aux 
     2395                                                    and propost.nr-ter-adesao = nr-ter-adesao-aux
     2396                                                        no-lock no-error.
     2397                              
     2398                                     if avail propost
     2399                                     then assign procguia.cd-tab-preco-proc = propost.cd-tab-preco-proc.
     2400                                   end.
     2401                              else do:
     2402                                     find unicamco where unicamco.cd-unidade = import-guia.cd-unidade-carteira
     2403                                                     and unicamco.dt-limite >= import-guia.dat-solicit
     2404                                                         no-lock no-error.
     2405                              
     2406                                     if avail unicamco
     2407                                     then assign procguia.cd-tab-preco-proc = unicamco.cd-tab-preco-proc-cob.
     2408                                   end.
     2409                              
     2410                          
     2411                              create proced-guia-comp.
     2412                              assign proced-guia-comp.cdn-unid             = paramecp.cd-unimed         
     2413                                     proced-guia-comp.num-ano-guia-atendim = aa-guia-atendimento-aux
     2414                                     proced-guia-comp.num-guia-atendim     = nr-guia-atendimento-aux
     2415                                     proced-guia-comp.num-proces           = nr-processo-proc-aux   
     2416                                     proced-guia-comp.num-seq-digitac      = 0
     2417                                     proced-guia-comp.dat-previs-adm       = import-guia-movto.dat-previs. /* radio e quimio */
     2418           
     2419                              
     2420                              validate procguia.
     2421                              release procguia.
     2422                              
     2423                              validate proced-guia-comp.
     2424                              release proced-guia-comp.
     2425           
     2426                              assign nr-processo-proc-aux = nr-processo-proc-aux + 1.
     2427           
     2428                          end.
     2429                         
     2430                          for each pacinsum where pacinsum.cd-pacote           =  paproins.cd-pacote    
     2431                                              and pacinsum.cd-unidade          =  paproins.cd-unidade   
     2432                                              and pacinsum.cd-prestador        =  paproins.cd-prestador 
     2433                                              and pacinsum.cd-modalidade       =  paproins.cd-modalidade
     2434                                              and pacinsum.cd-plano            =  paproins.cd-plano     
     2435                                              and pacinsum.cd-tipo-plano       =  paproins.cd-tipo-plano
     2436                                              and pacinsum.dt-inicio-vigencia  =  paproins.dt-inicio-vigencia
     2437                                              and pacinsum.dt-limite           =  paproins.dt-limite /* dt-fim-vigencia*/    
     2438                                                  no-lock:
     2439           
     2440                              create insuguia.
     2441                              assign insuguia.cd-unidade              = paramecp.cd-unimed
     2442                                     insuguia.aa-guia-atendimento     = aa-guia-atendimento-aux
     2443                                     insuguia.nr-guia-atendimento     = nr-guia-atendimento-aux
     2444                                     insuguia.nr-processo             = 0
     2445                                     insuguia.nr-seq-digitacao        = nr-seq-digitacao-ins-aux
     2446                                     insuguia.cd-tipo-insumo          = pacinsum.cd-tipo-insumo
     2447                                     insuguia.cd-insumo               = pacinsum.cd-insumo
     2448                                     insuguia.cd-modulo               = import-guia-movto.cd-modulo
     2449                                     insuguia.qt-insumo               = import-guia-movto.qtd-autoriza
     2450                                     insuguia.dec-1                   = import-guia-movto.qtd-solicitad
     2451                                     insuguia.dt-atualizacao          = TODAY
     2452                                     insuguia.cd-userid               = v_cod_usuar_corren
     2453                                     insuguia.dt-realizacao           = ?
     2454                                     insuguia.hr-realizacao           = substring(string(time,"HH:MM"),1,2) + substring(string(time,"HH:MM"),4,2)
     2455                                     insuguia.cd-modalidade           = cd-modalidade-aux
     2456                                     insuguia.cd-usuario              = cd-usuario-aux
     2457                                     insuguia.nr-ter-adesao           = nr-ter-adesao-aux
     2458                                     insuguia.cd-unidade-prestador    = cd-unidade-prestador-aux
     2459                                     insuguia.cd-prestador            = cd-prestador-aux
     2460                                     insuguia.cd-esp-prest-executante = cd-esp-prest-executante-aux
     2461                                     insuguia.cd-tipo-vinculo         = cd-vinculo-aux
     2462                                     insuguia.cd-validacao            = import-guia-movto.cd-validacao
     2463                                     insuguia.cd-tipo-cob             = import-guia-movto.num-livre-3 /* Validacao para cobranca */
     2464                                     insuguia.cd-tipo-pagamento       = import-guia-movto.num-livre-4 /* Validacao para pagamento */
     2465                                     insuguia.cd-classe-erro          = import-guia-movto.num-livre-2
     2466                                     insuguia.cd-cod-glo              = import-guia-movto.num-livre-1
     2467                                     insuguia.cd-userid               = v_cod_usuar_corren
     2468                                     insuguia.nm-prest-exec-compl     = tmp-prest-exec.nm-prest-exec-compl
     2469                                     insuguia.char-3                  = tmp-prest-exec.nm-conselho
     2470                                     insuguia.nr-registro             = string(tmp-prest-exec.nr-registro)
     2471                                     insuguia.uf-conselho             = tmp-prest-exec.uf-conselho
     2472                                     insuguia.char-2                  = tmp-prest-exec.cd-cbo
     2473                                     insuguia.vl-insumo-cob           = pacinsum.vl-insumo
     2474                                     insuguia.vl-taxa-participacao    = if import-guia-movto.val-co-partic   = ? then 0 else import-guia-movto.val-co-partic  
     2475                                     insuguia.vl-movimento-total      = (insuguia.vl-insumo-cob + import-guia-movto.val-taxas-adm)
     2476                                     insuguia.cd-pacote               = int(import-guia-movto.cod-movto-guia).  
     2477                                 
     2478                              
     2479                          
     2480                                     /* Busca do mdulo*/                                                                                                                            
     2481                                                                                                                                                                             
     2482                               find first partinsu where partinsu.cd-modalidade  = cd-modalidade-aux                                                                          
     2483                                                     and partinsu.cd-plano       = cd-plano-aux                                                                               
     2484                                                     and partinsu.cd-tipo-plano  = cd-tipo-plano-aux                                                                          
     2485                                                     and partinsu.cd-tipo-insumo = pacinsum.cd-tipo-insumo
     2486                                                     and partinsu.cd-insumo      = pacinsum.cd-insumo no-lock no-error.                                    
     2487                               if not avail partinsu 
     2488                               then do:
     2489                                      find first partinsu where partinsu.cd-modalidade  = cd-modalidade-aux                                                                          
     2490                                                            and partinsu.cd-plano       = cd-plano-aux                                                                               
     2491                                                            and partinsu.cd-tipo-plano  = cd-tipo-plano-aux                                                                          
     2492                                                            and partinsu.cd-tipo-insumo = pacinsum.cd-tipo-insumo
     2493                                                            and partinsu.cd-insumo      = 0 no-lock no-error.    
     2494                                   end.
     2495                                if avail partinsu
     2496                                then do:                                                                                                                                      
     2497                                       assign insuguia.cd-tab-preco = partinsu.cd-tab-preco                                                                                  
     2498                                              insuguia.cd-modulo    = partinsu.cd-modulo.                                                                                    
     2499                                                                                                                                                                             
     2500                                       find first precproc where precproc.cd-tab-preco = partinsu.cd-tab-preco no-lock no-error.                                             
     2501                                                                                                                                                                             
     2502                                       if avail precproc                                                                                                                     
     2503                                       then assign insuguia.cd-forma-pagto     = precproc.cd-forma-pagto                                                                     
     2504                                                   insuguia.cd-forma-pagto-cob = precproc.cd-forma-pagto.                                                                    
     2505                                                                                                                                                                             
     2506                                   end.                                                                                                                                      
     2507                               else do:                                                                                                                                      
     2508                                       /* ------------------- TABELA MOEDAS E CARENCIAS COBRANCA ------------------ */                                                       
     2509                                       find first plamodpr                                                                                                                   
     2510                                            where plamodpr.cd-modalidade          = cd-modalidade-aux                                                                        
     2511                                              and plamodpr.cd-plano               = cd-plano-aux                                                                             
     2512                                              and plamodpr.cd-tipo-plano          = cd-tipo-plano-aux                                                                        
     2513                                              and plamodpr.in-procedimento-insumo = "I"                                                                                      
     2514                                                  no-lock no-error.                                                                                                          
     2515                                                                                                                                                                             
     2516                                       if avail plamodpr                                                                                                                     
     2517                                       then do:                                                                                                                              
     2518                                              assign insuguia.cd-tab-preco = plamodpr.cd-tab-preco
     2519                                                     insuguia.cd-modulo    = plamodpr.cd-modulo. 
     2520                                                                                                                                                                             
     2521                                              find first precproc where precproc.cd-tab-preco = plamodpr.cd-tab-preco no-lock no-error.                                      
     2522                                                                                                                                                                             
     2523                                              if avail precproc                                                                                                              
     2524                                              then assign insuguia.cd-forma-pagto     = precproc.cd-forma-pagto                                                              
     2525                                                          insuguia.cd-forma-pagto-cob = precproc.cd-forma-pagto.                                                             
     2526                                            end.                                                                                                                             
     2527                                                                                                                                                                             
     2528                                   end.                         
     2529           
     2530                              
     2531                              /* -------------- QTD MOEDA PAGTO ------------------------- */
     2532                              if paramecp.cd-unimed = import-guia.cd-unidade-carteira
     2533                              then do:
     2534                                     find propost where propost.cd-modalidade = cd-modalidade-aux
     2535                                                    and propost.nr-ter-adesao = nr-ter-adesao-aux
     2536                                                        no-lock no-error.
     2537                              
     2538                                     if avail propost
     2539                                     then assign insuguia.cd-tab-preco-proc-cob = propost.cd-tab-preco-proc.
     2540                                   end.
     2541                              else do:
     2542                                     find unicamco where unicamco.cd-unidade = import-guia.cd-unidade-carteira
     2543                                                     and unicamco.dt-limite >= import-guia.dat-solicit
     2544                                                         no-lock no-error.
     2545                              
     2546                                     if avail unicamco
     2547                                     then assign insuguia.cd-tab-preco-proc-cob = unicamco.cd-tab-preco-proc-cob.
     2548                                   end.
     2549                              
     2550                              /* -------------- DESCRICAO INSUMO GENERICO ------------------------------ */
     2551                              if  import-guia-movto.des-insumo <> ?
     2552                              and import-guia-movto.des-insumo <> ""
     2553                              then assign insuguia.char-4 = import-guia-movto.des-insumo. /* Descricao do insumo generico */
     2554                              
     2555                          
     2556                              
     2557                              create insumo-guia-comp.
     2558                              assign insumo-guia-comp.cdn-unid             = paramecp.cd-unimed                      
     2559                                     insumo-guia-comp.num-ano-guia-atendim = aa-guia-atendimento-aux                 
     2560                                     insumo-guia-comp.num-guia-atendim     = nr-guia-atendimento-aux                 
     2561                                     insumo-guia-comp.num-proces           = 0                                       
     2562                                     insumo-guia-comp.num-seq-digitac      = nr-seq-digitacao-ins-aux                
     2563                                     insumo-guia-comp.cod-opc              = trim(import-guia-movto.des-opc-fabrican)
     2564                                     insumo-guia-comp.cdn-via-adm          = int(import-guia-movto.cdn-via-administ)
     2565                                     insumo-guia-comp.dat-previs-adm       = import-guia-movto.dat-previs
     2566                                     insumo-guia-comp.cdn-freq             = import-guia-movto.cdn-freq.
     2567                              
     2568                              validate insuguia.
     2569                              release insuguia.
     2570                              
     2571                              validate insumo-guia-comp.
     2572                              release insumo-guia-comp.
     2573                          
     2574                              
     2575                              assign nr-seq-digitacao-ins-aux = nr-seq-digitacao-ins-aux + 1.
     2576                  
     2577                          end.
     2578                      end.
     2579                 end.
     2580   
     2581   
     2582           if import-guia-movto.ind-tip-movto-guia = "P" /* Procedimento */
     2583           and not import-guia-movto.log-livre-1 /* true: pacote; false: nao eh pacote */
     2584           then do:
     2585   
     2586                  RUN escrever-log("@@@@@criando procguia ano: " + STRING(aa-guia-atendimento-aux) + " guia:" 
     2587                               + STRING(nr-guia-atendimento-aux) + " movimento: " + STRING(import-guia-movto.cod-movto-guia)).
     2588   
     2589                  create procguia.
     2590                  assign procguia.cd-unidade              = paramecp.cd-unimed
     2591                         procguia.aa-guia-atendimento     = aa-guia-atendimento-aux
     2592                         procguia.nr-guia-atendimento     = nr-guia-atendimento-aux
     2593                         procguia.nr-processo             = nr-processo-proc-aux
     2594                         procguia.nr-seq-digitacao        = 0
     2595                         procguia.cd-esp-amb              = int(substr(string(int(import-guia-movto.cod-movto-guia),"99999999"),1,2))
     2596                         procguia.cd-grupo-proc-amb       = int(substr(string(int(import-guia-movto.cod-movto-guia),"99999999"),3,2))
     2597                         procguia.cd-procedimento         = int(substr(string(int(import-guia-movto.cod-movto-guia),"99999999"),5,3))
     2598                         procguia.dv-procedimento         = int(substr(string(int(import-guia-movto.cod-movto-guia),"99999999"),8,1))
     2599                         procguia.cd-modulo               = import-guia-movto.cd-modulo
     2600                         procguia.qt-procedimento         = import-guia-movto.qtd-autoriza
     2601                         procguia.int-11                  = import-guia-movto.qtd-solicitad
     2602                         procguia.in-nivel-prestador      = 01
     2603                         procguia.dt-atualizacao          = today
     2604                         procguia.dt-realizacao           = ?
     2605                         procguia.hr-realizacao           = substring(string(time,"HH:MM"),1,2) + substring(string(time,"HH:MM"),4,2)
     2606                         procguia.cd-modalidade           = cd-modalidade-aux
     2607                         procguia.nr-ter-adesao           = nr-ter-adesao-aux
     2608                         procguia.cd-usuario              = cd-usuario-aux
     2609                         procguia.cd-clinica              = import-guia.cd-clinica
     2610                         procguia.cd-unidade-clinica      = paramecp.cd-unimed
     2611                         procguia.cd-unidade-prestador    = cd-unidade-prestador-aux
     2612                         procguia.cd-prestador            = cd-prestador-aux
     2613                         procguia.cd-esp-prest-executante = cd-esp-prest-executante-aux
     2614                         procguia.cd-tipo-vinculo         = cd-vinculo-aux
     2615                         procguia.cd-validacao            = import-guia-movto.cd-validacao
     2616                         procguia.cd-tipo-cob             = import-guia-movto.num-livre-3 /* Validacao para cobranca */
     2617                         procguia.cd-tipo-pagamento       = import-guia-movto.num-livre-4 /* Validacao para pagamento */
     2618                         procguia.cd-classe-erro          = import-guia-movto.num-livre-2
     2619                         procguia.cd-cod-glo              = import-guia-movto.num-livre-1
     2620                         procguia.cd-userid               = v_cod_usuar_corren
     2621                         procguia.nm-prest-exec-compl     = tmp-prest-exec.nm-prest-exec-compl
     2622                         procguia.char-3                  = tmp-prest-exec.nm-conselho
     2623                         procguia.nr-registro             = string(tmp-prest-exec.nr-registro)
     2624                         procguia.uf-conselho             = tmp-prest-exec.uf-conselho
     2625                         procguia.char-2                  = tmp-prest-exec.cd-cbo
     2626                         procguia.vl-principal            = IF import-guia-movto.val-movto-pagto = ? THEN 0 ELSE import-guia-movto.val-movto-pagto 
     2627                         procguia.vl-taxa-participacao    = IF import-guia-movto.val-co-partic   = ? THEN 0 ELSE import-guia-movto.val-co-partic  
     2628                         procguia.vl-movimento-total      = (procguia.vl-principal + import-guia-movto.val-taxas-adm).
     2629   
     2630                  /* ------------------- TABELA MOEDAS E CARENCIAS COBRANCA ------------------ */
     2631                  find first pl-mo-am where pl-mo-am.cd-modalidade = cd-modalidade-aux                                        
     2632                                        and pl-mo-am.cd-plano      = cd-plano-aux                                             
     2633                                        and pl-mo-am.cd-tipo-plano = cd-tipo-plano-aux  
     2634                                        and pl-mo-am.cd-modulo     = import-guia-movto.cd-modulo  
     2635                                        and pl-mo-am.cd-amb        = int(import-guia-movto.cod-movto-guia)  no-lock no-error. 
     2636                  if avail pl-mo-am                                                                                           
     2637                  then do:                                                                                                    
     2638                          assign procguia.cd-tab-preco = pl-mo-am.cd-tab-preco                                                
     2639                                 procguia.cd-modulo    = pl-mo-am.cd-modulo.                                                  
     2640                                                                                                                              
     2641                          find first precproc where precproc.cd-tab-preco = pl-mo-am.cd-tab-preco no-lock no-error.           
     2642                                                                                                                              
     2643                          if avail precproc                                                                                   
     2644                          then assign procguia.cd-forma-pagto     = precproc.cd-forma-pagto                                   
     2645                                      procguia.cd-forma-pagto-cob = precproc.cd-forma-pagto.                                  
     2646                                                                                                                              
     2647                       end.                                                                                                    
     2648                  else do: 
     2649                         find first plamodpr 
     2650                              where plamodpr.cd-modalidade          = cd-modalidade-aux
     2651                                and plamodpr.cd-plano               = cd-plano-aux
     2652                                and plamodpr.cd-tipo-plano          = cd-tipo-plano-aux
     2653                                and plamodpr.in-procedimento-insumo = "P"
     2654                                and plamodpr.cd-modulo              = import-guia-movto.cd-modulo
     2655                                    no-lock no-error.
     2656                         
     2657                         if avail plamodpr
     2658                         then do:
     2659                                assign procguia.cd-tab-preco = plamodpr.cd-tab-preco.
     2660                         
     2661                                find first precproc where precproc.cd-tab-preco = plamodpr.cd-tab-preco no-lock no-error.
     2662                         
     2663                                if avail precproc
     2664                                then assign procguia.cd-forma-pagto     = precproc.cd-forma-pagto
     2665                                            procguia.cd-forma-pagto-cob = precproc.cd-forma-pagto.
     2666                              end.
     2667                       end.
     2668   
     2669                  /* -------------- QTD MOEDA PAGTO ------------------------- */
     2670                  if paramecp.cd-unimed = import-guia.cd-unidade-carteira
     2671                  then do:
     2672                         find propost where propost.cd-modalidade = cd-modalidade-aux 
     2673                                        and propost.nr-ter-adesao = nr-ter-adesao-aux
     2674                                            no-lock no-error.
     2675   
     2676                         if avail propost
     2677                         then assign procguia.cd-tab-preco-proc = propost.cd-tab-preco-proc.
     2678                       end.
     2679                  else do:
     2680                         find unicamco where unicamco.cd-unidade = import-guia.cd-unidade-carteira
     2681                                         and unicamco.dt-limite >= import-guia.dat-solicit
     2682                                             no-lock no-error.
     2683   
     2684                         if avail unicamco
     2685                         then assign procguia.cd-tab-preco-proc = unicamco.cd-tab-preco-proc-cob.
     2686                       end.
     2687   
     2688                  /* ------------------- ANEXOS TISS --------------------------- */
     2689                  if in-tipo-guia-par = "QUIM"
     2690                  then assign procguia.int-2 = 1.
     2691                  else do:
     2692                         if in-tipo-guia-par = "RADI"
     2693                         then assign procguia.int-2 = 2.
     2694                         else do:
     2695                                if in-tipo-guia-par = "OPME"
     2696                                then assign procguia.int-2 = 3.
     2697                                else assign procguia.int-2 = 0.
     2698                              end.
     2699                       end.
     2700   
     2701                  create proced-guia-comp.
     2702                  assign proced-guia-comp.cdn-unid             = paramecp.cd-unimed         
     2703                         proced-guia-comp.num-ano-guia-atendim = aa-guia-atendimento-aux
     2704                         proced-guia-comp.num-guia-atendim     = nr-guia-atendimento-aux
     2705                         proced-guia-comp.num-proces           = nr-processo-proc-aux   
     2706                         proced-guia-comp.num-seq-digitac      = 0
     2707                         proced-guia-comp.dat-previs-adm       = import-guia-movto.dat-previs. /* radio e quimio */
     2708   
     2709                  case in-tipo-guia-par:
     2710                      when "ODON"
     2711                      then do:
     2712                             assign procguia.tp-dente-regiao  = trim(import-guia-movto.ind-dente-regiao).
     2713                             
     2714                             assign id-face-dente-aux = trim(import-guia-movto.ind-face-dente).
     2715   
     2716                             do ix = 1 to length(id-face-dente-aux):
     2717                                 if substr(id-face-dente-aux,ix,1) <> ""
     2718                                 then assign procguia.id-face-dente[ix] = substr(id-face-dente-aux,ix,1).
     2719                             end.
     2720                           end.
     2721                  end case.
     2722   
     2723                  validate procguia.
     2724                  release procguia.
     2725   
     2726                  validate proced-guia-comp.
     2727                  release proced-guia-comp.
     2728   
     2729                  RUN escrever-log("@@@@@vai chamar grava-glosas PROCEDIMENTOS. ano: " + STRING(aa-guia-atendimento-aux) + " guia:" 
     2730                               + STRING(nr-guia-atendimento-aux) 
     2731                               + " in-tipo-guia-par: " + in-tipo-guia-par + " val-seqcial: " + STRING(import-guia-movto.val-seqcial)
     2732                               + " val-seq-guia-par: " + STRING(val-seq-guia-par)).
     2733   
     2734                  run grava-glosas(input in-tipo-guia-par,
     2735                                   input import-guia-movto.val-seqcial,
     2736                                   input val-seq-guia-par,
     2737                                   input aa-guia-atendimento-aux,
     2738                                   input nr-guia-atendimento-aux, 
     2739                                   input nr-processo-proc-aux,
     2740                                   input 0, /* nr-seq-digitacao */
     2741                                   input "P"). /* in-origem-glosa */
     2742   
     2743                  assign nr-processo-proc-aux = nr-processo-proc-aux + 1.
     2744                end.
     2745           else do:
     2746                  if not import-guia-movto.log-livre-1 /* true: pacote; false: nao eh pacote */
     2747                  then do:
     2748   
     2749                      RUN escrever-log("@@@@@criando insuguia ano: " + STRING(aa-guia-atendimento-aux) + " guia:" 
     2750                                   + STRING(nr-guia-atendimento-aux) + " movimento: " + STRING(import-guia-movto.cod-movto-guia)).
     2751   
     2752                         create insuguia.
     2753                         assign insuguia.cd-unidade              = paramecp.cd-unimed
     2754                                insuguia.aa-guia-atendimento     = aa-guia-atendimento-aux
     2755                                insuguia.nr-guia-atendimento     = nr-guia-atendimento-aux
     2756                                insuguia.nr-processo             = 0
     2757                                insuguia.nr-seq-digitacao        = nr-seq-digitacao-ins-aux
     2758                                insuguia.cd-tipo-insumo          = int(substr(string(dec(import-guia-movto.cod-movto-guia),"9999999999"),1,2))
     2759                                insuguia.cd-insumo               = int(substr(string(dec(import-guia-movto.cod-movto-guia),"9999999999"),3,8))
     2760                                insuguia.cd-modulo               = import-guia-movto.cd-modulo
     2761                                insuguia.qt-insumo               = import-guia-movto.qtd-autoriza
     2762                                insuguia.dec-1                   = import-guia-movto.qtd-solicitad
     2763                                insuguia.dt-atualizacao          = today
     2764                                insuguia.cd-userid               = v_cod_usuar_corren
     2765                                insuguia.dt-realizacao           = ?
     2766                                insuguia.hr-realizacao           = substring(string(time,"HH:MM"),1,2) + substring(string(time,"HH:MM"),4,2)
     2767                                insuguia.cd-modalidade           = cd-modalidade-aux
     2768                                insuguia.nr-ter-adesao           = nr-ter-adesao-aux
     2769                                insuguia.cd-usuario              = cd-usuario-aux
     2770                                insuguia.cd-unidade-prestador    = cd-unidade-prestador-aux
     2771                                insuguia.cd-prestador            = cd-prestador-aux
     2772                                insuguia.cd-esp-prest-executante = cd-esp-prest-executante-aux
     2773                                insuguia.cd-tipo-vinculo         = cd-vinculo-aux
     2774                                insuguia.cd-validacao            = import-guia-movto.cd-validacao
     2775                                insuguia.cd-tipo-cob             = import-guia-movto.num-livre-3 /* Validacao para cobranca */
     2776                                insuguia.cd-tipo-pagamento       = import-guia-movto.num-livre-4 /* Validacao para pagamento */
     2777                                insuguia.cd-classe-erro          = import-guia-movto.num-livre-2
     2778                                insuguia.cd-cod-glo              = import-guia-movto.num-livre-1
     2779                                insuguia.cd-userid               = v_cod_usuar_corren
     2780                                insuguia.nm-prest-exec-compl     = tmp-prest-exec.nm-prest-exec-compl
     2781                                insuguia.char-3                  = tmp-prest-exec.nm-conselho
     2782                                insuguia.nr-registro             = string(tmp-prest-exec.nr-registro)
     2783                                insuguia.uf-conselho             = tmp-prest-exec.uf-conselho
     2784                                insuguia.char-2                  = tmp-prest-exec.cd-cbo
     2785                                insuguia.vl-insumo-cob           = if import-guia-movto.val-movto-pagto = ? then 0 else import-guia-movto.val-movto-pagto
     2786                                insuguia.vl-taxa-participacao    = if import-guia-movto.val-co-partic   = ? then 0 else import-guia-movto.val-co-partic  
     2787                                insuguia.vl-movimento-total      = (insuguia.vl-insumo-cob + import-guia-movto.val-taxas-adm).
     2788   
     2789                         /* ------------------- TABELA MOEDAS E CARENCIAS COBRANCA --------------- */
     2790                          for first insumos where insumos.cd-insumo = int(import-guia-movto.cod-movto-guia) no-lock: 
     2791                             assign insuguia.cd-tipo-insumo = insumos.cd-tipo-insumo  
     2792                                    insuguia.cd-insumo      = insumos.cd-insumo.       
     2793                         end.
     2794   
     2795                         /* Busca do modulo*/                                                                                                                                                                                                                                 
     2796                         find first partinsu 
     2797                              where partinsu.cd-modalidade  = cd-modalidade-aux                                             
     2798                                and partinsu.cd-plano       = cd-plano-aux                                                  
     2799                                and partinsu.cd-tipo-plano  = cd-tipo-plano-aux  
     2800                                and partinsu.cd-modulo      = import-guia-movto.cd-modulo
     2801                                and partinsu.cd-tipo-insumo = int(substr(string(dec(import-guia-movto.cod-movto-guia),"9999999999"),1,2))                                        
     2802                                and partinsu.cd-insumo      = int(substr(string(dec(import-guia-movto.cod-movto-guia),"9999999999"),3,8)) no-lock no-error.                          
     2803   
     2804                         if not avail partinsu                                                                                             
     2805                         then find first partinsu 
     2806                                   where partinsu.cd-modalidade  = cd-modalidade-aux                                      
     2807                                     and partinsu.cd-plano       = cd-plano-aux                                           
     2808                                     and partinsu.cd-tipo-plano  = cd-tipo-plano-aux   
     2809                                     and partinsu.cd-modulo      = import-guia-movto.cd-modulo
     2810                                     and partinsu.cd-tipo-insumo = int(substr(string(dec(import-guia-movto.cod-movto-guia),"9999999999"),1,2))                                
     2811                                     and partinsu.cd-insumo      = 0 no-lock no-error.                   
     2812                                                                                                                                       
     2813                         if avail partinsu                                                                                                
     2814                         then do:                                                                                                         
     2815                                assign insuguia.cd-tab-preco = partinsu.cd-tab-preco                                                      
     2816                                       insuguia.cd-modulo    = partinsu.cd-modulo.                                                        
     2817                                                                                                                                          
     2818                                find first precproc where precproc.cd-tab-preco = partinsu.cd-tab-preco no-lock no-error.                 
     2819                                                                                                                                          
     2820                                if avail precproc                                                                                         
     2821                                then assign insuguia.cd-forma-pagto     = precproc.cd-forma-pagto                                         
     2822                                            insuguia.cd-forma-pagto-cob = precproc.cd-forma-pagto.                                        
     2823                                                                                                                                          
     2824                              end.      
     2825                         else do:
     2826                                find first plamodpr 
     2827                                     where plamodpr.cd-modalidade          = cd-modalidade-aux
     2828                                       and plamodpr.cd-plano               = cd-plano-aux
     2829                                       and plamodpr.cd-tipo-plano          = cd-tipo-plano-aux
     2830                                       and plamodpr.in-procedimento-insumo = "I"
     2831                                       and plamodpr.cd-modulo              = import-guia-movto.cd-modulo
     2832                                           no-lock no-error.
     2833                                
     2834                                if avail plamodpr
     2835                                then do:
     2836                                       assign insuguia.cd-tab-preco-cob = plamodpr.cd-tab-preco.
     2837                                
     2838                                       find first precproc where precproc.cd-tab-preco = plamodpr.cd-tab-preco no-lock no-error.
     2839                                
     2840                                       if avail precproc
     2841                                       then assign insuguia.cd-forma-pagto     = precproc.cd-forma-pagto
     2842                                                   insuguia.cd-forma-pagto-cob = precproc.cd-forma-pagto.
     2843                                     end.
     2844                              end.
     2845                         
     2846                         /* -------------- QTD MOEDA PAGTO ------------------------- */
     2847                         if paramecp.cd-unimed = import-guia.cd-unidade-carteira
     2848                         then do:
     2849                                find propost where propost.cd-modalidade = cd-modalidade-aux
     2850                                               and propost.nr-ter-adesao = nr-ter-adesao-aux
     2851                                                   no-lock no-error.
     2852                         
     2853                                if avail propost
     2854                                then assign insuguia.cd-tab-preco-proc-cob = propost.cd-tab-preco-proc.
     2855                              end.
     2856                         else do:
     2857                                find unicamco where unicamco.cd-unidade = import-guia.cd-unidade-carteira
     2858                                                and unicamco.dt-limite >= import-guia.dat-solicit
     2859                                                    no-lock no-error.
     2860                         
     2861                                if avail unicamco
     2862                                then assign insuguia.cd-tab-preco-proc-cob = unicamco.cd-tab-preco-proc-cob.
     2863                              end.
     2864                         
     2865                         /* -------------- DESCRICAO INSUMO GENERICO ------------------------------ */
     2866                         if  import-guia-movto.des-insumo <> ?
     2867                         and import-guia-movto.des-insumo <> ""
     2868                         then assign insuguia.char-4 = import-guia-movto.des-insumo. /* Descricao do insumo generico */
     2869                         
     2870                         /* --------------------- ANEXOS CLINICOS TISS -------------------------- */
     2871                         if in-tipo-guia-par = "QUIM"
     2872                         then assign insuguia.int-2 = 1.
     2873                         else do:
     2874                                if in-tipo-guia-par = "RADI"
     2875                                then assign insuguia.int-2 = 2.
     2876                                else do:
     2877                                       if in-tipo-guia-par = "OPME"
     2878                                       then assign insuguia.int-2 = 3.
     2879                                       else assign insuguia.int-2 = 0.
     2880                                     end.
     2881                              end.
     2882                         
     2883                         create insumo-guia-comp.
     2884                         assign insumo-guia-comp.cdn-unid             = paramecp.cd-unimed                      
     2885                                insumo-guia-comp.num-ano-guia-atendim = aa-guia-atendimento-aux                 
     2886                                insumo-guia-comp.num-guia-atendim     = nr-guia-atendimento-aux                 
     2887                                insumo-guia-comp.num-proces           = 0                                       
     2888                                insumo-guia-comp.num-seq-digitac      = nr-seq-digitacao-ins-aux                
     2889                                insumo-guia-comp.cod-opc              = trim(import-guia-movto.des-opc-fabrican)
     2890                                insumo-guia-comp.cdn-via-adm          = int(import-guia-movto.cdn-via-administ)
     2891                                insumo-guia-comp.dat-previs-adm       = import-guia-movto.dat-previs
     2892                                insumo-guia-comp.cdn-freq             = import-guia-movto.cdn-freq.
     2893                         
     2894                         validate insuguia.
     2895                         release insuguia.
     2896                         
     2897                         validate insumo-guia-comp.
     2898                         release insumo-guia-comp.
     2899                         
     2900                         run grava-glosas(input in-tipo-guia-par,
     2901                                          input import-guia-movto.val-seqcial,
     2902                                          input val-seq-guia-par,
     2903                                          input aa-guia-atendimento-aux,
     2904                                          input nr-guia-atendimento-aux, 
     2905                                          input 0, /* nr-processo */
     2906                                          input nr-seq-digitacao-ins-aux,
     2907                                          input "I"). /* in-origem-glosa */
     2908                         
     2909                         assign nr-seq-digitacao-ins-aux = nr-seq-digitacao-ins-aux + 1.
     2910                  end.
     2911                end.
     2912       end. /* each import-guia-movto */
     2913   
     2914   end procedure.
     2915   
     2916   /* ----------------------------------------------------------------- */
     2917   procedure grava-glosas:
     2918   
     2919       def input parameter ind-tip-guia-par      as char no-undo.
     2920       def input parameter val-seqcial-movto-par as int  no-undo.
     2921       def input parameter val-seq-guia-par      as int  no-undo.
     2922       def input parameter aa-guia-atend-par     as int  no-undo.
     2923       def input parameter nr-guia-atend-par     as int  no-undo.
     2924       def input parameter nr-processo-par       as int  no-undo.
     2925       def input parameter nr-seq-digitacao-par  as int  no-undo.
     2926       def input parameter in-origem-glosa-par   as char no-undo.
     2927   
     2928       RUN escrever-log("@@@@@vai ler import-movto-glosa. modulo: AT ind-tip-guia-par: " + STRING(ind-tip-guia-par)
     2929                        + " val-seqcial-movto-par: " + STRING(val-seqcial-movto-par)
     2930                        + " val-seq-guia-par: " + STRING(val-seq-guia-par)).
     2931   
     2932   
     2933       for each import-movto-glosa
     2934          where import-movto-glosa.in-modulo         = "AT"
     2935            and import-movto-glosa.ind-tip-guia      = ind-tip-guia-par
     2936            and import-movto-glosa.val-seqcial-movto = val-seqcial-movto-par
     2937            and import-movto-glosa.val-seq-guia      = val-seq-guia-par
     2938                no-lock:
     2939   
     2940           RUN escrever-log("@@@@@criando movatglo ano: " + STRING(aa-guia-atend-par) + " guia:" 
     2941                        + STRING(nr-guia-atend-par) + " glosa: " + STRING(import-movto-glosa.cd-cod-glo)).
     2942   
     2943   /*
     2944   pu    movatgl1                      N/A       6 + cd-unidade
     2945                                                   + aa-guia-atendimento
     2946                                                   + nr-guia-atendimento
     2947                                                   + nr-processo
     2948                                                   + nr-seq-digitacao
     2949                                                   + cd-classe-erro
     2950   */
     2951           IF NOT CAN-FIND(FIRST movatglo
     2952                           WHERE movatglo.cd-unidade          = paramecp.cd-unimed
     2953                             and movatglo.aa-guia-atendimento = aa-guia-atend-par
     2954                             and movatglo.nr-guia-atendimento = nr-guia-atend-par
     2955                             and movatglo.nr-processo         = nr-processo-par
     2956                             and movatglo.nr-seq-digitacao    = nr-seq-digitacao-par
     2957                             and movatglo.cd-classe-erro      = import-movto-glosa.cd-classe-erro)
     2958           THEN DO:
     2959           create movatglo.
     2960           assign movatglo.cd-unidade          = paramecp.cd-unimed
     2961                  movatglo.aa-guia-atendimento = aa-guia-atend-par
     2962                  movatglo.nr-guia-atendimento = nr-guia-atend-par
     2963                  movatglo.nr-processo         = nr-processo-par
     2964                  movatglo.nr-seq-digitacao    = nr-seq-digitacao-par
     2965                  movatglo.cd-classe-erro      = import-movto-glosa.cd-classe-erro
     2966                  
     2967                  movatglo.in-origem-glosa     = in-origem-glosa-par
     2968                  movatglo.cd-cod-glo          = import-movto-glosa.cd-cod-glo
     2969                  movatglo.ds-motivo-glosa     = import-movto-glosa.des-motiv-glosa
     2970                  movatglo.cd-userid           = v_cod_usuar_corren
     2971                  movatglo.dt-atualizacao      = today
     2972                  movatglo.qti-quant-proced-dispon = import-movto-glosa.qti-quant-proced-dispon.
     2973   
     2974           validate movatglo.
     2975           release movatglo.
     2976                END.
     2977       end. /* each import-movto-glosa */
     2978   
     2979   end procedure.
     2980   
     2981   /* ----------------------------------------------------------------- */
     2982   procedure gera-seq-guia:
     2983   
     2984       /**
     2985        * 12/12/2016 - Alex Boeira
     2986        *              Logica retirada pois as guias devem ser criadas no TOTVS de acordo com a numeracao ja gerada
     2987        *              anteriormente no Unicoo, pois os prestadores enviarao as cobrancas com esses mesmos numeros.
     2988       assign aa-guia-atendimento-aux = year(today).
     2989   
     2990       IF CAN-FIND(first guiautor 
     2991                   where guiautor.cd-unidade          = paramecp.cd-unimed
     2992                     and guiautor.aa-guia-atendimento = year(today))
     2993       then assign nr-guia-atendimento-aux = next-value (seq-guiautor).
     2994       else do:
     2995              assign nr-guia-atendimento-aux = 1.
     2996   
     2997              &if   "{&tipo-banco}" = "normal"
     2998              &then assign current-value(seq-guiautor) = 1.
     2999              &else do:
     3000                      do transaction:
     3001                         run stored-proc shsrcadger.send-sql-statement hand1 = proc-handle
     3002                         ("drop sequence seq_guiautor").
     3003   
     3004                         run stored-proc shsrcadger.send-sql-statement hand1 = proc-handle
     3005                         ("create sequence seq_guiautor start with 1 minvalue 0 maxvalue 99999999 nocycle nocache increment by 1").
     3006   
     3007                         close stored-proc shsrcadger.send-sql-statement where proc-handle = hand1.
     3008   
     3009                      end.
     3010   
     3011                      assign nr-guia-atendimento-aux = next-value (seq-guiautor).
     3012                    end.
     3013              &endif
     3014            end.
     3015       */
     3016       ASSIGN aa-guia-atendimento-aux = import-guia.aa-guia-atendimento
     3017              nr-guia-atendimento-aux = import-guia.nr-guia-atendimento.
     3018   
     3019   end procedure.
     3020   
     3021   /* ----------------------------------------------------------------- */
     3022   procedure valida-odontologia:
     3023   
     3024       def input-output parameter lg-erro-par as log init no no-undo.
     3025   
     3026       find first import-guia-odonto where import-guia-odonto.num-seq-import = import-guia.num-seqcial no-lock no-error.
     3027   
     3028       if not avail import-guia-odonto
     3029       then do:
     3030              run grava-erro(input import-guia.num-seqcial-control,
     3031                             input "import-guia-odonto",
     3032                             input "Registro import-guia-odonto nao encontrado",
     3033                             input today,
     3034                             input "Registro referente a guia de Odontologia nao foi encontrado").
     3035              
     3036              assign lg-erro-par = yes.
     3037              return.
     3038            end.
     3039   
     3040       /* ----------------------------------------------------------------- */
     3041       if  avail tranrevi
     3042       and not tranrevi.lg-transacao-odontologica
     3043       then do:
     3044              IF tranrevi.cd-transacao <> ?
     3045              THEN char-aux1 = string(tranrevi.cd-transacao).
     3046              ELSE char-aux1 = "nulo".
     3047              IF import-guia-odonto.num-seq-import <> ?
     3048              THEN char-aux2 = string(import-guia-odonto.num-seq-import).
     3049              ELSE char-aux2 = "nulo".
     3050              
     3051              run grava-erro(input import-guia.num-seqcial-control,
     3052                             input "import-guia",
     3053                             input "Transacao nao e de odontologia. Transacao: " + char-aux1 + 
     3054                                   " import-guia-odonto.num-seq-import: " + char-aux2,
     3055                             input today,
     3056                             input "Para guias de odontologia, informe transacao de odontologia").
     3057   
     3058              assign lg-erro-par = yes.
     3059            end.
     3060   
     3061       /* ----------------------------------------------------------------- */
     3062       if  avail tip-guia
     3063       and not tip-guia.lg-transacao-odontologica
     3064       then do:         
     3065              IF tip-guia.cd-tipo-guia <> ?
     3066              THEN char-aux1 = string(tip-guia.cd-tipo-guia).
     3067              ELSE char-aux1 = "nulo".
     3068              IF import-guia-odonto.num-seq-import <> ?
     3069              THEN char-aux2 = string(import-guia-odonto.num-seq-import).
     3070              ELSE char-aux2 = "nulo".
     3071              run grava-erro(input import-guia.num-seqcial-control,
     3072                             input "import-guia",
     3073                             input "Tipo de Guia nao e de odontologia. Tipo de guia: " + char-aux1 + 
     3074                                   " import-guia-odonto.num-seq-import: " + char-aux2,
     3075                             input today,
     3076                             input "Para guias de odontologia, informe um tipo de guia de odontologia").
     3077   
     3078              assign lg-erro-par = yes.
     3079            end.
     3080   
     3081       /* ----------------------------------------------------------------- */
     3082       int(import-guia-odonto.ind-tip-atendim) no-error.
     3083   
     3084       if error-status:error
     3085       then do:
     3086              run grava-erro(input import-guia.num-seqcial-control,
     3087                             input "import-guia-odonto",
     3088                             input "Tipo de Atendimento invalido: "       + import-guia-odonto.ind-tip-atendim +
     3089                                   " import-guia-odonto.num-seq-import: " + string(import-guia-odonto.num-seq-import),
     3090                             input today,
     3091                             input "Informe um valor conforme a tabela 51 da TISS.").
     3092              
     3093              assign lg-erro-par = yes.
     3094            end.
     3095   
     3096       if int(import-guia-odonto.ind-tip-atendim) < 1
     3097       or int(import-guia-odonto.ind-tip-atendim) > 5
     3098       then do:
     3099              run grava-erro(input import-guia.num-seqcial-control,
     3100                             input "import-guia-odonto",
     3101                             input "Tipo de Atendimento invalido: " + import-guia-odonto.ind-tip-atendim + 
     3102                                   " import-guia-odonto.num-seq-import: " + string(import-guia-odonto.num-seq-import),
     3103                             input today,
     3104                             input "Informe um valor conforme a tabela 51 da TISS.").
     3105              
     3106              assign lg-erro-par = yes.
     3107            end.
     3108   
     3109       /* ----------------------------------------------------------------- */
     3110       int(import-guia-odonto.ind-tip-faturam) no-error.
     3111   
     3112       if error-status:error
     3113       then do:
     3114              run grava-erro(input import-guia.num-seqcial-control,
     3115                             input "import-guia-odonto",
     3116                             input "Tipo de Faturamento invalido: " + import-guia-odonto.ind-tip-faturam + 
     3117                                   " import-guia-odonto.num-seq-import: " + string(import-guia-odonto.num-seq-import), 
     3118                             input today,
     3119                             input "Informe um valor conforme a tabela 55 da TISS.").
     3120   
     3121              assign lg-erro-par = yes.
     3122            end.
     3123   
     3124       if int(import-guia-odonto.ind-tip-faturam) < 1
     3125       or int(import-guia-odonto.ind-tip-faturam) > 4
     3126       then do:
     3127              run grava-erro(input import-guia.num-seqcial-control,
     3128                             input "import-guia-odonto",
     3129                             input "Tipo de Atendimento invalido: " + import-guia-odonto.ind-tip-faturam + 
     3130                                   " import-guia-odonto.num-seq-import: " + string(import-guia-odonto.num-seq-import),
     3131                             input today,
     3132                             input "Informe um valor conforme a tabela 55 da TISS.").
     3133   
     3134              assign lg-erro-par = yes.
     3135            end.
     3136   
     3137       /* ------------------------------------------------------------------------------------- */
     3138       IF NOT CAN-FIND(FIRST preserv
     3139                       WHERE preserv.cd-unidade   = import-guia-odonto.cd-unidade-exec
     3140                         AND preserv.cd-prestador = import-guia-odonto.cd-prestador-exec)
     3141       THEN DO:
     3142              run grava-erro(input import-guia.num-seqcial-control,
     3143                             input "import-guia-odonto",
     3144                             input "(1)Prestador executante nao encontrado.",
     3145                             input today,
     3146                             input " Unidade(import-guia-odonto.cd-unidade-exec): " + string(import-guia-odonto.cd-unidade-exec) + 
     3147                                   " Prestador(import-guia-odonto.cd-prestador-exec): " + string(import-guia-odonto.cd-prestador-exec) + 
     3148                                   " import-guia-odonto.num-seq-import: " + string(import-guia-odonto.num-seq-import)).
     3149              assign lg-erro-par = yes.
     3150            END.
     3151       ELSE DO:
     3152                   run busca-vinculo-prestador(input  import-guia-odonto.cd-unidade-exec,
     3153                                               input  import-guia-odonto.cd-prestador-exec,
     3154                                               input  import-guia-odonto.cd-especialid-exec,
     3155                                               input  import-guia.dat-solicit,
     3156                                               output cd-vinculo-aux,
     3157                                               output lg-erro-vinculo-aux). 
     3158   
     3159                   if lg-erro-vinculo-aux
     3160                   then do:
     3161                          run grava-erro(input import-guia.num-seqcial-control,
     3162                                         input "import-guia-odonto",
     3163                                         input "Vinculo nao encontrado para o prestador executante e especialidade informados.",
     3164                                         input today,
     3165                                         input " Unidade(import-guia-odonto.cd-unidade-exec): " + string(import-guia-odonto.cd-unidade-exec) + 
     3166                                               " Prestador(import-guia-odonto.cd-prestador-exec): " + string(import-guia-odonto.cd-prestador-exec) + 
     3167                                               " Espec.(import-guia-odonto.cd-especialid-exec): " + string(import-guia-odonto.cd-especialid-exec) + 
     3168                                               " import-guia-odonto.num-seq-import: " + string(import-guia-odonto.num-seq-import)).
     3169   
     3170                          assign lg-erro-par = yes.
     3171                        end.
     3172                   else do:
     3173                          create tmp-prest-exec.
     3174                          assign tmp-prest-exec.in-tipo-guia        = "ODON"
     3175                                 tmp-prest-exec.val-seqcial         = import-guia-odonto.num-seqcial-guia
     3176                                 tmp-prest-exec.cd-unidade          = import-guia-odonto.cd-unidade-exec
     3177                                 tmp-prest-exec.cd-prestador        = import-guia-odonto.cd-prestador-exec
     3178                                 tmp-prest-exec.cd-espec            = import-guia-odonto.cd-especialid-exec
     3179                                 tmp-prest-exec.cd-vinculo          = cd-vinculo-aux
     3180                                 tmp-prest-exec.nm-prest-exec-compl = trim(import-guia-odonto.nom-prestdor-executa)
     3181                                 tmp-prest-exec.nm-conselho         = trim(import-guia-odonto.cod-cons-exec)
     3182                                 tmp-prest-exec.nr-registro         = import-guia-odonto.num-livre-1
     3183                                 tmp-prest-exec.uf-conselho         = trim(import-guia-odonto.cod-uf-cons-medic)
     3184                                 tmp-prest-exec.cd-cbo              = trim(import-guia-odonto.cod-cbo-prestdor-exec).
     3185                        end.
     3186            END.
     3187       
     3188       /* ------------ PRESTADOR EXECUTANTE --------------------------- */
     3189       find preserv where preserv.cd-unidade   = import-guia-odonto.cd-unidade-exec
     3190                      and preserv.cd-prestador = import-guia-odonto.cd-prestador-exec
     3191                          no-lock no-error.
     3192   
     3193       if not avail preserv
     3194       then do:
     3195              run grava-erro(input import-guia.num-seqcial-control,
     3196                             input "import-guia-odonto",
     3197                             input "Prestador executante nao cadastrado. " + 
     3198                                   " Unidade(import-guia-odonto.cd-unidade-exec): " + string(import-guia-odonto.cd-unidade-exec) + 
     3199                                   " Prestador(import-guia-odonto.cd-prestador-exec): " + string(import-guia-odonto.cd-prestador-exec) + 
     3200                                   " import-guia-odonto.num-seq-import: " + string(import-guia-odonto.num-seq-import),
     3201                             input today,
     3202                             input "Informe um codigo de prestador cadastrado no Gestao de Planos.").
     3203              
     3204              assign lg-erro-par = yes.
     3205            end.
     3206       else do:
     3207              if preserv.in-tipo-pessoa = "J"
     3208              then do:
     3209                     if import-guia-odonto.nom-prestdor-executa = ?
     3210                     or import-guia-odonto.nom-prestdor-executa = ""
     3211                     then do:
     3212                            run grava-erro(input import-guia.num-seqcial-control,
     3213                                           input "import-guia-odonto",
     3214                                           input "Nome do prestador executante complementar deve ser informado. " + 
     3215                                                 " Unidade(import-guia-odonto.cd-unidade-exec): " + string(import-guia-odonto.cd-unidade-exec) + 
     3216                                                 " Prestador(import-guia-odonto.cd-prestador-exec): " + string(import-guia-odonto.cd-prestador-exec) + 
     3217                                                 " import-guia-odonto.num-seq-import: " + string(import-guia-odonto.num-seq-import),
     3218                                           input today,
     3219                                           input "Quando o prestador executante for pessoa juridica, o nome do prestador executante deve ser informado.").
     3220                            
     3221                            assign lg-erro-par = yes.
     3222                          end.
     3223                   end.
     3224            end.
     3225   
     3226       if import-guia-odonto.cod-cons-exec = ?
     3227       or import-guia-odonto.cod-cons-exec = ""
     3228       then do:
     3229              run grava-erro(input import-guia.num-seqcial-control,
     3230                             input "import-guia-odonto",
     3231                             input "Conselho do prestador executante nao informado. " +
     3232                                   " Unidade(import-guia-odonto.cd-unidade-exec): " + string(import-guia-odonto.cd-unidade-exec) + 
     3233                                   " Prestador(import-guia-odonto.cd-prestador-exec): " + string(import-guia-odonto.cd-prestador-exec) + 
     3234                                   " import-guia-odonto.num-seq-import: " + string(import-guia-odonto.num-seq-import),
     3235                             input today,
     3236                             input "Informe o conselho do prestador executante.").
     3237   
     3238              assign lg-erro-par = yes.
     3239            end.
     3240       else do:
     3241              if not can-find(conpres where conpres.cd-conselho = trim(import-guia-odonto.cod-cons-exec))
     3242              then do:
     3243                     run grava-erro(input import-guia.num-seqcial-control,
     3244                                    input "import-guia-odonto",
     3245                                    input "Conselho do prestador executante nao cadastrado. " + 
     3246                                          " Unidade(import-guia-odonto.cd-unidade-exec): " + string(import-guia-odonto.cd-unidade-exec) + 
     3247                                          " Prestador(import-guia-odonto.cd-prestador-exec): " + string(import-guia-odonto.cd-prestador-exec) +  
     3248                                          " Conselho: " + string(import-guia-odonto.cod-cons-exec) + 
     3249                                          " import-guia-odonto.num-seq-import: " + string(import-guia-odonto.num-seq-import),
     3250                                    input today,
     3251                                    input "Informe um codigo de conselho cadastrado no Gestao de Planos.").
     3252              
     3253                     assign lg-erro-par = yes.
     3254                   end.
     3255            end.
     3256   
     3257       if import-guia-odonto.cod-cbo-prestdor-exec = ?
     3258       or import-guia-odonto.cod-cbo-prestdor-exec = ""
     3259       then do:
     3260              run grava-erro(input import-guia.num-seqcial-control,
     3261                             input "import-guia-odonto",
     3262                             input "CBO do prestador executante nao informado. " + 
     3263                                   " Unidade(import-guia-odonto.cd-unidade-exec): " + string(import-guia-odonto.cd-unidade-exec) + 
     3264                                   " Prestador(import-guia-odonto.cd-prestador-exec): " + string(import-guia-odonto.cd-prestador-exec) +  
     3265                                   "import-guia-odonto.num-seq-import: " + string(import-guia-odonto.num-seq-import),
     3266                             input today,
     3267                             input "Informe o CBO do prestador executante").
     3268   
     3269              assign lg-erro-par = yes.
     3270            end.
     3271   
     3272       if import-guia-odonto.cod-uf-cons-medic = ?
     3273       or import-guia-odonto.cod-uf-cons-medic = ""
     3274       then do:
     3275              run grava-erro(input import-guia.num-seqcial-control,
     3276                             input "import-guia-odonto",
     3277                             input "UF do conselho do prestador executante nao informado." +
     3278                                   " Unidade(import-guia-odonto.cd-unidade-exec): " + string(import-guia-odonto.cd-unidade-exec) + 
     3279                                   " Prestador(import-guia-odonto.cd-prestador-exec): " + string(import-guia-odonto.cd-prestador-exec) +  
     3280                                   " import-guia-odonto.num-seq-import: " + string(import-guia-odonto.num-seq-import),
     3281                             input today,
     3282                             input "Infome a UF do conselho do prestador executante.").
     3283   
     3284              assign lg-erro-par = yes.
     3285            end.
     3286   
     3287       if import-guia-odonto.num-livre-1 = ? /* Numero do registro do prestador no conselho */
     3288       or import-guia-odonto.num-livre-1 = 0
     3289       then do:
     3290              run grava-erro(input import-guia.num-seqcial-control,
     3291                             input "import-guia-odonto",
     3292                             input "Numero do registro no conselho do prestador executante nao informado. " + 
     3293                                   " Unidade(import-guia-odonto.cd-unidade-exec): " + string(import-guia-odonto.cd-unidade-exec) + 
     3294                                   " Prestador(import-guia-odonto.cd-prestador-exec): " + string(import-guia-odonto.cd-prestador-exec) +      
     3295                                   " import-guia-odonto.num-seq-import: " + string(import-guia-odonto.num-seq-import),
     3296                             input today,
     3297                             input "Informe o numero do registro do prestador.").
     3298   
     3299              assign lg-erro-par = yes.
     3300            end.
     3301   
     3302       /* ------------------- MOVIMENTOS INTERNACAO -------------------- */
     3303       for each import-guia-movto
     3304          where import-guia-movto.ind-tip-guia = "ODON" /* Odontologia */
     3305            and import-guia-movto.val-seq-guia = import-guia-odonto.num-seqcial-guia
     3306                no-lock:
     3307   
     3308           if  import-guia-movto.ind-tip-movto-guia <> "P"
     3309           and import-guia-movto.ind-tip-movto-guia <> "I"
     3310           then do:
     3311                  run grava-erro(input import-guia.num-seqcial-control,
     3312                                 input "import-guia-odonto",
     3313                                 input "Tipo do movimento informado invalido: "          + import-guia-movto.ind-tip-movto-guia   + 
     3314                                       " Tp.Guia(import-guia-movto.ind-tip-guia): "      + string(import-guia-movto.ind-tip-guia) + 
     3315                                       " Nro.Seq.Guia(import-guia-movto.val-seq-guia): " + string(import-guia-movto.val-seq-guia) + 
     3316                                       " import-guia-odonto.num-seq-import: "            + string(import-guia-odonto.num-seq-import),
     3317                                 input today,  
     3318                                 input "Informe um valor valido para o campo: P ou I").
     3319   
     3320                  assign lg-erro-par = yes.
     3321                end.
     3322   
     3323           run valida-dados-movimento(input-output lg-erro-par).
     3324   
     3325           run valida-glosas(input        import-guia-movto.ind-tip-guia,
     3326                             input        import-guia-movto.val-seqcia,
     3327                             input        import-guia-odonto.num-seqcial-guia,
     3328                             input-output lg-erro-par).
     3329       end.
     3330   
     3331   end procedure.
     3332   
     3333   /* ----------------------------------------------------------------- */
     3334   procedure valida-anexo-odonto:
     3335   
     3336       def input-output parameter lg-erro-par as log init no no-undo.
     3337       
     3338       find first import-anexo-odonto where import-anexo-odonto.num-seqcial-import-anexo = import-anexo-solicit.num-seqcial
     3339                                      no-lock no-error.
     3340   
     3341       if not avail import-anexo-odonto
     3342       then do:
     3343              run grava-erro(input import-guia.num-seqcial-control,
     3344                             input "import-anexo-odonto",
     3345                             input "Registro import-anexo-odonto nao encontrado. import-anexo-solicit.num-seqcial: " + string(import-anexo-solicit.num-seqcial),
     3346                             input today,
     3347                             input "Registro referente ao anexo de Odontologia nao encontrado.").
     3348              
     3349              assign lg-erro-par = yes.
     3350              return.
     3351            end.
     3352   
     3353       /* ------------- VALIDA OS MOVIMENTOS DO ANEXO DE ODONTO ------------- */
     3354       for each import-anexo-odonto-mov
     3355          where import-anexo-odonto-mov.num-seqcial-anexo = import-anexo-odonto.num-seqcial
     3356                no-lock:
     3357   
     3358           int(import-anexo-odonto-mov.tp-dente-regiao) no-error.
     3359   
     3360           if error-status:error
     3361           then do:
     3362                  run grava-erro(input import-guia.num-seqcial-control,
     3363                                 input "import-anexo-odonto-mov",
     3364                                 input "Dente invalido: " + import-anexo-odonto-mov.tp-dente-regiao +
     3365                                       " import-anexo-odonto-mov.num-seqcial-anexo: " + string(import-anexo-odonto-mov.num-seqcial-anexo) + 
     3366                                       " import-anexo-odonto.num-seqcial: " + string(import-anexo-odonto.num-seqcial),
     3367                                 input today,
     3368                                 input "Informe um codigo valido para o dente").
     3369                  
     3370                  assign lg-erro-par = yes.
     3371                end.
     3372   
     3373           if  (    int(import-anexo-odonto-mov.tp-dente-regiao) >= 11
     3374                and int(import-anexo-odonto-mov.tp-dente-regiao) <= 18
     3375               )
     3376           or  (    int(import-anexo-odonto-mov.tp-dente-regiao) >= 21
     3377                and int(import-anexo-odonto-mov.tp-dente-regiao) <= 28
     3378               )
     3379           or  (    int(import-anexo-odonto-mov.tp-dente-regiao) >= 51
     3380                and int(import-anexo-odonto-mov.tp-dente-regiao) <= 55
     3381               )
     3382           or  (    int(import-anexo-odonto-mov.tp-dente-regiao) >= 61
     3383                and int(import-anexo-odonto-mov.tp-dente-regiao) <= 65
     3384               )
     3385           or  (    int(import-anexo-odonto-mov.tp-dente-regiao) >= 71
     3386                and int(import-anexo-odonto-mov.tp-dente-regiao) <= 75
     3387               )
     3388           or  (    int(import-anexo-odonto-mov.tp-dente-regiao) >= 81
     3389                and int(import-anexo-odonto-mov.tp-dente-regiao) <= 85
     3390               )
     3391           or  (    int(import-anexo-odonto-mov.tp-dente-regiao) >= 41
     3392                and int(import-anexo-odonto-mov.tp-dente-regiao) <= 48
     3393               )
     3394           or  (    int(import-anexo-odonto-mov.tp-dente-regiao) >= 31
     3395                and int(import-anexo-odonto-mov.tp-dente-regiao) <= 38
     3396               )
     3397           then . /* Perdao! Complicado negar esse if ... */
     3398           else do:
     3399                  run grava-erro(input import-guia.num-seqcial-control,
     3400                                 input "import-anexo-odonto-mov",
     3401                                 input "Dente invalido: " + import-anexo-odonto-mov.tp-dente-regiao + 
     3402                                       " import-anexo-odonto-mov.num-seqcial-anexo: " + string(import-anexo-odonto-mov.num-seqcial-anexo) + 
     3403                                       " import-anexo-odonto.num-seqcial: " + string(import-anexo-odonto.num-seqcial),
     3404                                 input today,
     3405                                 input "Informe um codigo valido para o dente").
     3406                  
     3407                  assign lg-erro-par = yes.
     3408                end.
     3409   
     3410           if  import-anexo-odonto-mov.ind-sit-inicial <> ?
     3411           and import-anexo-odonto-mov.ind-sit-inicial <> ""
     3412           then do:
     3413                  assign ds-sit-ini-aux = trim(import-anexo-odonto-mov.ind-sit-inicial).
     3414   
     3415                  do ix = 1 to length(ds-sit-ini-aux):
     3416                      if  substr(ds-sit-ini-aux,ix,1) <> "A" /* Ausente */
     3417                      and substr(ds-sit-ini-aux,ix,1) <> "E" /* Extracao Indicada */
     3418                      and substr(ds-sit-ini-aux,ix,1) <> "H" /* Higido */
     3419                      and substr(ds-sit-ini-aux,ix,1) <> "C" /* Cariado */
     3420                      and substr(ds-sit-ini-aux,ix,1) <> "R" /* Restaurado */
     3421                      then do:
     3422                             run grava-erro(input import-guia.num-seqcial-control,
     3423                                            input "import-anexo-odonto-mov",
     3424                                            input "Situacao do dente invalida: " + substr(ds-sit-ini-aux,ix,1) + 
     3425                                                  " import-anexo-odonto-mov.num-seqcial-anexo: " + string(import-anexo-odonto-mov.num-seqcial-anexo) + 
     3426                                                  " import-anexo-odonto.num-seqcial: " + string(import-anexo-odonto.num-seqcial),
     3427                                            input today,
     3428                                            input "Informe um codigo valido para a situacao do dente").
     3429                             
     3430                             assign lg-erro-par = yes.
     3431                           end.
     3432                  end.
     3433                end.
     3434       end. /* each import-anexo-odonto-mov */
     3435   
     3436   end procedure.
     3437   
     3438   /* ----------------------------------------------------------------- */
     3439   procedure valida-radioterapia:
     3440   
     3441       def input-output parameter lg-erro-par as log init no no-undo.
     3442   
     3443       find first import-anexo-radio where import-anexo-radio.num-seqcial-import-anexo = import-anexo-solicit.num-seqcial
     3444                                      no-lock no-error.
     3445   
     3446       if not avail import-anexo-radio
     3447       then do:
     3448              IF import-anexo-radio.num-seqcial-import-anexo <> ?
     3449              THEN char-aux1 = string(import-anexo-radio.num-seqcial-import-anexo).
     3450              ELSE char-aux1 = "nulo".
     3451              IF import-anexo-solicit.num-seqcial <> ?
     3452              THEN char-aux2 = string(import-anexo-solicit.num-seqcial).
     3453              ELSE char-aux2 = "nulo".
     3454              
     3455              run grava-erro(input import-guia.num-seqcial-control,
     3456                             input "import-anexo-radio",
     3457                             input "Registro import-anexo-radio nao encontrado. import-anexo-radio.num-seqcial-import-anexo: " + char-aux1 + 
     3458                                   " import-anexo-solicit.num-seqcial: " + char-aux2,
     3459                             input today,
     3460                             input "Registro referente ao anexo de Radioterapia nao encontrado.").
     3461              
     3462              assign lg-erro-par = yes.
     3463              return.
     3464            end.
     3465   
     3466       /* ----------------------------------------------------------------- */
     3467       if  import-anexo-radio.des-cirurgia-ant <> ?
     3468       and import-anexo-radio.des-cirurgia-ant <> ""
     3469       and import-anexo-radio.dat-realiz = ?
     3470       then do:
     3471              IF import-anexo-radio.num-seqcial-import-anexo <> ?
     3472              THEN char-aux1 = string(import-anexo-radio.num-seqcial-import-anexo).
     3473              ELSE char-aux1 = "nulo".
     3474              IF import-anexo-solicit.num-seqcial <> ?
     3475              THEN char-aux2 = string(import-anexo-solicit.num-seqcial).
     3476              ELSE char-aux2 = "nulo".
     3477              
     3478              run grava-erro(input import-guia.num-seqcial-control,
     3479                             input "import-anexo-radio",
     3480                             input "Data de realizacao da ultima cirurgia nao informada. import-anexo-radio.num-seqcial-import-anexo: " + char-aux1 + 
     3481                                   " import-anexo-solicit.num-seqcial: " + char-aux2,
     3482                             input today,
     3483                             input "Quando informado a descricao da cirurgia anterior, a data deve ser informada.").
     3484              
     3485              assign lg-erro-par = yes.
     3486            end.
     3487   
     3488       if  import-anexo-radio.des-quimio <> ?
     3489       and import-anexo-radio.des-quimio <> ""
     3490       and import-anexo-radio.dat-aplic = ?
     3491       then do:
     3492              IF import-anexo-radio.num-seqcial-import-anexo <> ?
     3493              THEN char-aux1 = string(import-anexo-radio.num-seqcial-import-anexo).
     3494              ELSE char-aux1 = "nulo".
     3495              IF import-anexo-solicit.num-seqcial <> ?
     3496              THEN char-aux2 = string(import-anexo-solicit.num-seqcial).
     3497              ELSE char-aux2 = "nulo".
     3498              
     3499              run grava-erro(input import-guia.num-seqcial-control,
     3500                             input "import-anexo-radio",
     3501                             input "Data de realizacao da ultima quimioterapia nao informada. import-anexo-radio.num-seqcial-import-anexo: " + char-aux1 + 
     3502                                   " import-anexo-solicit.num-seqcial: " + char-aux2,
     3503                             input today,
     3504                             input "Quando informado a descricao da qiomioterapia anterior, a data deve ser informada.").
     3505              
     3506              assign lg-erro-par = yes.
     3507            end.
     3508   
     3509       /* ----------------------------------------------------------------- */
     3510       if import-anexo-radio.qti-campos = ?
     3511       or import-anexo-radio.qti-campos = 0
     3512       then do:
     3513              IF import-anexo-radio.num-seqcial-import-anexo <> ?
     3514              THEN char-aux1 = string(import-anexo-radio.num-seqcial-import-anexo).
     3515              ELSE char-aux1 = "nulo".
     3516              IF import-anexo-solicit.num-seqcial <> ?
     3517              THEN char-aux2 = string(import-anexo-solicit.num-seqcial).
     3518              ELSE char-aux2 = "nulo".
     3519              
     3520              run grava-erro(input import-guia.num-seqcial-control,
     3521                             input "import-anexo-radio",
     3522                             input "Campo Numero de Campos irradiados nao informado. import-anexo-radio.num-seqcial-import-anexo: " + char-aux1 +
     3523                                   " import-anexo-solicit.num-seqcial: " + char-aux2,
     3524                             input today,
     3525                             input "Informa a quantidade de campos irradiados.").
     3526              
     3527              assign lg-erro-par = yes.
     3528            end.
     3529   
     3530       /* ----------------------------------------------------------------- */
     3531       if import-anexo-radio.qtd-dosag-diaria = ?
     3532       or import-anexo-radio.qtd-dosag-diaria = 0
     3533       then do:
     3534              IF import-anexo-radio.num-seqcial-import-anexo <> ?
     3535              THEN char-aux1 = string(import-anexo-radio.num-seqcial-import-anexo).
     3536              ELSE char-aux1 = "nulo".
     3537              IF import-anexo-solicit.num-seqcial <> ?
     3538              THEN char-aux2 = string(import-anexo-solicit.num-seqcial).
     3539              ELSE char-aux2 = "nulo".
     3540              
     3541              run grava-erro(input import-guia.num-seqcial-control,
     3542                             input "import-anexo-radio",
     3543                             input "Campo quantidade de doses diarias nao informado. import-anexo-radio.num-seqcial-import-anexo: " + char-aux1 + 
     3544                                   " import-anexo-solicit.num-seqcial: " + char-aux2,
     3545                             input today,
     3546                             input "Informa a quantidade de doses diarias.").
     3547              
     3548              assign lg-erro-par = yes.
     3549            end.
     3550   
     3551       /* ----------------------------------------------------------------- */
     3552       if import-anexo-radio.qtd-dosag-tot = ?
     3553       or import-anexo-radio.qtd-dosag-tot = 0
     3554       then do:
     3555              IF import-anexo-radio.num-seqcial-import-anexo <> ?
     3556              THEN char-aux1 = string(import-anexo-radio.num-seqcial-import-anexo).
     3557              ELSE char-aux1 = "nulo".
     3558              IF import-anexo-solicit.num-seqcial <> ?
     3559              THEN char-aux2 = string(import-anexo-solicit.num-seqcial).
     3560              ELSE char-aux2 = "nulo".
     3561              
     3562              run grava-erro(input import-guia.num-seqcial-control,
     3563                             input "import-anexo-radio",
     3564                             input "Campo quantidade de doses total nao informado. import-anexo-radio.num-seqcial-import-anexo: " + char-aux1 + 
     3565                                   " import-anexo-solicit.num-seqcial: " + char-aux2,
     3566                             input today,
     3567                             input "Informa a quantidade de doses total.").
     3568              
     3569              assign lg-erro-par = yes.
     3570            end.
     3571   
     3572       /* ----------------------------------------------------------------- */
     3573       if import-anexo-radio.num-dias = ?
     3574       or import-anexo-radio.num-dias = 0
     3575       then do:
     3576              IF import-anexo-radio.num-seqcial-import-anexo <> ?
     3577              THEN char-aux1 = string(import-anexo-radio.num-seqcial-import-anexo).
     3578              ELSE char-aux1 = "nulo".
     3579              IF import-anexo-solicit.num-seqcial <> ?
     3580              THEN char-aux2 = string(import-anexo-solicit.num-seqcial).
     3581              ELSE char-aux2 = "nulo".
     3582              
     3583              run grava-erro(input import-guia.num-seqcial-control,
     3584                             input "import-anexo-radio",
     3585                             input "Campo Numero de Dias nao informado. import-anexo-radio.num-seqcial-import-anexo: " + char-aux1 +     
     3586                                   " import-anexo-solicit.num-seqcial: " + char-aux2,
     3587                             input today,
     3588                             input "Informe Numero de Dias do tratamento.").
     3589              
     3590              assign lg-erro-par = yes.
     3591            end.
     3592   
     3593       /* ----------------------------------------------------------------- */
     3594       if import-anexo-radio.dat-inic-adm = ?
     3595       then do:
     3596              IF import-anexo-radio.num-seqcial-import-anexo <> ?
     3597              THEN char-aux1 = string(import-anexo-radio.num-seqcial-import-anexo).
     3598              ELSE char-aux1 = "nulo".
     3599              IF import-anexo-solicit.num-seqcial <> ?
     3600              THEN char-aux2 = string(import-anexo-solicit.num-seqcial).
     3601              ELSE char-aux2 = "nulo".
     3602              
     3603              run grava-erro(input import-guia.num-seqcial-control,
     3604                             input "import-anexo-radio",
     3605                             input "Campo Data de Inicio do Tratamento nao informado. import-anexo-radio.num-seqcial-import-anexo: " + char-aux1 + 
     3606                                   " import-anexo-solicit.num-seqcial: " + char-aux2,
     3607                             input today,
     3608                             input "Informe a data de inicio do tratamento.").
     3609              
     3610              assign lg-erro-par = yes.
     3611            end.
     3612   
     3613       /* ----------------------------------------------------------------- */
     3614       int(import-anexo-radio.cod-estag) no-error.
     3615   
     3616       if error-status:error
     3617       then do:
     3618              IF import-anexo-radio.cod-estag <> ?
     3619              THEN char-aux1 = import-anexo-radio.cod-estag.
     3620              ELSE char-aux1 = "nulo".
     3621              IF import-anexo-radio.num-seqcial-import-anexo <> ?
     3622              THEN char-aux2 = string(import-anexo-radio.num-seqcial-import-anexo).
     3623              ELSE char-aux2 = "nulo".
     3624              IF import-anexo-solicit.num-seqcial <> ?
     3625              THEN char-aux3 = string(import-anexo-solicit.num-seqcial).
     3626              ELSE char-aux3 = "nulo".
     3627              run grava-erro(input import-guia.num-seqcial-control,
     3628                             input "import-anexo-radio",
     3629                             input "Codigo do estadiamento do tumor invalido: " + char-aux1 + 
     3630                                   " import-anexo-radio.num-seqcial-import-anexo: " + char-aux2 + 
     3631                                   " import-anexo-solicit.num-seqcial: " + char-aux3,
     3632                             input today,
     3633                             input "Informe um codigo conforme a tabela 31 da TISS").
     3634   
     3635              assign lg-erro-par = yes.
     3636            end.
     3637   
     3638       if int(import-anexo-radio.cod-estag) < 1
     3639       or int(import-anexo-radio.cod-estag) > 5
     3640       then do:
     3641              IF import-anexo-radio.cod-estag <> ?
     3642              THEN char-aux1 = import-anexo-radio.cod-estag.
     3643              ELSE char-aux1 = "nulo".
     3644              IF import-anexo-radio.num-seqcial-import-anexo <> ?
     3645              THEN char-aux2 = string(import-anexo-radio.num-seqcial-import-anexo).
     3646              ELSE char-aux2 = "nulo".
     3647              IF import-anexo-solicit.num-seqcial <> ?
     3648              THEN char-aux3 = string(import-anexo-solicit.num-seqcial).
     3649              ELSE char-aux3 = "nulo".
     3650              
     3651              run grava-erro(input import-guia.num-seqcial-control,
     3652                             input "import-anexo-radio",
     3653                             input "Codigo do estadiamento do tumor invalido: " + char-aux1 + 
     3654                                   " import-anexo-radio.num-seqcial-import-anexo: " + char-aux2 + 
     3655                                   " import-anexo-solicit.num-seqcial: " + char-aux3,
     3656                             input today,
     3657                             input "Informe um codigo conforme a tabela 31 da TISS").
     3658   
     3659              assign lg-erro-par = yes.
     3660            end.
     3661   
     3662       /* ----------------------------------------------------------------- */
     3663       int(import-anexo-radio.ind-finalid-tratam) no-error.
     3664   
     3665       if error-status:error
     3666       then do:
     3667              run grava-erro(input import-guia.num-seqcial-control,
     3668                             input "import-anexo-radio",
     3669                             input "Codigo da finalidade do tratamento invalida: " + import-anexo-radio.ind-finalid-tratam + 
     3670                                   " import-anexo-radio.num-seqcial-import-anexo " + string(import-anexo-radio.num-seqcial-import-anexo) + 
     3671                                   " import-anexo-solicit.num-seqcial: " +  string(import-anexo-solicit.num-seqcial),
     3672                             input today,
     3673                             input "Informe um codigo conforme a tabela 31 da TISS").
     3674   
     3675              assign lg-erro-par = yes.
     3676            end.
     3677   
     3678       if int(import-anexo-radio.ind-finalid-tratam) < 1
     3679       or int(import-anexo-radio.ind-finalid-tratam) > 5
     3680       then do:
     3681              run grava-erro(input import-guia.num-seqcial-control,
     3682                             input "import-anexo-radio",
     3683                             input "Codigo da finalidade do tratamento invalida: " + import-anexo-radio.ind-finalid-tratam + 
     3684                                   " import-anexo-radio.num-seqcial-import-anexo: "  + string(import-anexo-radio.num-seqcial-import-anexo) +
     3685                                   " import-anexo-solicit.num-seqcial: " + string(import-anexo-solicit.num-seqcial),
     3686                             input today,
     3687                             input "Informe um codigo conforme a tabela 31 da TISS").
     3688   
     3689              assign lg-erro-par = yes.
     3690            end.
     3691   
     3692       /* ----------------------------------------------------------------- */
     3693       int(import-anexo-radio.cod-classif-capac-funcnal) no-error.
     3694   
     3695       if error-status:error
     3696       then do:
     3697              run grava-erro(input import-guia.num-seqcial-control,
     3698                             input "import-anexo-radio",
     3699                             input "Codigo da escala de capacidade funcional invalido: " + import-anexo-radio.cod-classif-capac-funcnal + 
     3700                                   " import-anexo-radio.num-seqcial-import-anexo: " + string(import-anexo-radio.num-seqcial-import-anexo) + 
     3701                                   " import-anexo-solicit.num-seqcial: " + string(import-anexo-solicit.num-seqcial),
     3702                             input today,
     3703                             input "Informe um codigo conforme a tabela 30 da TISS").
     3704   
     3705              assign lg-erro-par = yes.
     3706            end.
     3707   
     3708       if int(import-anexo-radio.cod-classif-capac-funcnal) < 0
     3709       or int(import-anexo-radio.cod-classif-capac-funcnal) > 4
     3710       then do:
     3711              run grava-erro(input import-guia.num-seqcial-control,
     3712                             input "import-anexo-radio",
     3713                             input "Codigo da escala de capacidade funcional invalido: " + import-anexo-radio.cod-classif-capac-funcnal + 
     3714                                   " import-anexo-radio.num-seqcial-import-anexo: " + string(import-anexo-radio.num-seqcial-import-anexo) + 
     3715                                   " import-anexo-solicit.num-seqcial: " + string(import-anexo-solicit.num-seqcial),
     3716                             input today,
     3717                             input "Informe um codigo conforme a tabela 30 da TISS").
     3718   
     3719              assign lg-erro-par = yes.
     3720            end.
     3721   
     3722       /* ------------------- MOVIMENTOS RADIOTERAPIA -------------------- */
     3723       for each import-guia-movto
     3724          where import-guia-movto.ind-tip-guia = "RADI" /* Radioterapia */
     3725            and import-guia-movto.val-seq-guia = import-anexo-radio.num-seqcial
     3726                no-lock:
     3727   
     3728           if  import-guia-movto.ind-tip-movto-guia <> "P"
     3729           then do:
     3730                  run grava-erro(input import-guia.num-seqcial-control,
     3731                                 input "import-anexo-radio",
     3732                                 input "Tipo do movimento informado invalido: "          + import-guia-movto.ind-tip-movto-guia + 
     3733                                       " import-anexo-radio.num-seqcial-import-anexo: "  + string(import-anexo-radio.num-seqcial-import-anexo) + 
     3734                                       " import-anexo-solicit.num-seqcial: "             + string(import-anexo-solicit.num-seqcial) + 
     3735                                       " Tp.Guia(import-guia-movto.ind-tip-guia): "      + string(import-guia-movto.ind-tip-guia) + 
     3736                                       " Nro.Seq.Guia(import-guia-movto.val-seq-guia): " + string(import-guia-movto.val-seq-guia),
     3737                                 input today,
     3738                                 input "Anexo de quimioterapia somente aceita procedimentos").
     3739   
     3740                  assign lg-erro-par = yes.
     3741                end.
     3742   
     3743           if import-guia-movto.dat-previs = ?
     3744           then do:
     3745                  run grava-erro(input import-guia.num-seqcial-control,
     3746                                 input "import-anexo-radio",
     3747                                 input "Data Prevista para aplicacao do medicamento deve ser informada. " +
     3748                                       " import-anexo-radio.num-seqcial-import-anexo: "  + string(import-anexo-radio.num-seqcial-import-anexo) +
     3749                                       " import-anexo-solicit.num-seqcial: "             + string(import-anexo-solicit.num-seqcial) +  
     3750                                       " Tp.Guia(import-guia-movto.ind-tip-guia): "      + string(import-guia-movto.ind-tip-guia) + 
     3751                                       " Nro.Seq.Guia(import-guia-movto.val-seq-guia): " + string(import-guia-movto.val-seq-guia),
     3752                                 input today,
     3753                                 input "Informe o campo Data Prevista.").
     3754   
     3755                  assign lg-erro-par = yes.
     3756                end.
     3757   
     3758           run valida-dados-movimento(input-output lg-erro-par).
     3759   
     3760           run valida-glosas(input        import-guia-movto.ind-tip-guia,
     3761                             input        import-guia-movto.val-seqcia,
     3762                             input        import-anexo-radio.num-seqcial,
     3763                             input-output lg-erro-par).
     3764       end.
     3765   
     3766   end procedure.
     3767   
     3768   /* ----------------------------------------------------------------- */
     3769   procedure valida-opme:
     3770   
     3771       def input-output parameter lg-erro-par as log init no no-undo.
     3772   
     3773       find first import-anexo-opme where import-anexo-opme.num-seqcial-import-anexo = import-anexo-solicit.num-seqcial
     3774                                      no-lock no-error.
     3775   
     3776       if not avail import-anexo-opme
     3777       then do:
     3778              IF import-anexo-opme.num-seqcial-import-anexo <> ?
     3779              THEN char-aux1 = string(import-anexo-opme.num-seqcial-import-anexo).
     3780              ELSE char-aux1 = "nulo".
     3781              IF string(import-anexo-solicit.num-seqcial) <> ?
     3782              THEN char-aux2 = string(import-anexo-solicit.num-seqcial).
     3783              ELSE char-aux2 = "nulo".
     3784              
     3785              run grava-erro(input import-guia.num-seqcial-control,
     3786                             input "import-anexo-opme",
     3787                             input "Registro import-anexo-opme nao encontrado. import-anexo-opme.num-seqcial-import-anexo: " + char-aux1 + 
     3788                                   " import-anexo-solicit.num-seqcial: " + char-aux2,
     3789                             input today,
     3790                             input "Registro referente ao anexo de OPME nao encontrado.").
     3791              
     3792              assign lg-erro-par = yes.
     3793              return.
     3794            end.
     3795   
     3796       /* ----------------------------------------------------------------- */
     3797       /*
     3798       if import-anexo-opme.des-justificativa = ?
     3799       or import-anexo-opme.des-justificativa = ""
     3800       then do: 
     3801              IF import-anexo-opme.num-seqcial-import-anexo <> ?
     3802              THEN char-aux1 = string(import-anexo-opme.num-seqcial-import-anexo).
     3803              ELSE char-aux1 = "nulo".
     3804              IF import-anexo-solicit.num-seqcial <> ?
     3805              THEN char-aux2 = string(import-anexo-solicit.num-seqcial).
     3806              ELSE char-aux2 = "nulo".
     3807              run grava-erro(input import-guia.num-seqcial-control,
     3808                             input "import-anexo-opme",
     3809                             input "Justificativa Tecnica do material solicitado nao informada.",
     3810                             input today,
     3811                             input "import-anexo-opme.num-seqcial-import-anexo: " + char-aux1 + 
     3812                                   " import-anexo-solicit.num-seqcial: " + char-aux2).
     3813              
     3814              assign lg-erro-par = yes.
     3815            end.
     3816   */
     3817       /* ----------------------------------------------------------------- */
     3818       /*
     3819       if import-anexo-opme.des-especif-mater = ?
     3820       or import-anexo-opme.des-especif-mater = ""
     3821       then do:
     3822              IF import-anexo-opme.num-seqcial-import-anexo <> ?
     3823              THEN char-aux1 = string(import-anexo-opme.num-seqcial-import-anexo).
     3824              ELSE char-aux1 = "nulo".
     3825              IF import-anexo-solicit.num-seqcial <> ?
     3826              THEN char-aux2 = string(import-anexo-solicit.num-seqcial).
     3827              ELSE char-aux2 = "nulo".
     3828              
     3829              run grava-erro(input import-guia.num-seqcial-control,
     3830                             input "import-anexo-opme",
     3831                             input "Especificacao do material solicitado nao informada. import-anexo-opme.num-seqcial-import-anexo: " + char-aux1 + 
     3832                                   " import-anexo-solicit.num-seqcial: " + char-aux2,
     3833                             input today,
     3834                             input "Informe a especificacao do material.").
     3835              
     3836              assign lg-erro-par = yes.
     3837            end.
     3838   */
     3839       /* ------------------- MOVIMENTOS OPME -------------------- */
     3840       for each import-guia-movto
     3841          where import-guia-movto.ind-tip-guia = "OPME"
     3842            and import-guia-movto.val-seq-guia = import-anexo-opme.num-seqcial
     3843                no-lock:
     3844   
     3845           if  import-guia-movto.ind-tip-movto-guia <> "I"
     3846           then do:
     3847                  IF import-guia-movto.ind-tip-movto-guia <> ?
     3848                  THEN char-aux1 = import-guia-movto.ind-tip-movto-guia.
     3849                  ELSE char-aux1 = "nulo".
     3850                  IF import-anexo-opme.num-seqcial-import-anexo <> ?
     3851                  THEN char-aux2 = string(import-anexo-opme.num-seqcial-import-anexo).
     3852                  ELSE char-aux2 = "nulo".
     3853                  if import-anexo-solicit.num-seqcial <> ?
     3854                  THEN char-aux3 = string(import-anexo-solicit.num-seqcial).
     3855                  ELSE char-aux3 = "nulo".
     3856                  run grava-erro(input import-guia.num-seqcial-control,
     3857                                 input "import-anexo-opme",
     3858                                 input "Tipo do movimento informado invalido: " + char-aux1 + 
     3859                                       " import-anexo-opme.num-seqcial-import-anexo: " + char-aux2 + 
     3860                                       " import-anexo-solicit.num-seqcial: " + char-aux3,
     3861                                 input today,
     3862                                 input "Anexo de quimioterapia somente aceita insumos OPME").
     3863   
     3864                  assign lg-erro-par = yes.
     3865                end.
     3866   
     3867           int(import-guia-movto.des-opc-fabrican) no-error.
     3868   
     3869           if error-status:error
     3870           or int(import-guia-movto.des-opc-fabrican) <= 0
     3871           then do:
     3872                  IF import-guia-movto.ind-tip-movto-guia <> ?
     3873                  then char-aux1 = import-guia-movto.ind-tip-movto-guia.
     3874                  else char-aux1 = "nulo".
     3875                  IF import-anexo-opme.num-seqcial-import-anexo <> ?
     3876                  THEN char-aux2 = string(import-anexo-opme.num-seqcial-import-anexo).
     3877                  else char-aux2 = "nulo".
     3878                  IF import-anexo-solicit.num-seqcial <> ?
     3879                  THEN char-aux3 = string(import-anexo-solicit.num-seqcial).
     3880                  ELSE char-aux3 = "nulo".
     3881                  
     3882                  run grava-erro(input import-guia.num-seqcial-control,
     3883                                 input "import-anexo-opme",
     3884                                 input "Opcao do fabricante invalida: " + char-aux1 + 
     3885                                       " import-anexo-opme.num-seqcial-import-anexo: " + char-aux2 + 
     3886                                       " import-anexo-solicit.num-seqcial: " + char-aux3,
     3887                                 input today,
     3888                                 input "Informe um valor maior que zero").
     3889                  
     3890                  assign lg-erro-par = yes.
     3891                end.
     3892   
     3893           run valida-dados-movimento(input-output lg-erro-par).
     3894   
     3895           run valida-glosas(input        import-guia-movto.ind-tip-guia,
     3896                             input        import-guia-movto.val-seqcia,
     3897                             input        import-anexo-opme.num-seqcial,
     3898                             input-output lg-erro-par).
     3899       end.
     3900   
     3901   end procedure.
     3902   
     3903   /* ----------------------------------------------------------------- */
     3904   procedure valida-quimioterapia:
     3905   
     3906       def input-output parameter lg-erro-par as log init no no-undo.
     3907   
     3908       find first import-anexo-quimio where import-anexo-quimio.num-seqcial-import-anexo = import-anexo-solicit.num-seqcial
     3909                                      no-lock no-error.
     3910   
     3911       if not avail import-anexo-quimio
     3912       then do:
     3913              IF import-anexo-quimio.num-seqcial-import-anexo <> ?
     3914              THEN char-aux1 = string(import-anexo-quimio.num-seqcial-import-anexo).
     3915              ELSE char-aux1 = "nulo".
     3916              IF import-anexo-solicit.num-seqcial <> ?
     3917              THEN char-aux2 = string(import-anexo-solicit.num-seqcial).
     3918              ELSE char-aux2 = "nulo".
     3919              run grava-erro(input import-guia.num-seqcial-control,
     3920                             input "import-anexo-quimio",
     3921                             input "Tabela import-anexo-quimio nao encontrada. import-anexo-quimio.num-seqcial-import-anexo: " + char-aux1 + 
     3922                                   " import-anexo-solicit.num-seqcial: " + char-aux2,
     3923                             input today,
     3924                             input "Registro referente ao anexo de quimioterapia nao encontrado").
     3925              
     3926              assign lg-erro-par = yes.
     3927              return.
     3928            end.
     3929   
     3930       /* ----------------------------------------------------------------- */
     3931       /*
     3932       if import-anexo-quimio.val-peso-bnfciar = ?
     3933       or import-anexo-quimio.val-peso-bnfciar = 0
     3934       then do:
     3935              IF import-anexo-quimio.num-seqcial-import-anexo <> ?
     3936              THEN char-aux1 = string(import-anexo-quimio.num-seqcial-import-anexo).
     3937              ELSE char-aux1 = "nulo".
     3938              IF import-anexo-solicit.num-seqcial <> ?
     3939              THEN char-aux2 = string(import-anexo-solicit.num-seqcial).
     3940              else char-aux2 = "nulo".
     3941              run grava-erro(input import-guia.num-seqcial-control,
     3942                             input "import-anexo-quimio",
     3943                             input "Peso do beneficiario nao informado. import-anexo-quimio.num-seqcial-import-anexo: " + char-aux1 + 
     3944                                   " import-anexo-solicit.num-seqcial: " + char-aux2,
     3945                             input today,
     3946                             input "Informe o peso do beneficiario").
     3947              
     3948              assign lg-erro-par = yes.
     3949            end.
     3950   */
     3951       /* ----------------------------------------------------------------- */
     3952       /*
     3953       if import-anexo-quimio.val-alt-bnfciar = ?
     3954       or import-anexo-quimio.val-alt-bnfciar = 0
     3955       then do:
     3956              IF import-anexo-quimio.num-seqcial-import-anexo <> ?
     3957              THEN char-aux1 = string(import-anexo-quimio.num-seqcial-import-anexo).
     3958              ELSE char-aux1 = "nulo".
     3959              IF import-anexo-solicit.num-seqcial <> ?
     3960              THEN char-aux2 = string(import-anexo-solicit.num-seqcial).
     3961              ELSE char-aux2 = "nulo".
     3962              run grava-erro(input import-guia.num-seqcial-control,
     3963                             input "import-anexo-quimio",
     3964                             input "Altura do beneficiario nao informado. import-anexo-quimio.num-seqcial-import-anexo: " + char-aux1 + 
     3965                                   " import-anexo-solicit.num-seqcial: " + char-aux2,
     3966                             input today,
     3967                             input "Informe a altura do beneficiario").
     3968              
     3969              assign lg-erro-par = yes.
     3970            end.
     3971        */
     3972       /* ----------------------------------------------------------------- */
     3973       /*
     3974       if import-anexo-quimio.val-sup-cor-bnfciar = ?
     3975       or import-anexo-quimio.val-sup-cor-bnfciar = 0
     3976       then do:
     3977              IF import-anexo-quimio.num-seqcial-import-anexo <> ?
     3978              THEN char-aux1 = string(import-anexo-quimio.num-seqcial-import-anexo).
     3979              ELSE char-aux1 = "nulo".
     3980              IF import-anexo-solicit.num-seqcial <> ?
     3981              then char-aux2 = string(import-anexo-solicit.num-seqcial).
     3982              else char-aux2 = "nulo".
     3983              run grava-erro(input import-guia.num-seqcial-control,
     3984                             input "import-anexo-quimio",
     3985                             input "Superficie corporal do beneficiario nao informada. import-anexo-quimio.num-seqcial-import-anexo: " + char-aux1 + 
     3986                                   " import-anexo-solicit.num-seqcial: " + char-aux2,
     3987                             input today,
     3988                             input "Informe a superficie corporal do beneficiario").
     3989              
     3990              assign lg-erro-par = yes.
     3991            end.
     3992   */
     3993       /* ----------------------------------------------------------------- */
     3994       /*
     3995       if import-anexo-quimio.num-ciclo = ?
     3996       or import-anexo-quimio.num-ciclo = 0
     3997       then do:
     3998              IF import-anexo-quimio.num-seqcial-import-anexo <> ?
     3999              THEN char-aux1 = string(import-anexo-quimio.num-seqcial-import-anexo).
     4000              ELSE char-aux1 = "nulo".
     4001              IF import-anexo-solicit.num-seqcial <> ?
     4002              then Char-aux2 = string(import-anexo-solicit.num-seqcial).
     4003              ELSE char-aux2 = "nulo".
     4004              IF import-anexo-quimio.num-seqcial-import-anexo <> ?
     4005              THEN char-aux3 = string(import-anexo-quimio.num-seqcial-import-anexo).
     4006              ELSE char-aux3 = "nulo".
     4007              run grava-erro(input import-guia.num-seqcial-control,
     4008                             input "import-anexo-quimio",
     4009                             input "Campo Numero de Ciclos nao informado. import-anexo-quimio.num-seqcial-import-anexo: " + char-aux1 + 
     4010                                   " import-anexo-solicit.num-seqcial: " + char-aux2,
     4011                             input today,
     4012                             input "Informe o numero de ciclos do tratamento. import-anexo-quimio.num-seqcial-import-anexo: " + char-aux3).
     4013              
     4014              assign lg-erro-par = yes.
     4015            end.
     4016   */
     4017       /* ----------------------------------------------------------------- */
     4018       /*
     4019       if import-anexo-quimio.num-ciclo-atual = ?
     4020       or import-anexo-quimio.num-ciclo-atual = 0
     4021       then do:
     4022              IF import-anexo-quimio.num-seqcial-import-anexo <> ?
     4023              THEN char-aux1 = string(import-anexo-quimio.num-seqcial-import-anexo).
     4024              ELSE char-aux1 = "nulo".
     4025              IF import-anexo-solicit.num-seqcial <> ?
     4026              THEN char-aux2 = string(import-anexo-solicit.num-seqcial).
     4027              else CHAR-aux2 = "nulo".
     4028              IF import-anexo-quimio.num-seqcial-import-anexo <> ?
     4029              THEN char-aux3 = string(import-anexo-quimio.num-seqcial-import-anexo).
     4030              ELSE char-aux3 = "nulo".
     4031              run grava-erro(input import-guia.num-seqcial-control,
     4032                             input "import-anexo-quimio",
     4033                             input "Campo Numero do Ciclo Atual nao informado import-anexo-quimio.num-seqcial-import-anexo: " + char-aux1 + 
     4034                                   " import-anexo-solicit.num-seqcial: " + char-aux2,
     4035                             input today,
     4036                             input "Informe o numero do ciclo atual do tratamento. import-anexo-quimio.num-seqcial-import-anexo: " + char-aux3).
     4037              
     4038              assign lg-erro-par = yes.
     4039            end.
     4040   */
     4041       /* ----------------------------------------------------------------- */
     4042       /*
     4043       if import-anexo-quimio.num-interv-ciclo = ?
     4044       or import-anexo-quimio.num-interv-ciclo = 0
     4045       then do:
     4046              IF import-anexo-quimio.num-seqcial-import-anexo <> ?
     4047              THEN char-aux1 = string(import-anexo-quimio.num-seqcial-import-anexo).
     4048              else char-aux2 = "nulo".
     4049              IF import-anexo-solicit.num-seqcial <> ?
     4050              THEN char-aux2 = string(import-anexo-solicit.num-seqcial).
     4051              ELSE char-aux2 = "nulo".
     4052              IF import-anexo-quimio.num-seqcial-import-anexo <> ?
     4053              THEN char-aux3 = string(import-anexo-quimio.num-seqcial-import-anexo).
     4054              ELSE char-aux3 = "nulo".
     4055              run grava-erro(input import-guia.num-seqcial-control,
     4056                             input "import-anexo-quimio",
     4057                             input "Campo Numero de Intervalo entre Ciclos nao informado import-anexo-quimio.num-seqcial-import-anexo: " + char-aux1 + 
     4058                                   " import-anexo-solicit.num-seqcial: " + char-aux2,
     4059                             input today,
     4060                             input "Informe o numero do intervalo entre ciclos do tratamento. import-anexo-quimio.num-seqcial-import-anexo: " + char-aux3).
     4061              
     4062              assign lg-erro-par = yes.
     4063            end.
     4064   */
     4065       /* ----------------------------------------------------------------- */
     4066       if  import-anexo-quimio.des-cirurgia-ant <> ?
     4067       and import-anexo-quimio.des-cirurgia-ant <> ""
     4068       and import-anexo-quimio.dt-realizacao     = ?
     4069       then do:
     4070              IF import-anexo-quimio.num-seqcial-import-anexo <> ?
     4071              THEN char-aux1 = string(import-anexo-quimio.num-seqcial-import-anexo).
     4072              ELSE char-aux1 = "nulo".
     4073              IF import-anexo-solicit.num-seqcial <> ?
     4074              THEN char-aux2 = string(import-anexo-solicit.num-seqcial).
     4075              ELSE char-aux2 = "nulo".
     4076              IF import-anexo-quimio.num-seqcial-import-anexo <> ?
     4077              THEN char-aux3 = string(import-anexo-quimio.num-seqcial-import-anexo).
     4078              ELSE char-aux3 = "nulo".
     4079              run grava-erro(input import-guia.num-seqcial-control,
     4080                             input "import-anexo-quimio",
     4081                             input "Data de realizacao de cirurgia anterior nao informada. import-anexo-quimio.num-seqcial-import-anexo: " + char-aux1 + 
     4082                                   " import-anexo-solicit.num-seqcial: " + char-aux2,
     4083                             input today,
     4084                             input "Quando informada descricao da cirurgia anterior, a sua data deve ser informada. import-anexo-quimio.num-seqcial-import-anexo: " + char-aux3).
     4085              
     4086              assign lg-erro-par = yes.
     4087            end.
     4088   
     4089       /* ----------------------------------------------------------------- */
     4090       if  import-anexo-quimio.des-area <> ?
     4091       and import-anexo-quimio.des-area <> ""
     4092       and import-anexo-quimio.dat-aplic-radio = ?
     4093       then do:
     4094              IF import-anexo-quimio.num-seqcial-import-anexo <> ?
     4095              THEN char-aux1 = string(import-anexo-quimio.num-seqcial-import-anexo).
     4096              ELSE char-aux1 = "nulo".
     4097              IF import-anexo-solicit.num-seqcial <> ?
     4098              THEN char-aux2 = string(import-anexo-solicit.num-seqcial).
     4099              ELSE char-aux2 = "nulo".
     4100              
     4101              run grava-erro(input import-guia.num-seqcial-control,
     4102                             input "import-anexo-quimio",
     4103                             input "Data de aplicacao da radioterapia anterior nao informada. import-anexo-quimio.num-seqcial-import-anexo: " + char-aux1 + 
     4104                                   " import-anexo-solicit.num-seqcial: " + char-aux2,
     4105                             input today,
     4106                             input "Quando informada descricao da radioterapia anterior, a sua data deve ser informada.").
     4107              
     4108              assign lg-erro-par = yes.
     4109            end.
     4110   
     4111       /* ----------------------------------------------------------------- */
     4112       int(import-anexo-quimio.cod-estag) no-error.
     4113   
     4114       if error-status:error
     4115       then do:
     4116              IF import-anexo-quimio.cod-estag <> ?
     4117              THEN char-aux1 = import-anexo-quimio.cod-estag.
     4118              ELSE char-aux1 = "nulo".
     4119              IF import-anexo-quimio.num-seqcial-import-anexo <> ?
     4120              THEN char-aux2 = string(import-anexo-quimio.num-seqcial-import-anexo).
     4121              ELSE char-aux2 = "nulo".
     4122              if import-anexo-solicit.num-seqcia <> ?
     4123              THEN char-aux3 = string(import-anexo-solicit.num-seqcial).
     4124              ELSE char-aux3 = "nulo".
     4125              run grava-erro(input import-guia.num-seqcial-control,
     4126                             input "import-anexo-quimio",
     4127                             input "Codigo do estadiamento do tumor invalido: " + char-aux1 + 
     4128                                   " import-anexo-quimio.num-seqcial-import-anexo: " + char-aux2 + 
     4129                                   " import-anexo-solicit.num-seqcial: " + char-aux3,
     4130                             input today,
     4131                             input "Informe um codigo conforme a tabela 31 da TISS").
     4132              
     4133              assign lg-erro-par = yes.
     4134            end.
     4135   
     4136       if int(import-anexo-quimio.cod-estag) < 1
     4137       or int(import-anexo-quimio.cod-estag) > 5
     4138       then do:
     4139              if import-anexo-quimio.cod-estag <> ?
     4140              THEN char-aux1 = import-anexo-quimio.cod-estag.
     4141              ELSE char-aux1 = "nulo".
     4142              IF import-anexo-quimio.num-seqcial-import-anexo <> ?
     4143              THEN char-aux2 = string(import-anexo-quimio.num-seqcial-import-anexo).
     4144              else char-aux2 = "nulo".
     4145              IF import-anexo-solicit.num-seqcial <> ?
     4146              THEN char-aux3 = string(import-anexo-solicit.num-seqcial).
     4147              ELSE char-aux3 = "nulo".
     4148              run grava-erro(input import-guia.num-seqcial-control,
     4149                             input "import-anexo-quimio",
     4150                             input "Codigo do estadiamento do tumor invalido: " + char-aux1 + 
     4151                                   " import-anexo-quimio.num-seqcial-import-anexo: " + char-aux2 + 
     4152                                   " import-anexo-solicit.num-seqcial: " + char-aux3,
     4153                             input today,
     4154                             input "Informe um codigo conforme a tabela 31 da TISS").
     4155              
     4156              assign lg-erro-par = yes.
     4157            end.
     4158   
     4159       /* ----------------------------------------------------------------- */
     4160       int(import-anexo-quimio.ind-finalid-tratam) no-error.
     4161   
     4162       if error-status:error
     4163       then do:
     4164              IF import-anexo-quimio.ind-finalid-tratam <> ?
     4165              THEN char-aux1 = import-anexo-quimio.ind-finalid-tratam.
     4166              ELSE char-aux1 = "nulo".
     4167              IF import-anexo-quimio.num-seqcial-import-anexo <> ?
     4168              THEN char-aux2 = string(import-anexo-quimio.num-seqcial-import-anexo).
     4169              ELSE char-aux2 = "nulo".
     4170              IF import-anexo-solicit.num-seqcial <> ?
     4171              THEN char-aux3 = string(import-anexo-solicit.num-seqcial).
     4172              else char-aux3 = "nulo".
     4173              run grava-erro(input import-guia.num-seqcial-control,
     4174                             input "import-anexo-quimio",
     4175                             input "Codigo da finalidade do tratamento invalida: " + char-aux1 +
     4176                                   " import-anexo-quimio.num-seqcial-import-anexo: " + char-aux2 + 
     4177                                   " import-anexo-solicit.num-seqcial: " + char-aux3,
     4178                             input today,
     4179                             input "Informe um codigo conforme a tabela 31 da TISS").
     4180              
     4181              assign lg-erro-par = yes.
     4182            end.
     4183   
     4184       if int(import-anexo-quimio.ind-finalid-tratam) < 1
     4185       or int(import-anexo-quimio.ind-finalid-tratam) > 5
     4186       then do:
     4187              IF import-anexo-quimio.ind-finalid-tratam <> ?
     4188              THEN char-aux1 = import-anexo-quimio.ind-finalid-tratam.
     4189              ELSE char-aux1 = "nulo".
     4190              IF import-anexo-quimio.num-seqcial-import-anexo <> ?
     4191              then char-aux2 = string(import-anexo-quimio.num-seqcial-import-anexo).
     4192              ELSE char-aux2 = "nulo".
     4193              if import-anexo-solicit.num-seqcial <> ?
     4194              THEN char-aux3 = string(import-anexo-solicit.num-seqcial).
     4195              else char-aux3 = "nulo".
     4196              run grava-erro(input import-guia.num-seqcial-control,
     4197                             input "import-anexo-quimio",
     4198                             input "Codigo da finalidade do tratamento invalida: " + char-aux1 + 
     4199                                   " import-anexo-quimio.num-seqcial-import-anexo: " + char-aux2 + 
     4200                                   " import-anexo-solicit.num-seqcial: " + char-aux3,
     4201                             input today,
     4202                             input "Informe um codigo conforme a tabela 31 da TISS").
     4203              
     4204              assign lg-erro-par = yes.
     4205            end.
     4206   
     4207       /* ----------------------------------------------------------------- */
     4208       int(import-anexo-quimio.ind-tip-quimio) no-error.
     4209   
     4210       if error-status:error
     4211       then do:
     4212              IF import-anexo-quimio.ind-tip-quimio <> ?
     4213              THEN char-aux1 = import-anexo-quimio.ind-tip-quimio.
     4214              ELSE char-aux1 = "nulo".
     4215              IF import-anexo-quimio.num-seqcial-import-anexo <> ?
     4216              THEN char-aux2 = string(import-anexo-quimio.num-seqcial-import-anexo).
     4217              ELSE char-aux2 = "nulo".
     4218              IF import-anexo-solicit.num-seqcial <> ?
     4219              then char-aux3 = string(import-anexo-solicit.num-seqcial).
     4220              ELSE char-aux3 = "nulo".
     4221              
     4222              run grava-erro(input import-guia.num-seqcial-control,
     4223                             input "import-anexo-quimio",
     4224                             input "Codigo do tipo de quimioterapia invalido: " + char-aux1 + 
     4225                                   " import-anexo-quimio.num-seqcial-import-anexo: " + char-aux2 + 
     4226                                   " import-anexo-solicit.num-seqcial: " + char-aux3,
     4227                             input today,
     4228                             input "Informe um codigo conforme a tabela 58 da TISS").
     4229              
     4230              assign lg-erro-par = yes.
     4231            end.
     4232   
     4233       if int(import-anexo-quimio.ind-tip-quimio) < 1
     4234       or int(import-anexo-quimio.ind-tip-quimio) > 4
     4235       then do:
     4236              IF import-anexo-quimio.ind-tip-quimio <> ?
     4237              THEN char-aux1 = import-anexo-quimio.ind-tip-quimio.
     4238              ELSE char-aux1 = "nulo".
     4239              IF import-anexo-quimio.num-seqcial-import-anexo <> ?
     4240              THEN char-aux2 = string(import-anexo-quimio.num-seqcial-import-anexo).
     4241              ELSE char-aux2 = "nulo".
     4242              IF import-anexo-solicit.num-seqcial <> ?
     4243              THEN char-aux3 = string(import-anexo-solicit.num-seqcial).
     4244              ELSE char-aux3 = "nulo".
     4245              
     4246              run grava-erro(input import-guia.num-seqcial-control,
     4247                             input "import-anexo-quimio",
     4248                             input "Codigo do tipo de quimioterapia invalido: " + char-aux1 + 
     4249                                   " import-anexo-quimio.num-seqcial-import-anexo: " + char-aux2 + 
     4250                                   " import-anexo-solicit.num-seqcial: " + char-aux3,
     4251                             input today,
     4252                             input "Informe um codigo conforme a tabela 58 da TISS").
     4253              
     4254              assign lg-erro-par = yes.
     4255            end.
     4256   
     4257       /* ----------------------------------------------------------------- */
     4258       int(import-anexo-quimio.cod-classif-capac-funcnal) no-error.
     4259   
     4260       if error-status:error
     4261       then do:
     4262              IF import-anexo-quimio.cod-classif-capac-funcnal <> ?
     4263              THEN char-aux1 = import-anexo-quimio.cod-classif-capac-funcnal.
     4264              ELSE char-aux1 = "nulo".
     4265              IF import-anexo-quimio.num-seqcial-import-anexo <> ?
     4266              THEN char-aux2 = string(import-anexo-quimio.num-seqcial-import-anexo).
     4267              ELSE char-aux2 = "nulo".
     4268              IF import-anexo-solicit.num-seqcial <> ?
     4269              THEN char-aux3 = string(import-anexo-solicit.num-seqcial).
     4270              ELSE char-aux3 = "nulo".
     4271              
     4272              run grava-erro(input import-guia.num-seqcial-control,
     4273                             input "import-anexo-quimio",
     4274                             input "Codigo da escala de capacidade funcional invalido: " + char-aux1 + 
     4275                                   " import-anexo-quimio.num-seqcial-import-anexo: " + char-aux2 + 
     4276                                   " import-anexo-solicit.num-seqcial: " + char-aux3,
     4277                             input today,
     4278                             input "Informe um codigo conforme a tabela 30 da TISS").
     4279              
     4280              assign lg-erro-par = yes.
     4281            end.
     4282   
     4283       if int(import-anexo-quimio.cod-classif-capac-funcnal) < 0
     4284       or int(import-anexo-quimio.cod-classif-capac-funcnal) > 4
     4285       then do:
     4286              IF import-anexo-quimio.cod-classif-capac-funcnal <> ?
     4287              THEN char-aux1 = import-anexo-quimio.cod-classif-capac-funcnal.
     4288              else char-aux1 = "nulo".
     4289              
     4290              run grava-erro(input import-guia.num-seqcial-control,
     4291                             input "import-anexo-quimio",
     4292                             input "Codigo da escala de capacidade funcional invalido: " + char-aux1 + 
     4293                                   " import-anexo-quimio.num-seqcial-import-anexo: " + string(import-anexo-quimio.num-seqcial-import-anexo) + 
     4294                                   " import-anexo-solicit.num-seqcial: " + string(import-anexo-solicit.num-seqcial),
     4295                             input today,
     4296                             input "Informe um codigo conforme a tabela 30 da TISS").
     4297              
     4298              assign lg-erro-par = yes.
     4299            end.
     4300   
     4301       /* ----------------------------------------------------------------- */
     4302       if import-anexo-quimio.des-plano-terap = ?
     4303       or import-anexo-quimio.des-plano-terap = ""
     4304       then do:
     4305              run grava-erro(input import-guia.num-seqcial-control,
     4306                             input "import-anexo-quimio",
     4307                             input "Descricao do plano terapeutico nao informado. import-anexo-quimio.num-seqcial-import-anexo: " + string(import-anexo-quimio.num-seqcial-import-anexo) + 
     4308                                   " import-anexo-solicit.num-seqcial: " + string(import-anexo-solicit.num-seqcial),
     4309                             input today,
     4310                             input "Informe a descricao do plano terapeutico").
     4311              
     4312              assign lg-erro-par = yes.
     4313            end.
     4314   
     4315       /* ------------------- MOVIMENTOS QUIMIOTERAPIA -------------------- */
     4316       for each import-guia-movto
     4317          where import-guia-movto.ind-tip-guia = "QUIM" /* Quimioterapia */
     4318            and import-guia-movto.val-seq-guia = import-anexo-quimio.num-seqcial
     4319                no-lock:
     4320   
     4321           if  import-guia-movto.ind-tip-movto-guia <> "I"
     4322           then do:
     4323                  run grava-erro(input import-guia.num-seqcial-control,
     4324                                 input "import-anexo-quimio",
     4325                                 input "Tipo do movimento informado invalido: " + import-guia-movto.ind-tip-movto-guia + 
     4326                                       " import-anexo-quimio.num-seqcial-import-anexo: " + string(import-anexo-quimio.num-seqcial-import-anexo) +
     4327                                       " import-anexo-solicit.num-seqcial: "             + string(import-anexo-solicit.num-seqcial) + 
     4328                                       " Tp.Guia(import-guia-movto.ind-tip-guia): "      + string(import-guia-movto.ind-tip-guia)  +
     4329                                       " Nro.Seq.Guia(import-guia-movto.val-seq-guia): " + string(import-guia-movto.val-seq-guia),
     4330                                 input today,
     4331                                 input "Anexo de quimioterapia somente aceita medicamentos (insumos)").
     4332   
     4333                  assign lg-erro-par = yes.
     4334                end.
     4335   
     4336           if import-guia-movto.dat-previs = ?
     4337           then do:
     4338                  run grava-erro(input import-guia.num-seqcial-control,
     4339                                 input "import-anexo-quimio",
     4340                                 input "Data Prevista para aplicacao do medicamento deve ser informada. " + 
     4341                                       " import-anexo-quimio.num-seqcial-import-anexo: " + string(import-anexo-quimio.num-seqcial-import-anexo) + 
     4342                                       " import-anexo-solicit.num-seqcial: "             + string(import-anexo-solicit.num-seqcial) + 
     4343                                       " Tp.Guia(import-guia-movto.ind-tip-guia): "      + string(import-guia-movto.ind-tip-guia)  +
     4344                                       " Nro.Seq.Guia(import-guia-movto.val-seq-guia): " + string(import-guia-movto.val-seq-guia),
     4345                                 input today,
     4346                                 input "Informe o campo Data Prevista.").
     4347                  
     4348                  assign lg-erro-par = yes.
     4349                end.
     4350   
     4351           int(import-guia-movto.cdn-via-administ) no-error.
     4352   
     4353           if error-status:error
     4354           then do:
     4355                  IF import-guia-movto.cdn-via-administ <> ?
     4356                  THEN char-aux1 = string(import-guia-movto.cdn-via-administ).
     4357                  else char-aux1 = "nulo".
     4358                  run grava-erro(input import-guia.num-seqcial-control,
     4359                                 input "import-anexo-quimio",
     4360                                 input "Via de administracao invalida: " + char-aux1 + 
     4361                                       " import-anexo-quimio.num-seqcial-import-anexo: " + string(import-anexo-quimio.num-seqcial-import-anexo) +
     4362                                       " import-anexo-solicit.num-seqcial: "             + string(import-anexo-solicit.num-seqcial) + 
     4363                                       " Tp.Guia(import-guia-movto.ind-tip-guia): "      + string(import-guia-movto.ind-tip-guia)  +
     4364                                       " Nro.Seq.Guia(import-guia-movto.val-seq-guia): " + string(import-guia-movto.val-seq-guia),
     4365                                 input today,
     4366                                 input "Informe um valor conforme a tabela 62 da TISS").
     4367                  
     4368                  assign lg-erro-par = yes.
     4369                end.
     4370   
     4371           if import-guia-movto.cdn-freq = 0
     4372           then do:
     4373                  run grava-erro(input import-guia.num-seqcial-control,
     4374                                 input "import-anexo-quimio",
     4375                                 input "Frequencia de utilizacao deve ser informada (import-guia-movto.cdn-freq)." + 
     4376                                       " import-anexo-quimio.num-seqcial-import-anexo: " + string(import-anexo-quimio.num-seqcial-import-anexo) +
     4377                                       " import-anexo-solicit.num-seqcial: "             + string(import-anexo-solicit.num-seqcial) + 
     4378                                       " Tp.Guia(import-guia-movto.ind-tip-guia): "      + string(import-guia-movto.ind-tip-guia)  +
     4379                                       " Nro.Seq.Guia(import-guia-movto.val-seq-guia): " + string(import-guia-movto.val-seq-guia),
     4380                                 input today,
     4381                                 input "Informe o campo Frequencia.").
     4382                  
     4383                  assign lg-erro-par = yes.
     4384                end.
     4385           run valida-dados-movimento(input-output lg-erro-par).
     4386   
     4387           run valida-glosas(input        import-guia-movto.ind-tip-guia,
     4388                             input        import-guia-movto.val-seqcia,
     4389                             input        import-anexo-quimio.num-seqcial,
     4390                             input-output lg-erro-par).
     4391       end.
     4392   
     4393   end procedure.
     4394   
     4395   /* ----------------------------------------------------------------- */
     4396   procedure valida-dados-gerais-anexos:
     4397   
     4398       def input-output parameter lg-erro-par as log init no no-undo.
     4399   
     4400       if  trim(import-anexo-solicit.ind-tip-anexo) <> "1" /* Quimio */
     4401       and trim(import-anexo-solicit.ind-tip-anexo) <> "2" /* Radio */
     4402       and trim(import-anexo-solicit.ind-tip-anexo) <> "3" /* OPME */
     4403       and trim(import-anexo-solicit.ind-tip-anexo) <> "4" /* Odonto */
     4404       then do:
     4405              run grava-erro(input import-guia.num-seqcial-control,
     4406                             input "import-anexo-solicit",
     4407                             input "Tipo do anexo informado invalido: "     + trim(import-anexo-solicit.ind-tip-anexo) + 
     4408                                   " import-anexo-solicit.num-seq-import: " + string(import-anexo-solicit.num-seq-import) + 
     4409                                   " import-anexo-solicit.num-seqcial: "    + string(import-anexo-solicit.num-seqcial),
     4410                             input today,
     4411                             input "Informa um tipo de anexo valido: 1, 2, 3 ou 4").
     4412              
     4413              assign lg-erro-par = yes.
     4414            end.
     4415   
     4416       /* ----------------------------------------------------------------- */
     4417       if  avail tip-guia
     4418       and tip-guia.int-11 <> 1
     4419       then do:
     4420              run grava-erro(input import-guia.num-seqcial-control,
     4421                             input "import-guia",
     4422                             input "Tipo de Guia nao aceita anexos clinicos TISS. import-anexo-solicit.num-seq-import: " + string(import-anexo-solicit.num-seq-import) + 
     4423                                   " import-anexo-solicit.num-seqcial: " + string(import-anexo-solicit.num-seqcial),
     4424                             input today,
     4425                             input "Para guias com anexos clinicos, informe um tipo de guia permita anexos clinicos TISS").
     4426   
     4427              assign lg-erro-par = yes.
     4428            end.
     4429   
     4430   end procedure.
     4431   
     4432   /* ----------------------------------------------------------------- */
     4433   procedure valida-prorrogacao:
     4434   
     4435       def input-output parameter lg-erro-par as log init no no-undo.
     4436   
     4437       find first import-guia-prorrog where import-guia-prorrog.num-seq-import = import-guia.num-seqcial no-lock no-error.
     4438   
     4439       if not avail import-guia-prorrog
     4440       then do:
     4441              run grava-erro(input import-guia.num-seqcial-control,
     4442                             input "import-guia-prorrog",
     4443                             input "Registro import-guia-prorrog nao encontrado",
     4444                             input today,
     4445                             input "Registro referente a guia de Prorrogacao nao foi encontrado").
     4446              
     4447              assign lg-erro-par = yes.
     4448              return.
     4449            end.
     4450   
     4451       /* ----------------------------------------------------------------- */
     4452       if  avail tip-guia
     4453       and not tip-guia.log-29 /* Tipo de guia de prorrogacao */
     4454       then do:        
     4455              run grava-erro(input import-guia.num-seqcial-control,
     4456                             input "import-guia",
     4457                             input "Tipo de Guia nao e de prorrogacao (tip-guia.log-29). Tipo guia: " + string(tip-guia.cd-tipo-guia) +  
     4458                                   " import-guia-prorrog.num-seq-import: " + string(import-guia-prorrog.num-seq-import),
     4459                             input today,
     4460                             input "Para guias de prorrogacao, informe um tipo de guia de prorrogacao").
     4461   
     4462              assign lg-erro-par = yes.
     4463            end.
     4464   
     4465       /* ----------------------------------------------------------------- */
     4466       if import-guia.num-seqcial-princ = ?
     4467       or import-guia.num-seqcial-princ = 0
     4468       then do:
     4469              run grava-erro(input import-guia.num-seqcial-control,
     4470                             input "import-guia-prorrog",
     4471                             input "Codigo da guia principal deve ser informado. import-guia-prorrog.num-seq-import: " + string(import-guia-prorrog.num-seq-import),
     4472                             input today,
     4473                             input "O codigo da guia principal e obrigatorio para guias de prorrogacao.").
     4474              
     4475              assign lg-erro-par = yes.
     4476            end.
     4477   
     4478       /* ----------------------------------------------------------------- */
     4479       if import-guia-prorrog.des-indic-clinic = ?
     4480       or import-guia-prorrog.des-indic-clinic = ""
     4481       then do:
     4482              run grava-erro(input import-guia.num-seqcial-control,
     4483                             input "import-guia-prorrog",
     4484                             input "Campo Indicacao clinica da guia de prorrogacao nao informado.",
     4485                             input today,
     4486                             input "import-guia-prorrog.num-seq-import: " + string(import-guia-prorrog.num-seq-import)).
     4487              
     4488              assign lg-erro-par = yes.
     4489            end.
     4490   
     4491       /* ------------------------------------------------------------------------------------- */
     4492       find guiautor where guiautor.cd-unidade          = paramecp.cd-unimed
     4493                       and guiautor.aa-guia-atendimento = aa-guia-atend-ant-aux
     4494                       and guiautor.nr-guia-atendimento = nr-guia-atend-ant-aux
     4495                           no-lock no-error.
     4496   
     4497       if avail guiautor
     4498       then do:
     4499              find first procguia where procguia.cd-unidade          = guiautor.cd-unidade         
     4500                                    and procguia.aa-guia-atendimento = guiautor.aa-guia-atendimento
     4501                                    and procguia.nr-guia-atendimento = guiautor.nr-guia-atendimento
     4502                                        no-lock no-error.
     4503   
     4504              if avail procguia
     4505              then do:
     4506                     create tmp-prest-exec.
     4507                     assign tmp-prest-exec.in-tipo-guia = "PROR"
     4508                            tmp-prest-exec.val-seqcial  = import-guia-prorrog.num-seqcial-guia
     4509                            tmp-prest-exec.cd-unidade   = procguia.cd-unidade-prestador
     4510                            tmp-prest-exec.cd-prestador = procguia.cd-prestador
     4511                            tmp-prest-exec.cd-espec     = procguia.cd-esp-prest-executante
     4512                            tmp-prest-exec.cd-vinculo   = procguia.cd-tipo-vinculo.
     4513                   end.
     4514              else do:
     4515                     find first insuguia where insuguia.cd-unidade          = guiautor.cd-unidade         
     4516                                           and insuguia.aa-guia-atendimento = guiautor.aa-guia-atendimento
     4517                                           and insuguia.nr-guia-atendimento = guiautor.nr-guia-atendimento
     4518                                               no-lock no-error.
     4519   
     4520                     if avail insuguia
     4521                     then do:
     4522                            create tmp-prest-exec.
     4523                            assign tmp-prest-exec.in-tipo-guia = "PROR"
     4524                                   tmp-prest-exec.val-seqcial  = import-guia-prorrog.num-seqcial-guia
     4525                                   tmp-prest-exec.cd-unidade   = insuguia.cd-unidade-prestador
     4526                                   tmp-prest-exec.cd-prestador = insuguia.cd-prestador
     4527                                   tmp-prest-exec.cd-espec     = insuguia.cd-esp-prest-executante
     4528                                   tmp-prest-exec.cd-vinculo   = insuguia.cd-tipo-vinculo.
     4529                          end.
     4530                   end.
     4531            end.
     4532   
     4533       /* ------------------- MOVIMENTOS INTERNACAO -------------------- */
     4534       for each import-guia-movto
     4535          where import-guia-movto.ind-tip-guia = "PROR" /* Prorrogacao */
     4536            and import-guia-movto.val-seq-guia = import-guia-prorrog.num-seqcial-guia
     4537                no-lock:
     4538   
     4539           if  import-guia-movto.ind-tip-movto-guia <> "P"
     4540           and import-guia-movto.ind-tip-movto-guia <> "I"
     4541           then do:
     4542                  run grava-erro(input import-guia.num-seqcial-control,
     4543                                 input "import-guia-prorrog",
     4544                                 input "Tipo do movimento informado invalido: "     + import-guia-movto.ind-tip-movto-guia +
     4545                                       " Tp.Guia(import-guia-movto.ind-tip-guia): " + string(import-guia-movto.ind-tip-guia)     + 
     4546                                       " Nro.Seq.Guia(import-guia-movto.val-seq-guia): " + string(import-guia-movto.val-seq-guia) + 
     4547                                       " import-guia-prorrog.num-seqcial-guia: "    + string(import-guia-prorrog.num-seqcial-guia),
     4548                                 input today,
     4549                                 input "Informe um valor valido para o campo: P ou I").
     4550   
     4551                  assign lg-erro-par = yes.
     4552                end.
     4553   
     4554           run valida-dados-movimento(input-output lg-erro-par).
     4555   
     4556           run valida-glosas(input        import-guia-movto.ind-tip-guia,
     4557                             input        import-guia-movto.val-seqcia,
     4558                             input        import-guia-prorrog.num-seqcial-guia,
     4559                             input-output lg-erro-par).
     4560       end.
     4561   
     4562   end procedure.
     4563   
     4564   /* ----------------------------------------------------------------- */
     4565   procedure valida-internacao:
     4566   
     4567       def input-output parameter lg-erro-par as log init no no-undo.
     4568   
     4569       find first import-guia-intrcao where import-guia-intrcao.num-seq-import = import-guia.num-seqcial no-lock no-error.
     4570   
     4571       if not avail import-guia-intrcao
     4572       then do:
     4573              run grava-erro(input import-guia.num-seqcial-control,
     4574                             input "import-guia-intrcao",
     4575                             input "Registro import-guia-intrcao nao encontrado. ",
     4576                             input today,
     4577                             input "Registro referente a guia de Internacao nao foi encontrado").
     4578              
     4579              assign lg-erro-par = yes.
     4580              return.
     4581            end.
     4582   
     4583       /* ----------------------------------------------------------------- */
     4584       if import-guia-intrcao.dt-internacao = ?
     4585       then do:
     4586              run grava-erro(input import-guia.num-seqcial-control,
     4587                             input "import-guia-intrcao",
     4588                             input "Campo data sugerida para internacao nao foi informado.",
     4589                             input today,
     4590                             input "import-guia-intrcao.num-seq-import: " + string(import-guia-intrcao.num-seq-import)).
     4591              
     4592              assign lg-erro-par = yes.
     4593            end.
     4594   
     4595       /* ----------------------------------------------------------------- */
     4596       if  trim(import-guia-intrcao.cod-caract-atendim) <> "E" /* Eletivo */
     4597       and trim(import-guia-intrcao.cod-caract-atendim) <> "U" /* Urgencia */
     4598       then do:
     4599              run grava-erro(input import-guia.num-seqcial-control,
     4600                             input "import-guia-intrcao",
     4601                             input "Carater da Solicitacao invalido (import-guia-intrcao.cod-caract-atendim): " + import-guia-intrcao.cod-caract-atendim + 
     4602                                   " import-guia-intrcao.num-seq-import: " + string(import-guia-intrcao.num-seq-import),
     4603                             input today,
     4604                             input "Informar um dos valores: E ou U.").
     4605   
     4606              assign lg-erro-par = yes.
     4607            end.
     4608   
     4609       /* ----------------------------------------------------------- */
     4610       if  import-guia-intrcao.idi-acid <> 0
     4611       and import-guia-intrcao.idi-acid <> 1
     4612       and import-guia-intrcao.idi-acid <> 2
     4613       and import-guia-intrcao.idi-acid <> 9
     4614       then do:
     4615              run grava-erro(input import-guia.num-seqcial-control,
     4616                             input "import-guia-intrcao",
     4617                             input "Indicador de acidente invalido(import-guia-intrcao.idi-acid): " + string(import-guia-intrcao.idi-acid) + 
     4618                                   " import-guia-intrcao.num-seq-import: " + string(import-guia-intrcao.num-seq-import),
     4619                             input today,
     4620                             input "Informe um indicador conforme a tabela 36 da TISS.").
     4621   
     4622              assign lg-erro-par = yes.
     4623            end.
     4624   
     4625       /* ----------------------------------------------------------- */
     4626       if import-guia-intrcao.num-livre-1 < 1 /* tipo de atendimento Tiss*/
     4627       or import-guia-intrcao.num-livre-1 < 5
     4628       then do:
     4629              if import-guia-intrcao.des-indcao-clinic = ?
     4630              or import-guia-intrcao.des-indcao-clinic = ""
     4631              then do:
     4632                     run grava-erro(input import-guia.num-seqcial-control,
     4633                                    input "import-guia-intrcao",
     4634                                    input "Campo Indicacao clinica da guia de internacao nao informado.",
     4635                                    input today,
     4636                                    input "import-guia-intrcao.num-seq-import: " + string(import-guia-intrcao.num-seq-import)).
     4637                     
     4638                     assign lg-erro-par = yes.
     4639                   end.
     4640            end.
     4641   
     4642       /* ----------------------------------------------------------- */                                           
     4643       if import-guia-intrcao.cdn-tip-inter < 1
     4644       or import-guia-intrcao.cdn-tip-inter > 5
     4645       then do:
     4646              IF import-guia-intrcao.cdn-tip-inter <> ?
     4647              THEN char-aux1 = string(import-guia-intrcao.cdn-tip-inter).
     4648              ELSE char-aux1 = "nulo".
     4649              run grava-erro(input import-guia.num-seqcial-control,
     4650                             input "import-guia-intrcao",
     4651                             input "Campo Tipo de Internacao invalido (import-guia-intrcao.cdn-tip-inter): " + char-aux1 + 
     4652                                   " import-guia-intrcao.num-seq-import: " + string(import-guia-intrcao.num-seq-import),
     4653                             input today,
     4654                             input "Informe um tipo de internacao conforme a tabela 57 da TISS.").
     4655              
     4656              assign lg-erro-par = yes.
     4657            end.
     4658   
     4659       /* ----------------------------------------------------------- */
     4660       int(import-guia-intrcao.cod-regim-intrcao) no-error.
     4661   
     4662       if error-status:error
     4663       then do:
     4664              IF import-guia-intrcao.cod-regim-intrcao <> ?
     4665              THEN char-aux1 = import-guia-intrcao.cod-regim-intrcao.
     4666              else char-aux1 = "nulo".
     4667              run grava-erro(input import-guia.num-seqcial-control,
     4668                             input "import-guia-intrcao",
     4669                             input "Campo Regime de internacao invalido: " + char-aux1 + 
     4670                                   " import-guia-intrcao.num-seq-import: " + string(import-guia-intrcao.num-seq-import),
     4671                             input today,
     4672                             input "Informe um regime de internacao conforme a tabela 41 da TISS.").
     4673   
     4674              assign lg-erro-par = yes.
     4675            end.
     4676   
     4677       /* ----------------------------------------------------------- */                                           
     4678       if int(import-guia-intrcao.cod-regim-intrcao) < 1
     4679       or int(import-guia-intrcao.cod-regim-intrcao) > 3
     4680       then do:
     4681              IF import-guia-intrcao.cod-regim-intrcao <> ?
     4682              THEN char-aux1 = import-guia-intrcao.cod-regim-intrcao.
     4683              else char-aux1 = "nulo".
     4684              run grava-erro(input import-guia.num-seqcial-control,
     4685                             input "import-guia-intrcao",
     4686                             input "Campo Regime de internacao invalido (import-guia-intrcao.cod-regim-intrcao): " + char-aux1 + 
     4687                                   " import-guia-intrcao.num-seq-import: " + string(import-guia-intrcao.num-seq-import),
     4688                             input today,
     4689                             input "Informe um regime de internacao conforme a tabela 41 da TISS.").
     4690              
     4691              assign lg-erro-par = yes.
     4692            end.
     4693   
     4694       /* ----------------------------------------------------------- */
     4695       if  import-guia-intrcao.cod-cid-princ <> ?
     4696       and import-guia-intrcao.cod-cid-princ <> ""
     4697       and not can-find(dz-cid10 where dz-cid10.cd-cid = import-guia-intrcao.cod-cid-princ)
     4698       then do:
     4699              IF import-guia-intrcao.cod-cid-princ <> ?
     4700              THEN char-aux1 = import-guia-intrcao.cod-cid-princ.
     4701              else char-aux1 = "nulo".
     4702              run grava-erro(input import-guia.num-seqcial-control,
     4703                             input "import-guia-intrcao",
     4704                             input "Cid principal nao cadastrado (import-guia-intrcao.cod-cid-princ): " + char-aux1 + 
     4705                                   " import-guia-intrcao.num-seq-import: " + string(import-guia-intrcao.num-seq-import),
     4706                             input today,
     4707                             input "Informe um CID cadastrado no Gestao de Planos").
     4708              
     4709              assign lg-erro-par = yes.
     4710            end.
     4711   
     4712       /* ----------------------------------------------------------- */
     4713       if  import-guia-intrcao.cod-cid-2 <> ?
     4714       and import-guia-intrcao.cod-cid-2 <> ""
     4715       and not can-find(dz-cid10 where dz-cid10.cd-cid = import-guia-intrcao.cod-cid-2)
     4716       then do:
     4717              IF import-guia-intrcao.cod-cid-2 <> ?
     4718              THEN char-aux1 = import-guia-intrcao.cod-cid-2.
     4719              ELSE char-aux1 = "nuloi".
     4720   
     4721              run grava-erro(input import-guia.num-seqcial-control,
     4722                             input "import-guia-intrcao",
     4723                             input "Cid nao cadastrado (import-guia-intrcao.cod-cid-2): " + char-aux1 +
     4724                                   " import-guia-intrcao.num-seq-import: " + string(import-guia-intrcao.num-seq-import),
     4725                             input today,
     4726                             input "Informe um CID cadastrado no Gestao de Planos").
     4727   
     4728              assign lg-erro-par = yes.
     4729            end.
     4730   
     4731       /* ----------------------------------------------------------- */
     4732       if  import-guia-intrcao.cod-cid-3 <> ?
     4733       and import-guia-intrcao.cod-cid-3 <> ""
     4734       and not can-find(dz-cid10 where dz-cid10.cd-cid = import-guia-intrcao.cod-cid-3)
     4735       then do:
     4736              IF import-guia-intrcao.cod-cid-3 <> ?
     4737              THEN char-aux1 = import-guia-intrcao.cod-cid-3.
     4738              ELSE char-aux1 = "nulo".
     4739              run grava-erro(input import-guia.num-seqcial-control,
     4740                             input "import-guia-intrcao",
     4741                             input "Cid nao cadastrado (import-guia-intrcao.cod-cid-3): " + char-aux1 +
     4742                                   " import-guia-intrcao.num-seq-import: " + string(import-guia-intrcao.num-seq-import),
     4743                             input today,
     4744                             input "Informe um CID cadastrado no Gestao de Planos").
     4745   
     4746              assign lg-erro-par = yes.
     4747            end.
     4748   
     4749       /* ----------------------------------------------------------- */
     4750       if  import-guia-intrcao.cod-cid-4 <> ?
     4751       and import-guia-intrcao.cod-cid-4 <> ""
     4752       and not can-find(dz-cid10 where dz-cid10.cd-cid = import-guia-intrcao.cod-cid-4)
     4753       then do:
     4754              IF import-guia-intrcao.cod-cid-4 <> ?
     4755              THEN char-aux1 = import-guia-intrcao.cod-cid-4.
     4756              ELSE char-aux1 = "nulo".
     4757              run grava-erro(input import-guia.num-seqcial-control,
     4758                             input "import-guia-intrcao",
     4759                             input "Cid nao cadastrado (import-guia-intrcao.cod-cid-4): " + char-aux1 +
     4760                                   " import-guia-intrcao.num-seq-import: " + string(import-guia-intrcao.num-seq-import),
     4761                             input today,
     4762                             input "Informe um CID cadastrado no Gestao de Planos").
     4763   
     4764              assign lg-erro-par = yes.
     4765            end.
     4766   
     4767       /* ------------------------------------------------------------------------------------- */
     4768       IF NOT CAN-FIND(FIRST preserv
     4769                       WHERE preserv.cd-unidade   = import-guia-intrcao.cd-unidade-exec
     4770                         AND preserv.cd-prestador = import-guia-intrcao.cd-prestador-exec)
     4771       THEN DO:
     4772              run grava-erro(input import-guia.num-seqcial-control,
     4773                             input "import-guia-intrcao",
     4774                             input "(2)Prestador executante nao encontrado.",
     4775                             input today,
     4776                             input " Unidade(import-guia-intrcao.cd-unidade-exec): " + string(import-guia-intrcao.cd-unidade-exec) + 
     4777                                   " Prestador(import-guia-intrcao.cd-prestador-exec): " + string(import-guia-intrcao.cd-prestador-exec) + 
     4778                                   " import-guia-intrcao.num-seq-import: " + string(import-guia-intrcao.num-seq-import)).
     4779              assign lg-erro-par = yes.
     4780            END.
     4781       ELSE DO:
     4782               run busca-vinculo-prestador(input  import-guia-intrcao.cd-unidade-exec,
     4783                                           input  import-guia-intrcao.cd-prestador-exec,
     4784                                           input  import-guia-intrcao.cd-especialid-exec,
     4785                                           input  import-guia.dat-solicit,
     4786                                           output cd-vinculo-aux,
     4787                                           output lg-erro-vinculo-aux). 
     4788   
     4789               if lg-erro-vinculo-aux
     4790               then do:
     4791                      run grava-erro(input import-guia.num-seqcial-control,
     4792                                     input "import-guia-intrcao",
     4793                                     input "Vinculo nao encontrado para o prestador executante e especialidade informados.",
     4794                                     input today,
     4795                                     input " Unid: " + string(import-guia-intrcao.cd-unidade-exec) + 
     4796                                           " Prest: " + string(import-guia-intrcao.cd-prestador-exec) + 
     4797                                           " Espec: " + string(import-guia-intrcao.cd-especialid-exec) + 
     4798                                           " import-guia-intrcao.num-seq-import: " + string(import-guia-intrcao.num-seq-import)).
     4799   
     4800                      assign lg-erro-par = yes.
     4801                    end.
     4802               else do:
     4803                      create tmp-prest-exec.
     4804                      assign tmp-prest-exec.in-tipo-guia = "INTE"
     4805                             tmp-prest-exec.val-seqcial  = import-guia-intrcao.num-seqcial-guia
     4806                             tmp-prest-exec.cd-unidade   = import-guia-intrcao.cd-unidade-exec
     4807                             tmp-prest-exec.cd-prestador = import-guia-intrcao.cd-prestador-exec
     4808                             tmp-prest-exec.cd-espec     = import-guia-intrcao.cd-especialid-exec
     4809                             tmp-prest-exec.cd-vinculo   = cd-vinculo-aux.
     4810                    end.
     4811            END.
     4812            
     4813       /* ------------------- MOVIMENTOS INTERNACAO -------------------- */
     4814       for each import-guia-movto
     4815          where import-guia-movto.ind-tip-guia = "INTE" /* Consulta */
     4816            and import-guia-movto.val-seq-guia = import-guia-intrcao.num-seqcial-guia
     4817                no-lock:
     4818   
     4819           if  import-guia-movto.ind-tip-movto-guia <> "P"
     4820           and import-guia-movto.ind-tip-movto-guia <> "I"
     4821           then do:
     4822                  run grava-erro(input import-guia.num-seqcial-control,
     4823                                 input "import-guia-con",
     4824                                 input "Tipo do movimento informado invalido: " + import-guia-movto.ind-tip-movto-guia +
     4825                                       " Tp.Guia(import-guia-movto.ind-tip-guia): " + string(import-guia-movto.ind-tip-guia) + 
     4826                                       " Nro.Seq.Guia(import-guia-movto.val-seq-guia): " + string(import-guia-movto.val-seq-guia) + 
     4827                                       " import-guia-intrcao.num-seq-import: " + string(import-guia-intrcao.num-seq-import) +
     4828                                       " import-guia-intrcao.num-seqcial-guia: " + string(import-guia-intrcao.num-seqcial-guia),
     4829                                 input today,
     4830                                 input "Informe um valor valido para o campo: P ou I").
     4831   
     4832                  assign lg-erro-par = yes.
     4833                end.
     4834   
     4835           run valida-dados-movimento(input-output lg-erro-par).
     4836   
     4837           run valida-glosas(input        import-guia-movto.ind-tip-guia,
     4838                             input        import-guia-movto.val-seqcia,
     4839                             input        import-guia-intrcao.num-seqcial-guia,
     4840                             input-output lg-erro-par).
     4841       end.
     4842   
     4843   end procedure.
     4844   
     4845   /* ----------------------------------------------------------------- */
     4846   procedure valida-sp-sadt:
     4847   
     4848       def input-output parameter lg-erro-par as log init no no-undo.
     4849   
     4850       find first import-guia-sadt where import-guia-sadt.val-seq-import = import-guia.num-seqcial no-lock no-error.
     4851   
     4852       if not avail import-guia-sadt
     4853       then do:
     4854              run grava-erro(input import-guia.num-seqcial-control,
     4855                             input "import-guia-sadt",
     4856                             input "Registro import-guia-sadt nao encontrado",
     4857                             input today,
     4858                             input "Registro referente a guia de SP/SADT nao foi encontrado").
     4859              
     4860              assign lg-erro-par = yes.
     4861              return.
     4862            end.
     4863   
     4864       /* ----------------------------------------------------------------- */
     4865       if  trim(import-guia-sadt.ind-carac-solicit) <> "E" /* Eletivo */
     4866       and trim(import-guia-sadt.ind-carac-solicit) <> "U" /* Urgencia */
     4867       then do:
     4868              run grava-erro(input import-guia.num-seqcial-control,
     4869                             input "import-guia-sadt",
     4870                             input "Carater da Solicitacao invalido (import-guia-sadt.ind-carac-solicit): " + import-guia-sadt.ind-carac-solicit + 
     4871                                   " import-guia-sadt.val-seq-import: " + string(import-guia-sadt.val-seq-import),
     4872                             input today,
     4873                             input "Informar um dos valores: E ou U.").
     4874              
     4875              assign lg-erro-par = yes.
     4876            end.
     4877       
     4878       /* ----------------------------------------------------------------- */
     4879       int(import-guia-sadt.ind-tip-atendim) no-error.
     4880   
     4881       if error-status:error
     4882       then do:
     4883              run grava-erro(input import-guia.num-seqcial-control,
     4884                             input "import-guia-sadt",
     4885                             input "Tipo de Atendimento invalido (import-guia-sadt.ind-tip-atendim): " + import-guia-sadt.ind-tip-atendim + 
     4886                                   " import-guia-sadt.val-seq-import: " + string(import-guia-sadt.val-seq-import),
     4887                             input today,
     4888                             input "Informar um tipo de atendimento conforme a tabela 50 da TISS").
     4889              
     4890              assign lg-erro-par = yes.
     4891            end.
     4892   
     4893       if (int(import-guia-sadt.ind-tip-atendim) < 1
     4894       or int(import-guia-sadt.ind-tip-atendim) > 21)
     4895       then do:
     4896              run grava-erro(input import-guia.num-seqcial-control,
     4897                             input "import-guia-sadt",
     4898                             input "Tipo de Atendimento invalido (import-guia-sadt.ind-tip-atendim): " + import-guia-sadt.ind-tip-atendim + 
     4899                                   " import-guia-sadt.val-seq-import: " + string(import-guia-sadt.val-seq-import),
     4900                             input today,
     4901                             input "Informar um tipo de atendimento conforme a tabela 50 da TISS").
     4902              
     4903              assign lg-erro-par = yes.
     4904            end.
     4905   
     4906       /* ----------------------------------------------------------- */
     4907       int(import-guia-sadt.ind-tip-acid) no-error.
     4908   
     4909       if error-status:error
     4910       then do:
     4911              run grava-erro(input import-guia.num-seqcial-control,
     4912                             input "import-guia-sadt",
     4913                             input "Indicador de acidente invalido (import-guia-sadt.ind-tip-acid): " + import-guia-sadt.ind-tip-acid + 
     4914                                   " import-guia-sadt.val-seq-import: " + string(import-guia-sadt.val-seq-import),
     4915                             input today,
     4916                             input "Informe um indicador conforme a tabela 36 da TISS.").
     4917   
     4918              assign lg-erro-par = yes.
     4919            end.
     4920   
     4921       /* ----------------------------------------------------------- */
     4922       if  int(import-guia-sadt.ind-tip-acid) <> 0
     4923       and int(import-guia-sadt.ind-tip-acid) <> 1
     4924       and int(import-guia-sadt.ind-tip-acid) <> 2
     4925       and int(import-guia-sadt.ind-tip-acid) <> 9
     4926       then do:
     4927              run grava-erro(input import-guia.num-seqcial-control,
     4928                             input "import-guia-sadt",
     4929                             input "Indicador de acidente invalido (import-guia-sadt.ind-tip-acid): " + import-guia-sadt.ind-tip-acid + 
     4930                                   " import-guia-sadt.val-seq-import: " + string(import-guia-sadt.val-seq-import),
     4931                             input today,
     4932                             input "Informe um indicador conforme a tabela 36 da TISS.").
     4933   
     4934              assign lg-erro-par = yes.
     4935            end.
     4936   
     4937       /* ----------------------------------------------------------- */
     4938       if int(import-guia-sadt.ind-tip-atendim) = 4 /* Consulta */
     4939       then do:
     4940              int(import-guia-sadt.ind-tip-con) no-error.
     4941              
     4942              if error-status:error
     4943              then do:
     4944                     run grava-erro(input import-guia.num-seqcial-control,
     4945                                    input "import-guia-sadt",
     4946                                    input "Tipo de Consulta invalido (import-guia-sadt.ind-tip-atendim): " + import-guia-sadt.ind-tip-con + 
     4947                                          " import-guia-sadt.val-seq-import: " + string(import-guia-sadt.val-seq-import),
     4948                                    input today,
     4949                                    input "Tipo de Atendimento e de consulta. Informe um tipo de consulta conforme a tabela 52 da TISS.").
     4950              
     4951                     assign lg-erro-par = yes.
     4952                   end.
     4953              
     4954              /* ----------------------------------------------------------- */
     4955              if  int(import-guia-sadt.ind-tip-con) <> 0
     4956              and int(import-guia-sadt.ind-tip-con) <> 1
     4957              and int(import-guia-sadt.ind-tip-con) <> 2
     4958              and int(import-guia-sadt.ind-tip-con) <> 3
     4959              and int(import-guia-sadt.ind-tip-con) <> 4
     4960              then do:
     4961                     run grava-erro(input import-guia.num-seqcial-control,
     4962                                    input "import-guia-sadt",
     4963                                    input "Tipo de Consulta invalido (import-guia-sadt.ind-tip-con): " + import-guia-sadt.ind-tip-con + 
     4964                                          " import-guia-sadt.val-seq-import: " + string(import-guia-sadt.val-seq-import),
     4965                                    input today,
     4966                                    input "Tipo de Atendimento e de consulta. Informe um tipo de consulta conforme a tabela 52 da TISS.").
     4967              
     4968                     assign lg-erro-par = yes.
     4969                   end.
     4970            end.
     4971   
     4972       /* ------------------------------------------------------------------------------------- */
     4973       IF NOT CAN-FIND(FIRST preserv
     4974                       WHERE preserv.cd-unidade   = import-guia-sadt.cd-unidade-exec
     4975                         AND preserv.cd-prestador = import-guia-sadt.cd-prest-exec)
     4976       THEN DO:
     4977              run grava-erro(input import-guia.num-seqcial-control,
     4978                             input "import-guia-sadt",
     4979                             input "(3)Prestador executante nao encontrado.",
     4980                             input today,
     4981                             input " Unidade(import-guia-sadt.cd-unidade-exec): " + string(import-guia-sadt.cd-unidade-exec) + 
     4982                                   " Prestador(import-guia-sadt.cd-prest-exec): " + string(import-guia-sadt.cd-prest-exec) + 
     4983                                   " import-guia-sadt.val-seq-import: " + string(import-guia-sadt.val-seq-import)).
     4984              assign lg-erro-par = yes.
     4985            END.
     4986       ELSE DO:
     4987                   run busca-vinculo-prestador(input  import-guia-sadt.cd-unidade-exec,
     4988                                               input  import-guia-sadt.cd-prest-exec,
     4989                                               input  import-guia-sadt.cd-especialid-exec,
     4990                                               input  import-guia.dat-solicit, 
     4991                                               output cd-vinculo-aux,
     4992                                               output lg-erro-vinculo-aux). 
     4993   
     4994                   if lg-erro-vinculo-aux
     4995                   then do:
     4996                          run grava-erro(input import-guia.num-seqcial-control,
     4997                                         input "import-guia-sadt",
     4998                                         input "Vinculo nao encontrado para o prestador executante e especialidade informados.",
     4999                                         input today,
     5000                                         input " Unid: "  + string(import-guia-sadt.cd-unidade-exec) + 
     5001                                               " Prest: " + string(import-guia-sadt.cd-prest-exec) + 
     5002                                               " Espec: " + string(import-guia-sadt.cd-especialid-exec) + 
     5003                                               " import-guia-sadt.val-seq-import: " + string(import-guia-sadt.val-seq-import)).
     5004   
     5005                          assign lg-erro-par = yes.
     5006                        end.
     5007                   else do:
     5008                          create tmp-prest-exec.
     5009                          assign tmp-prest-exec.in-tipo-guia = "SADT"
     5010                                 tmp-prest-exec.val-seqcial  = import-guia-sadt.val-seqcial
     5011                                 tmp-prest-exec.cd-unidade   = import-guia-sadt.cd-unidade-exec
     5012                                 tmp-prest-exec.cd-prestador = import-guia-sadt.cd-prest-exec
     5013                                 tmp-prest-exec.cd-espec     = import-guia-sadt.cd-especialid-exec
     5014                                 tmp-prest-exec.cd-vinculo   = cd-vinculo-aux.
     5015                        end.
     5016            END.
     5017            
     5018       /* ------------------- MOVIMENTOS SADT -------------------- */
     5019       for each import-guia-movto
     5020          where import-guia-movto.ind-tip-guia = "SADT" /* SADT */
     5021            and import-guia-movto.val-seq-guia = import-guia-sadt.val-seqcial
     5022                no-lock:
     5023   
     5024           if  import-guia-movto.ind-tip-movto-guia <> "P"
     5025           and import-guia-movto.ind-tip-movto-guia <> "I"
     5026           then do:
     5027                  run grava-erro(input import-guia.num-seqcial-control,
     5028                                 input "import-guia-sadt",
     5029                                 input "Tipo do movimento informado invalido (import-guia-movto.ind-tip-movto-guia): " + import-guia-movto.ind-tip-movto-guia + 
     5030                                       " Tp.Guia(import-guia-movto.ind-tip-guia): "      + string(import-guia-movto.ind-tip-guia) + 
     5031                                       " Nro.Seq.Guia(import-guia-movto.val-seq-guia): " + string(import-guia-movto.val-seq-guia) + 
     5032                                       " import-guia-sadt.val-seq-import: "              + string(import-guia-sadt.val-seq-import) +         
     5033                                       " import-guia-sadt.val-seqcial: "                 + string(import-guia-sadt.val-seqcial),
     5034                                 input today,
     5035                                 input "Informe um valor valido para o campo: P ou I").
     5036   
     5037                  assign lg-erro-par = yes.
     5038                end.
     5039   
     5040           if import-guia-movto.ind-tip-movto-guia = "P"
     5041           and (   import-guia-sadt.des-indic-clinic = ?
     5042                or import-guia-sadt.des-indic-clinic = ""
     5043               )
     5044           then do:
     5045                  assign cd-esp-amb-aux        = int(substr(string(int(import-guia-movto.cod-movto-guia),"99999999"),1,2))
     5046                         cd-grupo-proc-amb-aux = int(substr(string(int(import-guia-movto.cod-movto-guia),"99999999"),3,2))
     5047                         cd-procedimento-aux   = int(substr(string(int(import-guia-movto.cod-movto-guia),"99999999"),5,3))
     5048                         dv-procedimento-aux   = int(substr(string(int(import-guia-movto.cod-movto-guia),"99999999"),8,1)).
     5049                  
     5050                  find ambproce where ambproce.cd-esp-amb        = cd-esp-amb-aux
     5051                                  and ambproce.cd-grupo-proc-amb = cd-grupo-proc-amb-aux
     5052                                  and ambproce.cd-procedimento   = cd-procedimento-aux
     5053                                  and ambproce.dv-procedimento   = dv-procedimento-aux
     5054                                      no-lock no-error.
     5055                  
     5056                  if avail ambproce                                                               
     5057                  then do:                                                                        
     5058                         find tiss-tip-atendim where tiss-tip-atendim.cdn-tip-atendim = ambproce.num-livre-6  /* Tipo de Atendimento do procedimento */
     5059                                                     no-lock no-error.                                                  
     5060                  
     5061                         if avail tiss-tip-atendim                                                
     5062                         and tiss-tip-atendim.log-livre-2 /* Obriga Indicacao Clinica */
     5063                         then do:                                                                                                                       
     5064                                run grava-erro(input import-guia.num-seqcial-control,
     5065                                               input "import-guia-sadt",
     5066                                               input "Indicacao Clinica deve ser informada (import-guia-sadt.des-indic-clinic)." + 
     5067                                                     " Tp.Guia(import-guia-movto.ind-tip-guia): "      + string(import-guia-movto.ind-tip-guia) + 
     5068                                                     " Nro.Seq.Guia(import-guia-movto.val-seq-guia): " + string(import-guia-movto.val-seq-guia) + 
     5069                                                     " import-guia-sadt.val-seq-import: "              + string(import-guia-sadt.val-seq-import) + 
     5070                                                     " import-guia-sadt.val-seqcial: "                 + string(import-guia-sadt.val-seqcial),
     5071                                               input today,
     5072                                               input "Tipo de Atendimento informado no cadastro de procedimentos obriga indicacao clinica. Campo deve ser informado").
     5073                                
     5074                                assign lg-erro-par = yes.
     5075                              end.                                                                
     5076                       end.   
     5077                end.
     5078   
     5079           run valida-dados-movimento(input-output lg-erro-par).
     5080   
     5081           run valida-glosas(input        import-guia-movto.ind-tip-guia,
     5082                             input        import-guia-movto.val-seqcia,
     5083                             input        import-guia-sadt.val-seqcial,
     5084                             input-output lg-erro-par).
     5085       end.
     5086   
     5087   
     5088   end procedure.
     5089   
     5090   /* ----------------------------------------------------------------- */
     5091   procedure valida-consulta:
     5092   
     5093       def input-output parameter lg-erro-par as log init no no-undo.
     5094   
     5095       find first import-guia-con where import-guia-con.num-seq-import = import-guia.num-seqcial no-lock no-error.
     5096   
     5097       if not avail import-guia-con
     5098       then do:
     5099              run grava-erro(input import-guia.num-seqcial-control,
     5100                             input "import-guia-con",
     5101                             input "Registro import-guia-con nao encontrado",
     5102                             input today,
     5103                             input "Registro referente a guia de consulta nao foi encontrado").
     5104              
     5105              assign lg-erro-par = yes.
     5106              return.
     5107            end.
     5108   
     5109       /* ----------------------------------------------------------- */
     5110       if  import-guia-con.in-acidente <> 0
     5111       and import-guia-con.in-acidente <> 1
     5112       and import-guia-con.in-acidente <> 2
     5113       and import-guia-con.in-acidente <> 9
     5114       then do:
     5115              run grava-erro(input import-guia.num-seqcial-control,
     5116                             input "import-guia-con",
     5117                             input "Indicador de acidente invalido (import-guia-con.in-acidente): " + string(import-guia-con.in-acidente) + 
     5118                                   " import-guia-con.num-seq-import: " + string(import-guia-con.num-seq-import),
     5119                             input today,
     5120                             input "Informe um indicador conforme a tabela 36 da TISS.").
     5121              
     5122              assign lg-erro-par = yes.
     5123            end.
     5124   
     5125       /* ----------------------------------------------------------- */
     5126       int(import-guia-con.ind-tip-con) no-error.
     5127   
     5128       if error-status:error
     5129       then do:
     5130              run grava-erro(input import-guia.num-seqcial-control,
     5131                             input "import-guia-con",
     5132                             input "Tipo de Consulta invalido (import-guia-con.ind-tip-con): " + import-guia-con.ind-tip-con + 
     5133                                   " import-guia-con.num-seq-import: " + string(import-guia-con.num-seq-import),
     5134                             input today,
     5135                             input "Informe um tipo de consulta conforme a tabela 52 da TISS.").
     5136              
     5137              assign lg-erro-par = yes.
     5138            end.
     5139   
     5140       /* ----------------------------------------------------------- */
     5141       if  int(import-guia-con.ind-tip-con) <> 1
     5142       and int(import-guia-con.ind-tip-con) <> 2
     5143       and int(import-guia-con.ind-tip-con) <> 3
     5144       and int(import-guia-con.ind-tip-con) <> 4
     5145       then do:
     5146              run grava-erro(input import-guia.num-seqcial-control,
     5147                             input "import-guia-con",
     5148                             input "Tipo de Consulta invalido (import-guia-con.ind-tip-con): " + import-guia-con.ind-tip-con + 
     5149                                   " import-guia-con.num-seq-import: " + string(import-guia-con.num-seq-import),
     5150                             input today,
     5151                             input "Informe um tipo de consulta conforme a tabela 52 da TISS.").
     5152              
     5153              assign lg-erro-par = yes.
     5154            end.
     5155   
     5156       /* ----------------------------------------------------------- */
     5157       if import-guia-con.dat-atendim = ?
     5158       then do:
     5159              run grava-erro(input import-guia.num-seqcial-control,
     5160                             input "import-guia-con",
     5161                             input "Data do Atendimento nao informada (import-guia-con.dat-atendim). " + 
     5162                                   " import-guia-con.num-seq-import: " + string(import-guia-con.num-seq-import),
     5163                             input today,
     5164                             input "Informe o campo Data do Atendimento").
     5165              
     5166              assign lg-erro-par = yes.
     5167            end.
     5168   
     5169       /* -------------- PRESTADOR EXECUTANTE ------------------- */
     5170       if not can-find(preserv where preserv.cd-unidade   = import-guia-con.cd-unidade-exec  
     5171                                 and preserv.cd-prestador = import-guia-con.cd-prestador-exec)
     5172       then do:
     5173              run grava-erro(input import-guia.num-seqcial-control,
     5174                             input "import-guia-con",
     5175                             input "Prestador executante nao cadastrado." + 
     5176                                   " Unid: "  + string(import-guia-con.cd-unidade-exec) + 
     5177                                   " Prest: " + string(import-guia-con.cd-prestador-exec) + 
     5178                                   " import-guia-con.cd-prestador-exec: " + string(import-guia-con.cd-prestador-exec) + 
     5179                                   " import-guia-con.num-seq-import: "    + string(import-guia-con.num-seq-import),
     5180                             input today,
     5181                             input "Informe um prestador cadastrado no GPS").
     5182              
     5183              assign lg-erro-par = yes.
     5184            end.
     5185   
     5186       if import-guia-con.cd-especialid-exec = 0
     5187       or import-guia-con.cd-especialid-exec = ?
     5188       then do:
     5189              run grava-erro(input import-guia.num-seqcial-control,
     5190                             input "import-guia-con",
     5191                             input "Especialidade do prestador executante deve ser informada (import-guia-con.cd-especialid-exec). " + 
     5192                                   " Unid: "  + string(import-guia-con.cd-unidade-exec) + 
     5193                                   " Prest: " + string(import-guia-con.cd-prestador-exec) + 
     5194                                   " import-guia-con.num-seq-import: "    + string(import-guia-con.num-seq-import),
     5195                             input today,
     5196                             input "Informe uma especialidade medica para o prestador executante.").
     5197              
     5198              assign lg-erro-par = yes.
     5199            end.
     5200   
     5201       /* ------------------------------------------------------------------------------------- */
     5202       IF NOT CAN-FIND(FIRST preserv
     5203                       WHERE preserv.cd-unidade   = import-guia-con.cd-unidade-exec
     5204                         AND preserv.cd-prestador = import-guia-con.cd-prestador-exec)
     5205       THEN DO:
     5206              run grava-erro(input import-guia.num-seqcial-control,
     5207                             input "import-guia-con",
     5208                             input "(4)Prestador executante nao encontrado.",
     5209                             input today,
     5210                             input " Unidade(import-guia-con.cd-unidade-exec): " + string(import-guia-con.cd-unidade-exec) + 
     5211                                   " Prestador(import-guia-con.cd-prestador-exec): " + string(import-guia-con.cd-prestador-exec) + 
     5212                                   " import-guia-con.num-seq-import: " + string(import-guia-con.num-seq-import)).
     5213              assign lg-erro-par = yes.
     5214            END.
     5215       ELSE DO:
     5216               run busca-vinculo-prestador(input  import-guia-con.cd-unidade-exec,
     5217                                           input  import-guia-con.cd-prestador-exec,
     5218                                           input  import-guia-con.cd-especialid-exec,
     5219                                           input  import-guia.dat-solicit,
     5220                                           output cd-vinculo-aux,
     5221                                           output lg-erro-vinculo-aux). 
     5222   
     5223               if lg-erro-vinculo-aux
     5224               then do:
     5225                      run grava-erro(input import-guia.num-seqcial-control,
     5226                                     input "import-guia-con",
     5227                                     input "Vinculo nao encontrado para o prestador executante e especialidade informados.",
     5228                                     input today,
     5229                                     input " Unid: "  + string(import-guia-con.cd-unidade-exec) + 
     5230                                           " Prest: " + string(import-guia-con.cd-prestador-exec) +  
     5231                                           " Espec: " + string(import-guia-con.cd-especialid-exec) + 
     5232                                           " import-guia-con.num-seq-import: " + string(import-guia-con.num-seq-import)).
     5233   
     5234                      assign lg-erro-par = yes.
     5235                    end.
     5236               else do:
     5237                      create tmp-prest-exec.
     5238                      assign tmp-prest-exec.in-tipo-guia = "CONS"
     5239                             tmp-prest-exec.val-seqcial  = import-guia-con.num-seqcial-guia
     5240                             tmp-prest-exec.cd-unidade   = import-guia-con.cd-unidade-exec
     5241                             tmp-prest-exec.cd-prestador = import-guia-con.cd-prestador-exec
     5242                             tmp-prest-exec.cd-espec     = import-guia-con.cd-especialid-exec
     5243                             tmp-prest-exec.cd-vinculo   = cd-vinculo-aux.
     5244                    end.
     5245            END.
     5246            
     5247       /* ------------------- MOVIMENTOS CONSULTA -------------------- */
     5248       for each import-guia-movto
     5249          where import-guia-movto.ind-tip-guia = "CONS" /* Consulta */
     5250            and import-guia-movto.val-seq-guia = import-guia-con.num-seqcial-guia
     5251                no-lock:
     5252   
     5253           if  import-guia-movto.ind-tip-movto-guia <> "P"
     5254           and import-guia-movto.ind-tip-movto-guia <> "I"
     5255           then do:
     5256                  run grava-erro(input import-guia.num-seqcial-control,
     5257                                 input "import-guia-con",
     5258                                 input "Tipo do movimento informado invalido (import-guia-movto.ind-tip-movto-guia): " + import-guia-movto.ind-tip-movto-guia + 
     5259                                       " Tp.Guia(import-guia-movto.ind-tip-guia): " + string(import-guia-movto.ind-tip-guia) + 
     5260                                       " Nro.Seq.Guia(import-guia-movto.val-seq-guia): " + string(import-guia-movto.val-seq-guia) + 
     5261                                       " import-guia-con.num-seq-import: " + string(import-guia-con.num-seq-import) +  
     5262                                       " import-guia-con.num-seqcial-guia: " + string(import-guia-con.num-seqcial-guia),
     5263                                 input today,
     5264                                 input "Informe um valor valido para o campo: P ou I").
     5265                  
     5266                  assign lg-erro-par = yes.
     5267                end.
     5268   
     5269           run valida-dados-movimento(input-output lg-erro-par).
     5270   
     5271           run valida-glosas(input        import-guia-movto.ind-tip-guia,
     5272                             input        import-guia-movto.val-seqcia,
     5273                             input        import-guia-con.num-seqcial-guia,
     5274                             input-output lg-erro-par).
     5275       end.
     5276       
     5277   end procedure.
     5278   
     5279   /* ----------------------------------------------------------------- */
     5280   procedure consiste-dados-gerais:
     5281   
     5282       def output parameter lg-erro-par as log init no no-undo.
     5283   
     5284       IF import-guia.aa-guia-atendimento = ?
     5285       THEN DO:
     5286              run grava-erro(input import-guia.num-seqcial-control,
     5287                             input "import-guia",
     5288                             input "Ano da guia invalido (nulo)",
     5289                             input today,
     5290                             input "Verifique o extrator").
     5291              assign lg-erro-par = yes.
     5292            END.
     5293       IF import-guia.nr-guia-atendimento = ?
     5294       THEN DO:
     5295              run grava-erro(input import-guia.num-seqcial-control,
     5296                             input "import-guia",
     5297                             input "Numero da guia invalido (nulo)",
     5298                             input today,
     5299                             input "Verifique o extrator").
     5300              assign lg-erro-par = yes.
     5301            END.
     5302   
     5303       IF CAN-FIND(first guiautor 
     5304                   where guiautor.cd-unidade          = paramecp.cd-unimed
     5305                     and guiautor.aa-guia-atendimento = import-guia.aa-guia-atendimento
     5306                     AND guiautor.nr-guia-atendimento = import-guia.nr-guia-atendimento)
     5307       THEN DO:
     5308              run grava-erro(input import-guia.num-seqcial-control,
     5309                             input "import-guia",
     5310                             input "Numeracao da guia ja utilizada. Ano: " + STRING(import-guia.aa-guia-atendimento)
     5311                                 + "Guia: " + STRING(import-guia.nr-guia-atendimento),
     5312                             input today,
     5313                             input "Verifique a geracao da numeracao no extrator").
     5314              
     5315              assign lg-erro-par = yes.
     5316            END.
     5317   
     5318       /* ----------------------------------------------------------- */
     5319       if  trim(import-guia.ind-tip-guia) <> "S" /* SADT */
     5320       and trim(import-guia.ind-tip-guia) <> "I" /* Internacao */
     5321       and trim(import-guia.ind-tip-guia) <> "P" /* Prorrogacao */
     5322       and trim(import-guia.ind-tip-guia) <> "C" /* Consulta */
     5323       and trim(import-guia.ind-tip-guia) <> "O" /* Odontologia */
     5324       then do:
     5325              run grava-erro(input import-guia.num-seqcial-control,
     5326                             input "import-guia",
     5327                             input "Tipo da guia informado invalido (import-guia.ind-tip-guia): " + import-guia.ind-tip-guia,
     5328                             input today,
     5329                             input "Informe um valor valido para o campo: S, I, P, C, O").
     5330              
     5331              assign lg-erro-par = yes.
     5332            end.
     5333   
     5334       /* ----------------------------------------------------------- */
     5335       if  import-guia.ind-sit-guia <> "1"  /* Digitada */
     5336       and import-guia.ind-sit-guia <> "2"  /* Autorizada */
     5337       and import-guia.ind-sit-guia <> "3"  /* Cancelada */
     5338       and import-guia.ind-sit-guia <> "4"  /* Processada pelo contas */
     5339       and import-guia.ind-sit-guia <> "5"  /* Fechada */
     5340       and import-guia.ind-sit-guia <> "6"  /* Orcamento */
     5341       and import-guia.ind-sit-guia <> "7"  /* Faturada */
     5342       and import-guia.ind-sit-guia <> "8"  /* Negada */
     5343       and import-guia.ind-sit-guia <> "9"  /* Pendente Auditoria */
     5344       and import-guia.ind-sit-guia <> "10" /* Pendente Liberacao */
     5345       and import-guia.ind-sit-guia <> "11" /* Pendente Laudo Medico */
     5346       and import-guia.ind-sit-guia <> "12" /* Pendente Justificativa Medica */
     5347       and import-guia.ind-sit-guia <> "13" /* Pendente Pericia */
     5348       and import-guia.ind-sit-guia <> "19" /* Em auditoria */
     5349       and import-guia.ind-sit-guia <> "20" /* Em atendimento */
     5350       and import-guia.ind-sit-guia <> "23" /* Em pericia */
     5351       then do:
     5352              run grava-erro(input import-guia.num-seqcial-control,
     5353                             input "import-guia",
     5354                             input "Situacao da guia informada invalido (import-guia.ind-sit-guia): " + string(import-guia.ind-sit-guia),
     5355                             input today,
     5356                             input "Informe um valor valido para o campo.").
     5357              
     5358              assign lg-erro-par = yes.
     5359            end.
     5360   
     5361       /* ----------------------------------------------------------- */
     5362       if import-guia.cod-guia-operdra = ?
     5363       or import-guia.cod-guia-operdra = ""
     5364       then do:
     5365              run grava-erro(input import-guia.num-seqcial-control,
     5366                             input "import-guia",
     5367                             input "Numero da guia no Unicoo nao informado (import-guia.cod-guia-operdra).",
     5368                             input today,
     5369                             input "Informe o campo referente ao numero da guia no Unicoo: import-guia.cod-guia-operdra").
     5370   
     5371              assign lg-erro-par = yes.
     5372            end.
     5373   
     5374       /* ----------------------------------------------------------- */
     5375       find tranrevi where tranrevi.cd-transacao = import-guia.cd-transacao no-lock no-error.
     5376   
     5377       if not avail tranrevi
     5378       then do:
     5379              run grava-erro(input import-guia.num-seqcial-control,
     5380                             input "import-guia",
     5381                             input "Transacao (import-guia.cd-transacao) " 
     5382                                 + string(import-guia.cd-transacao) 
     5383                                 + " nao cadastrada.",
     5384                             input today,
     5385                             input "Informe um numero de transacao cadastrado no Gestao de Planos").
     5386              
     5387              assign lg-erro-par = yes.
     5388            end.
     5389   
     5390      /* ------------------------- PRESTADOR SOLICITANTE ---------------------------------------- */
     5391      run consiste-prestador-solicitante(input-output lg-erro-par).
     5392   
     5393      /* ------------------------- CONSISTE BENEFICIARIO ------------------------------------*/
     5394      run consiste-beneficiario(input-output lg-erro-par).
     5395   
     5396      /* ------------------- CONSISTE PRESTADOR PRINCIPAL ---------------------------------- */
     5397      run consiste-prestador-principal(input-output lg-erro-par).
     5398   
     5399     /* ------------------------------------- CLINICA --------------------------------- */
     5400     if import-guia.cd-clinica > 0
     5401     then do:
     5402            if not can-find(clinicas where clinicas.cd-clinica = import-guia.cd-clinica)
     5403            then do:
     5404                   run grava-erro(input import-guia.num-seqcial-control,
     5405                                  input "import-guia",
     5406                                  input "Clinica nao cadastrada (import-guia.cd-clinica): " + string(import-guia.cd-clinica,"99999999"),
     5407                                  input today,
     5408                                  input "Informe um codigo de clinica valido.").
     5409            
     5410                   assign lg-erro-par = yes.
     5411                 end.
     5412            
     5413            if not can-find(clinpres where clinpres.cd-clinica   = import-guia.cd-clinica            
     5414                                       and clinpres.cd-unidade   = import-guia.cd-unidade-principal  
     5415                                       and clinpres.cd-prestador = import-guia.cd-prestador-principal)
     5416            then do:
     5417                   run grava-erro(input import-guia.num-seqcial-control,
     5418                                  input "import-guia",
     5419                                  input "Prestador principal nao esta vinculado a clinica informada. " +
     5420                                        " import-guia.cd-clinica: " + string(import-guia.cd-clinica)  +
     5421                                        " import-guia.cd-unidade-principal: " + string(import-guia.cd-unidade-principal) + 
     5422                                        " import-guia.cd-prestador-principal: " + string(import-guia.cd-prestador-principal),
     5423                                  input today,
     5424                                  input "O prestador principal deve estar vinculado a clinica. Verifique o cadastro ac0210h").
     5425            
     5426                   assign lg-erro-par = yes.
     5427                 end.
     5428          end.
     5429   
     5430     /* -------------------------------- TIPO DE GUIA ----------------------------------- */
     5431     find tip-guia where tip-guia.cd-tipo-guia = import-guia.cd-tipo-guia no-lock no-error.
     5432     if not avail tip-guia
     5433     then do:
     5434            run grava-erro(input import-guia.num-seqcial-control,
     5435                           input "import-guia",
     5436                           input "Tipo de Guia nao cadastrado (tip-guia.cd-tipo-guia): " + string(import-guia.cd-tipo-guia),
     5437                           input today,
     5438                           input "Informe um tipo de guia valido.").
     5439            
     5440            assign lg-erro-par = yes.
     5441          end.
     5442   
     5443     /* --------------------------- LOCAL DE AUTORIZACAO ----------------------------- */
     5444     if import-guia.num-livre-1 > 0
     5445     then do:
     5446            if not can-find(locaauto where locaauto.cd-local-autorizacao = import-guia.num-livre-1)
     5447            then do:
     5448                   run grava-erro(input import-guia.num-seqcial-control,
     5449                                  input "import-guia",
     5450                                  input "Local de autorizacao nao cadastrado (import-guia.num-livre-1): " + string(import-guia.num-livre-1),
     5451                                  input today,
     5452                                  input "Informe um local de autorizacao cadastrado no Gestao de Planos.").
     5453                   
     5454                   assign lg-erro-par = yes.
     5455                 end.
     5456          end.
     5457     else do:
     5458            if avail tip-guia
     5459            and tip-guia.lg-trata-local-autorizacao
     5460            then do:
     5461                   run grava-erro(input import-guia.num-seqcial-control,
     5462                                  input "import-guia",
     5463                                  input "Local de autorizacao deve ser informado (import-guia.num-livre-1).",
     5464                                  input today,
     5465                                  input "O tipo de guia informado exige a informacao do local de autorizacao.").
     5466                   
     5467                   assign lg-erro-par = yes.
     5468                 end.
     5469          end.
     5470   
     5471     /* --------------- VERIFICA SE GUIA PRINCIPAL JA FOI CRIADA --------------------- */
     5472     if import-guia.num-seqcial-princ > 0
     5473     then do:
     5474            find b-import-guia where b-import-guia.num-seqcial = import-guia.num-seqcial-princ
     5475                                     no-lock no-error.
     5476   
     5477            if not avail b-import-guia
     5478            then do:
     5479                   run grava-erro(input import-guia.num-seqcial-control,
     5480                                  input "import-guia",
     5481                                  input "Registro da guia principal nao encontrado. import-guia.num-seqcial-princ: " + string(import-guia.num-seqcial-princ),
     5482                                  input today,
     5483                                  input "A guia informada esta vinculada a uma guia principal. O registro "
     5484                                        + "import-guia da guia principal nao foi encontrado").
     5485                   
     5486                   assign lg-erro-par = yes.
     5487                 end.
     5488            else do:
     5489                   if b-import-guia.aa-guia-atendimento = 0
     5490                   or b-import-guia.nr-guia-atendimento = 0
     5491                   then do:
     5492                          run grava-erro(input import-guia.num-seqcial-control,
     5493                                         input "import-guia",
     5494                                         input "Codigo da guia de autorizacao principal esta zerado.",
     5495                                         input today,
     5496                                         input "O codigo da guia principal esta igual a zero no registro import-guia "
     5497                                               + "da guia principal").
     5498                          
     5499                          assign lg-erro-par = yes.
     5500                        end.
     5501   
     5502                   assign aa-guia-atend-ant-aux = b-import-guia.aa-guia-atendimento
     5503                          nr-guia-atend-ant-aux = b-import-guia.nr-guia-atendimento.
     5504                 end.
     5505          end.
     5506   
     5507     /* ----------------------- VALIDA CBO ----------------------------- */
     5508     if  import-guia.cdn-cbo <> ?
     5509     and import-guia.cdn-cbo <> 0
     5510     then do:
     5511            if not can-find(first dz-cbo02 where dz-cbo02.cd-cbo = import-guia.cdn-cbo) 
     5512            then do:
     5513                   run grava-erro(input import-guia.num-seqcial-control,
     5514                                  input "import-guia",
     5515                                  input "CBO informado nao cadastrado: " + string(import-guia.cdn-cbo),
     5516                                  input today,
     5517                                  input "Informe um CBO cadastrado no Gestao de Planos.").
     5518                   
     5519                   assign lg-erro-par = yes.
     5520                 end.
     5521          end.
     5522   
     5523     /* ------------------- DATA DE EMISSAO ----------------------------- */
     5524     if import-guia.dat-solicit = ?
     5525     then do:
     5526            run grava-erro(input import-guia.num-seqcial-control,
     5527                           input "import-guia",
     5528                           input "Data da solicitacao nao informada.",
     5529                           input today,
     5530                           input "Informe a data da solicitacao.").
     5531            
     5532            assign lg-erro-par = yes.
     5533          end.
     5534   
     5535   end procedure.
     5536   
     5537   /* ----------------------------------------------------------------- */
     5538   procedure consiste-beneficiario:
     5539   
     5540       def input-output parameter lg-erro-par as log no-undo.
     5541   
     5542       assign cd-unidade-carteira-aux = 0
     5543              cd-carteira-aux         = 0
     5544              nr-carteira-aux         = 0.
     5545   
     5546       if import-guia.cd-unidade-carteira <> paramecp.cd-unimed
     5547       then do:
     5548              find first out-uni 
     5549                   where out-uni.cd-unidade          = import-guia.cd-unidade-carteira
     5550                     and out-uni.cd-carteira-usuario = import-guia.cd-carteira-usuario NO-LOCK NO-ERROR.
     5551              if not avail out-uni 
     5552              then do:
     5553                     create out-uni. /* cria-out-uni quando nao existir na base */                   
     5554                     assign out-uni.cd-unidade           = import-guia.cd-unidade-carteira
     5555                            out-uni.cd-carteira-usuario  = import-guia.cd-carteira-usuario
     5556                            out-uni.nm-usuario           = import-guia.nom-benef-intercam
     5557                            out-uni.lg-sexo              = import-guia.log-livre-1 /* sexo*/
     5558                            out-uni.dt-nascimento        = import-guia.dat-livre-1 /* data de nascimento*/
     5559                            out-uni.dt-cadastro          = today
     5560                            out-uni.dt-atualizacao       = today
     5561                            out-uni.cd-userid            = v_cod_usuar_corren. 
     5562                   end.
     5563   
     5564              assign cd-unidade-carteira-aux = out-uni.cd-unidade
     5565                     cd-carteira-aux         = out-uni.cd-carteira-usuario
     5566                     nr-carteira-aux         = 0.
     5567   
     5568              find first unicamco where unicamco.cd-unidade = out-uni.cd-unidade 
     5569                                    and unicamco.dt-limite >= import-guia.dat-solicit
     5570                                        no-lock no-error.
     5571    
     5572              if   not available unicamco
     5573              then do:
     5574                     run grava-erro(input import-guia.num-seqcial-control,
     5575                                    input "import-guia",
     5576                                    input "Associacao entre as Unidades e a camara de compensacao nao existe (tabela unicamco). " + 
     5577                                          " out-uni.cd-unidade: " + string(out-uni.cd-unidade) + 
     5578                                          " import-guia.dat-solicit: " + string(import-guia.dat-solicit),
     5579                                    input today,
     5580                                    input "Tabela unicamco nao encontrada").
     5581                     
     5582                     assign lg-erro-par = yes.
     5583                     return.
     5584                   end.
     5585   
     5586              find unimed where unimed.cd-unimed = out-uni.cd-unidade no-lock no-error.
     5587   
     5588              if   not available unimed
     5589              then do:
     5590                     run grava-erro(input import-guia.num-seqcial-control,
     5591                                    input "import-guia",
     5592                                    input "Unidade de intercambio nao encontrada. " + 
     5593                                          " out-uni.cd-unidade: " + string(out-uni.cd-unidade),
     5594                                    input today,
     5595                                    input "Unidade de intercambio nao encontrada").
     5596                     
     5597                     assign lg-erro-par = yes.
     5598                     return.
     5599                   end.
     5600   
     5601              assign cd-modalidade-aux = unicamco.cd-modalidade 
     5602                     nr-ter-adesao-aux = 0
     5603                     cd-usuario-aux    = 0
     5604                     cd-plano-aux      = unicamco.cd-plano
     5605                     cd-tipo-plano-aux = unicamco.cd-tipo-plano.
     5606    
     5607            end.
     5608       else do:          
     5609              find first usuario where usuario.cd-carteira-antiga = import-guia.cd-carteira-usuario no-lock no-error.
     5610          
     5611              if  not avail usuario
     5612              then do:
     5613                     run grava-erro(input import-guia.num-seqcial-control,
     5614                                    input "import-guia",
     5615                                    input "Beneficiario nao encontrado.",
     5616                                    input today,
     5617                                    input "Carteira:" + STRING(import-guia.cd-carteira-usuario)).
     5618          
     5619                     assign lg-erro-par = yes.
     5620                     return.
     5621                  end.
     5622                  
     5623              ASSIGN cd-modalidade-aux  = usuario.cd-modalidade 
     5624                     nr-ter-adesao-aux  = usuario.nr-ter-adesao
     5625                     cd-usuario-aux     = usuario.cd-usuario.
     5626              
     5627              FOR FIRST propost FIELDS (cd-plano cd-tipo-plano)
     5628                  WHERE propost.cd-modalidade = usuario.cd-modalidade
     5629                    AND propost.nr-ter-adesao = usuario.nr-ter-adesao NO-LOCK:
     5630              
     5631                  ASSIGN cd-plano-aux      = propost.cd-plano 
     5632                         cd-tipo-plano-aux = propost.cd-tipo-plano.
     5633              END.
     5634              
     5635              FIND LAST car-ide 
     5636                  WHERE car-ide.cd-unimed      = paramecp.cd-unimed 
     5637                    and car-ide.cd-modalidade  = usuario.cd-modalidade
     5638                    and car-ide.nr-ter-adesao  = usuario.nr-ter-adesao
     5639                    and car-ide.cd-usuario     = usuario.cd-usuario NO-LOCK NO-ERROR.
     5640              
     5641              IF AVAIL car-ide
     5642              THEN ASSIGN cd-unidade-carteira-aux = car-ide.cd-unimed
     5643                          cd-carteira-aux         = car-ide.cd-carteira-inteira
     5644                          nr-carteira-aux         = car-ide.nr-carteira.    
     5645            end.
     5646   
     5647        FIND FIRST ti-pl-sa 
     5648             WHERE ti-pl-sa.cd-modalidade = cd-modalidade-aux
     5649               AND ti-pl-sa.cd-plano      = cd-plano-aux
     5650               AND ti-pl-sa.cd-tipo-plano = cd-tipo-plano-aux NO-LOCK NO-ERROR.
     5651       
     5652        ASSIGN cd-cla-hos-aux = ti-pl-sa.cd-cla-hos WHEN AVAIL ti-pl-sa.
     5653       
     5654        FIND FIRST clashosp WHERE clashosp.cd-cla-hos = cd-cla-hos-aux NO-LOCK NO-ERROR.
     5655       
     5656        ASSIGN nr-indice-aux = clashosp.nr-indice-hierarquico WHEN AVAIL clashosp.
     5657        
     5658        if  cd-unidade-carteira-aux = 0
     5659        and cd-carteira-aux        = 0
     5660        then do:
     5661               run grava-erro(input import-guia.num-seqcial-control,
     5662                                    input "import-guia",
     5663                                    input "Carteira do beneficiario nao encontrada.",
     5664                                    input today,
     5665                                    input "Unidade/Carteira informada: "  + STRING(import-guia.cd-unidade-carteira) + STRING(import-guia.cd-carteira-usuario)).
     5666            
     5667                     assign lg-erro-par = yes.
     5668                     return.
     5669            end.
     5670   
     5671   end procedure.
     5672   
     5673   /* ----------------------------------------------------------------- */
     5674   procedure consiste-prestador-principal:
     5675   
     5676       def input-output parameter lg-erro-par as log no-undo.
     5677   
     5678       find preserv where preserv.cd-unidade   = import-guia.cd-unidade-principal  
     5679                      and preserv.cd-prestador = import-guia.cd-prestador-principal
     5680                          no-lock no-error.
     5681   
     5682       if not avail preserv
     5683       then do:
     5684              run grava-erro(input import-guia.num-seqcial-control,
     5685                             input "import-guia",
     5686                             input "Prestador principal nao encontrado. Unidade: "
     5687                                 + string(import-guia.cd-unidade-principal,"9999")
     5688                                 + " Prestador: "
     5689                                 + string(import-guia.cd-prestador-principal,"99999999"),
     5690                             input today,
     5691                             input "Informe um codigo valido para o prestador principal").
     5692   
     5693              assign lg-erro-par = yes.
     5694            end.
     5695       else do:
     5696              IF NOT CAN-FIND(FIRST preserv
     5697                              WHERE preserv.cd-unidade   = import-guia.cd-unidade-principal
     5698                                AND preserv.cd-prestador = import-guia.cd-prestador-principal)
     5699              THEN DO:
     5700                     run grava-erro(input import-guia.num-seqcial-control,
     5701                                    input "import-guia",
     5702                                    input "Prestador principal nao encontrado." +
     5703                                          " Unidade(import-guia.cd-unidade-principal): " + string(import-guia.cd-unidade-principal) + 
     5704                                          " Prestador(import-guia.cd-prestador-principal): " + string(import-guia.cd-prestador-principal) + 
     5705                                          " import-guia.num-seqcial-control: " + string(import-guia.num-seqcial-control),
     5706                                    input today,
     5707                                    input "Verifique se o prestador informado existe no Cadastro de Prestadores.").
     5708                     assign lg-erro-par = yes.
     5709                   END.
     5710   
     5711              run busca-vinculo-prestador(input  import-guia.cd-unidade-principal,
     5712                                          input  import-guia.cd-prestador-principal,
     5713                                          input  0,
     5714                                          input  import-guia.dat-solicit,
     5715                                          output cd-vinculo-principal-aux,
     5716                                          output lg-erro-vinculo-aux). 
     5717              
     5718              if lg-erro-vinculo-aux
     5719              then do:
     5720                     IF cd-vinculo-principal-aux <> ?
     5721                     THEN char-aux1 = string(cd-vinculo-principal-aux).
     5722                     ELSE char-aux1 = "nulo".
     5723                     run grava-erro(input import-guia.num-seqcial-control,
     5724                                    input "import-guia",
     5725                                    input "Vinculo nao encontrado para o prestador principal. Unidade: " + string(import-guia.cd-unidade-principal,"9999") + 
     5726                                          " Prestador: " + string(import-guia.cd-prestador-principal,"99999999") +
     5727                                          " Vinculo: " + char-aux1,
     5728                                    input today,
     5729                                    input "Verifique se o prestador informado possui vinculo cadastrado.").
     5730              
     5731                     assign lg-erro-par = yes.
     5732                   end.
     5733            end.
     5734   
     5735   end procedure.
     5736   
     5737   /* ----------------------------------------------------------------- */
     5738   procedure consiste-prestador-solicitante:
     5739   
     5740       def input-output param lg-erro-par as log no-undo.
     5741   
     5742       if import-guia.cd-especialidade = ?
     5743       or import-guia.cd-especialidade = 0
     5744       then do:
     5745              run grava-erro(input import-guia.num-seqcial-control,
     5746                             input "import-guia",
     5747                             input "Especialidade do prestador solicitante nao informada. " + 
     5748                                   " Unidade: " + string(import-guia.cd-unidade-solic) + 
     5749                                   " Prestador: " + string(import-guia.cd-prestador-solic) + 
     5750                                   " Especialidade: " + string(import-guia.cd-especialidade),
     5751                             input today,
     5752                             input "Informe um codigo para a especialidade do prestador solicitante").
     5753   
     5754              assign lg-erro-par = yes.
     5755            end.
     5756   
     5757       find preserv where preserv.cd-unidade   = import-guia.cd-unidade-solic
     5758                      and preserv.cd-prestador = int(import-guia.cd-prestador-solic)
     5759                          no-lock no-error.
     5760       if not avail preserv
     5761       then do:
     5762              run grava-erro(input import-guia.num-seqcial-control,
     5763                             input "import-guia",
     5764                             input "Prestador Solicitante informado nao cadastrado. Unidade: "
     5765                                 + string(import-guia.cd-unidade-solic,"9999")
     5766                                 + " Prestador: " 
     5767                                 + string(import-guia.cd-prestador-solic,"99999999"),
     5768                             input today,
     5769                             input "Informe um codigo de prestador cadastrado no Gestao de Planos.").
     5770              assign lg-erro-par = yes.
     5771              return.
     5772            end.
     5773       
     5774       if preserv.in-tipo-pessoa = "J" /* Pessoa Juridica */
     5775       then do:
     5776              if import-guia.nom-prestdor-solic = ?
     5777              or import-guia.nom-prestdor-solic = ""
     5778              then do:
     5779                     run grava-erro(input import-guia.num-seqcial-control,
     5780                                    input "import-guia",
     5781                                    input "Nome do prestador solicitante pessoa fisica nao informado. Unidade: " + string(import-guia.cd-unidade-solic,"9999") + 
     5782                                          " Prestador: " + string(import-guia.cd-prestador-solic,"99999999"),
     5783                                    input today,
     5784                                    input "O prestador solicitante e pessoa juridica. Informe o nome do prestador solicitante pessoa fisica.").
     5785   
     5786                     assign lg-erro-par = yes.
     5787                   end.
     5788   
     5789              if import-guia.cod-cons-profis = ?
     5790              or import-guia.cod-cons-profis = ""
     5791              then do:
     5792                     run grava-erro(input import-guia.num-seqcial-control,
     5793                                    input "import-guia",
     5794                                    input "Conselho do prestador solicitante pessoa fisica nao informado. Unidade: " + string(import-guia.cd-unidade-solic,"9999") + 
     5795                                          " Prestador: " + string(import-guia.cd-prestador-solic,"99999999"),
     5796                                    input today,
     5797                                    input "O prestador solicitante e pessoa juridica. Informe o conselho profissional do prestador solicitante pessoa fisica.").
     5798   
     5799                     assign lg-erro-par = yes.
     5800                   end.
     5801              else do:
     5802                     if not can-find(conpres where conpres.cd-conselho = trim(import-guia.cod-cons-profis))
     5803                     then do:
     5804                            IF import-guia.cod-cons-profis <> ?
     5805                            THEN char-aux1 = string(import-guia.cod-cons-profis).
     5806                            ELSE char-aux1 = "nulo".
     5807                            run grava-erro(input import-guia.num-seqcial-control,
     5808                                           input "import-guia",
     5809                                           input "Conselho do prestador solicitante pessoa fisica nao cadastrado.",
     5810                                           input today,
     5811                                           input "Unidade: " + string(import-guia.cd-unidade-solic,"9999") + 
     5812                                                 " Prestador: " + string(import-guia.cd-prestador-solic,"99999999") + 
     5813                                                 "  Conselho(import-guia.cod-cons-profis): " + char-aux1).
     5814   
     5815                            assign lg-erro-par = yes.
     5816                          end.
     5817                   end.
     5818   
     5819              if import-guia.ind-nume-cons = ?
     5820              or import-guia.ind-nume-cons = ""
     5821              then do:
     5822                     run grava-erro(input import-guia.num-seqcial-control,
     5823                                    input "import-guia",
     5824                                    input "Numero do registro do prestador solicitante pessoa fisica nao informado. Unidade: " + string(import-guia.cd-unidade-solic,"9999") + 
     5825                                          " Prestador: " + string(import-guia.cd-prestador-solic,"99999999"),
     5826                                    input today,
     5827                                    input "O prestador solicitante e pessoa juridica. Informe o numero do registro doprestador solicitante pessoa fisica.").
     5828   
     5829                     assign lg-erro-par = yes.
     5830                   end.
     5831            end.
     5832   
     5833       IF NOT CAN-FIND(FIRST preserv
     5834                       WHERE preserv.cd-unidade   = import-guia.cd-unidade-solic
     5835                         AND preserv.cd-prestador = int(import-guia.cd-prestador-solic))
     5836       THEN DO:
     5837              run grava-erro(input import-guia.num-seqcial-control,
     5838                             input "import-guia",
     5839                             input "Prestador solicitante nao encontrado." +
     5840                                   " Unidade(import-guia.cd-unidade-solic): " + string(import-guia.cd-unidade-solic) + 
     5841                                   " Prestador(import-guia.cd-prestador-solic): " + string(import-guia.cd-prestador-solic) + 
     5842                                   " import-guia.num-seqcial-control: " + string(import-guia.num-seqcial-control),
     5843                             input today,
     5844                             input "Verifique se o prestador informado existe no Cadastro de Prestadores.").
     5845              assign lg-erro-par = yes.
     5846            END.
     5847   
     5848       run busca-vinculo-prestador(input  import-guia.cd-unidade-solic,
     5849                                   input  int(import-guia.cd-prestador-solic),
     5850                                   input  import-guia.cd-especialidade,
     5851                                   input  import-guia.dat-solicit,
     5852                                   output cd-vinculo-solic-aux,
     5853                                   output lg-erro-vinculo-aux).
     5854   
     5855       if lg-erro-vinculo-aux
     5856       then do:
     5857              IF cd-vinculo-solic-aux <> ?
     5858              THEN char-aux1 = string(cd-vinculo-solic-aux).
     5859              ELSE char-aux1 = "nulo".
     5860              run grava-erro(input import-guia.num-seqcial-control,
     5861                             input "import-guia",
     5862                             input "Vinculo nao encontrado para o prestador solicitante e especialidade.",
     5863                             input today,
     5864                             input "Unidade: " + string(import-guia.cd-unidade-solic,"9999") + 
     5865                                   " Prestador: " + string(import-guia.cd-prestador-solic,"99999999") + 
     5866                                   " Especialid: " + STRING(import-guia.cd-especialidade) +
     5867                                   " Dt.Solic: "   + STRING(import-guia.dat-solicit) +
     5868                                   " Vinculo: " + char-aux1).
     5869              
     5870              assign lg-erro-par = yes.
     5871            end.
     5872   
     5873   end procedure.
     5874   
     5875   /* ----------------------------------------------------------------- */
     5876   procedure busca-vinculo-prestador:
     5877   
     5878       def input  param cd-unidade-par   as int  no-undo.
     5879       def input  param cd-prestador-par as int  no-undo.
     5880       def input  param cd-espec-par     as int  no-undo.
     5881       def input  param dt-base-par      as date no-undo.
     5882       def output param cd-vinculo-par   as int  no-undo.
     5883       def output param lg-erro-par      as log  no-undo.
     5884   
     5885       assign lg-erro-par = no.
     5886   
     5887       if cd-espec-par > 0
     5888       then do:
     5889              find first previesp where previesp.cd-especialid       = cd-espec-par
     5890                                    and previesp.cd-unidade          = cd-unidade-par
     5891                                    and previesp.cd-prestador        = cd-prestador-par
     5892                                    /*and previesp.dt-inicio-validade <= dt-base-par
     5893                                    and previesp.dt-fim-validade    >= dt-base-par
     5894                                    retirada validacao de data para permitir importao de movimentao gerada no Unicoo aps descredenciamento do prestador*/
     5895                                        no-lock no-error.
     5896              
     5897              if avail previesp
     5898              then assign cd-vinculo-par = previesp.cd-vinculo.
     5899              else DO:
     5900                     for each previesp where previesp.cd-unidade   = cd-unidade-par  
     5901                                         and previesp.cd-prestador = cd-prestador-par
     5902                                         and previesp.lg-principal
     5903                                             no-lock:
     5904                     
     5905                         /*if  previesp.dt-inicio-validade <= dt-base-par
     5906                         and previesp.dt-fim-validade    >= dt-base-par 
     5907                         then*/ leave.
     5908                     end.
     5909   
     5910                     if avail previesp
     5911                     then assign cd-vinculo-par = previesp.cd-vinculo.
     5912                     else DO:
     5913                             for each previesp where previesp.cd-unidade   = cd-unidade-par  
     5914                                                 and previesp.cd-prestador = cd-prestador-par
     5915                                                     no-lock:
     5916                             
     5917                                 /*if  previesp.dt-inicio-validade <= dt-base-par
     5918                                 and previesp.dt-fim-validade    >= dt-base-par 
     5919                                 then*/ leave.
     5920                             end.
     5921   
     5922                             if avail previesp
     5923                             then assign cd-vinculo-par = previesp.cd-vinculo.
     5924                             else assign lg-erro-par = yes.
     5925                          END.
     5926                   END.
     5927            end.
     5928       else do:
     5929              for each previesp where previesp.cd-unidade   = cd-unidade-par  
     5930                                  and previesp.cd-prestador = cd-prestador-par
     5931                                  and previesp.lg-considera-qt-vinculo
     5932                                      no-lock:
     5933   
     5934                  /*if  previesp.dt-inicio-validade <= dt-base-par
     5935                  and previesp.dt-fim-validade    >= dt-base-par 
     5936                  then*/ leave.
     5937              end.
     5938   
     5939              if avail previesp
     5940              then assign cd-vinculo-par = previesp.cd-vinculo.
     5941              else do:
     5942                     for each previesp where previesp.cd-unidade   = cd-unidade-par  
     5943                                         and previesp.cd-prestador = cd-prestador-par
     5944                                         and not previesp.lg-considera-qt-vinculo
     5945                                             no-lock:
     5946                     
     5947                         /*if  previesp.dt-inicio-validade <= dt-base-par
     5948                         and previesp.dt-fim-validade    >= dt-base-par 
     5949                         then*/ leave.
     5950                     end.
     5951   
     5952                     if avail previesp
     5953                     then assign cd-vinculo-par = previesp.cd-vinculo.
     5954                     else assign lg-erro-par = yes.
     5955                   end.
     5956            end.
     5957   
     5958   end procedure.
     5959   
     5960   /* ----------------------------------------------------------------- */
     5961   procedure valida-glosas:
     5962   
     5963       def input        param ind-tip-guia-par  as char format "x(4)" no-undo.
     5964       def input        param val-seqcial-movto as int                no-undo.
     5965       def input        param val-seq-guia      as int                no-undo.
     5966       def input-output param lg-erro-par       as log                no-undo.
     5967   
     5968       for each import-movto-glosa
     5969          where import-movto-glosa.in-modulo         = "AT"
     5970            and import-movto-glosa.ind-tip-guia      = ind-tip-guia-par 
     5971            and import-movto-glosa.val-seqcial-movto = val-seqcial-movto
     5972            and import-movto-glosa.val-seq-guia      = val-seq-guia     
     5973                no-lock:
     5974   
     5975           if not can-find(claserro where claserro.cd-classe-erro = import-movto-glosa.cd-classe-erro)
     5976           then do:
     5977                  run grava-erro(input import-guia.num-seqcial-control,
     5978                                 input "import-movto-glosa",
     5979                                 input "Classe de erro nao cadastrada: "                       + string(import-movto-glosa.cd-classe-erro) + 
     5980                                       " Tp.Guia(import-movto-glosa.ind-tip-guia): "           + string(import-movto-glosa.ind-tip-guia) + 
     5981                                       " Nro.Seq.Mvto(import-movto-glosa.val-seqcial-movto): " + string(import-movto-glosa.val-seqcial-movto) +
     5982                                       " Nro.Seq.Guia(import-movto-glosa.val-seq-guia)"        + string(import-movto-glosa.val-seq-guia),     
     5983                                 input today,
     5984                                 input "Informe um codigo de classe de erro valido.").
     5985   
     5986                  assign lg-erro-par = yes.
     5987                end.
     5988   
     5989           if not can-find(first codiglos 
     5990                           where codiglos.cd-classe-erro = import-movto-glosa.cd-classe-erro
     5991                             and codiglos.cd-cod-glo     = import-movto-glosa.cd-cod-glo)
     5992           then do:
     5993                  run grava-erro(input import-guia.num-seqcial-control,
     5994                                 input "import-movto-glosa",
     5995                                 input "Glosa nao cadastrada: " + string(import-movto-glosa.cd-cod-glo) + 
     5996                                       " Tp.Guia(import-movto-glosa.ind-tip-guia): "           + string(import-movto-glosa.ind-tip-guia) + 
     5997                                       " Nro.Seq.Mvto(import-movto-glosa.val-seqcial-movto): " + string(import-movto-glosa.val-seqcial-movto) +
     5998                                       " Nro.Seq.Guia(import-movto-glosa.val-seq-guia)"        + string(import-movto-glosa.val-seq-guia),
     5999                                 input today,
     6000                                 input "Informe um codigo de glosa valido.").
     6001                  
     6002                  assign lg-erro-par = yes.
     6003                end.
     6004       end. /* each import-movto-glosa */
     6005   
     6006   end procedure.
     6007   
     6008   /* ----------------------------------------------------------------- */
     6009   procedure valida-dados-movimento:
     6010   
     6011       def input-output param lg-erro-par as log no-undo.
     6012   
     6013       /* ------------------- VALIDA MODULO DE COBERTURA ------------------------- */
     6014       if import-guia-movto.cd-modulo = ?
     6015       or import-guia-movto.cd-modulo = 0
     6016       then do:
     6017              run grava-erro(input import-guia.num-seqcial-control,
     6018                             input "import-guia-movto",
     6019                             input "Modulo de cobertura nao informado. ",
     6020                             input today,
     6021                             input "Tp.Guia(import-guia-movto.ind-tip-guia): "      + string(import-guia-movto.ind-tip-guia) + 
     6022                                   " Nro.Seq.Guia(import-guia-movto.val-seq-guia): " + string(import-guia-movto.val-seq-guia)).
     6023              
     6024              assign lg-erro-par = yes.
     6025            end.
     6026       ELSE 
     6027               if not can-find(mod-cob where mod-cob.cd-modulo = import-guia-movto.cd-modulo)
     6028               then do:
     6029                      IF import-guia-movto.cd-modulo <> ?
     6030                      THEN char-aux1 = string(import-guia-movto.cd-modulo).
     6031                      ELSE char-aux1 = "nulo".
     6032                      run grava-erro(input import-guia.num-seqcial-control,
     6033                                     input "import-guia-movto",
     6034                                     input "Modulo de cobertura nao cadastrado. " + 
     6035                                           " Tp.Guia(import-guia-movto.ind-tip-guia): "      + string(import-guia-movto.ind-tip-guia) + 
     6036                                           " Nro.Seq.Guia(import-guia-movto.val-seq-guia): " + string(import-guia-movto.val-seq-guia) + 
     6037                                           " Modulo: " + char-aux1,
     6038                                     input today,
     6039                                     input "Informe um modulo de cobertura cadastrado no Gestao de Planos.").
     6040                      
     6041                      assign lg-erro-par = yes.
     6042                    end.
     6043   
     6044       /* ----------------------------------- VALIDA MOVIMENTO --------------------------- */
     6045       if import-guia-movto.log-livre-1 = NO /* true: pacote; false: nao eh pacote */
     6046       then do:
     6047              if import-guia-movto.ind-tip-movto-guia = "P"
     6048              then do:
     6049                     assign cd-esp-amb-aux        = int(substr(string(int(import-guia-movto.cod-movto-guia),"99999999"),1,2))
     6050                            cd-grupo-proc-amb-aux = int(substr(string(int(import-guia-movto.cod-movto-guia),"99999999"),3,2))
     6051                            cd-procedimento-aux   = int(substr(string(int(import-guia-movto.cod-movto-guia),"99999999"),5,3))
     6052                            dv-procedimento-aux   = int(substr(string(int(import-guia-movto.cod-movto-guia),"99999999"),8,1)).
     6053              
     6054                     if not can-find(ambproce where ambproce.cd-esp-amb        = cd-esp-amb-aux
     6055                                                and ambproce.cd-grupo-proc-amb = cd-grupo-proc-amb-aux
     6056                                                and ambproce.cd-procedimento   = cd-procedimento-aux
     6057                                                and ambproce.dv-procedimento   = dv-procedimento-aux)
     6058                     then do:
     6059                            run grava-erro(input import-guia.num-seqcial-control,
     6060                                           input "import-guia-movto",
     6061                                           input "Procedimento nao cadastrado: " + import-guia-movto.cod-movto-guia + 
     6062                                                 " Tp.Guia(import-guia-movto.ind-tip-guia): "      + string(import-guia-movto.ind-tip-guia) + 
     6063                                                 " Nro.Seq.Guia(import-guia-movto.val-seq-guia): " + string(import-guia-movto.val-seq-guia),
     6064                                           input today,
     6065                                           input "Informe um codigo de procedimento valido.").
     6066              
     6067                            assign lg-erro-par = yes.
     6068                          end.
     6069   
     6070                     if not can-find(first pl-mo-am where pl-mo-am.cd-modalidade          = cd-modalidade-aux
     6071                                                      and pl-mo-am.cd-plano               = cd-plano-aux
     6072                                                      and pl-mo-am.cd-tipo-plano          = cd-tipo-plano-aux
     6073                                                      and pl-mo-am.cd-amb                 = int(import-guia-movto.cod-movto-guia)
     6074                                                      and pl-mo-am.cd-modulo              = import-guia-movto.cd-modulo)
     6075                     then do:
     6076                            if not can-find(first plamodpr where plamodpr.cd-modalidade          = cd-modalidade-aux
     6077                                                             and plamodpr.cd-plano               = cd-plano-aux
     6078                                                             and plamodpr.cd-tipo-plano          = cd-tipo-plano-aux
     6079                                                             and plamodpr.in-procedimento-insumo = "P"
     6080                                                             and plamodpr.cd-modulo              = import-guia-movto.cd-modulo)
     6081                            then do:
     6082                                   IF cd-modalidade-aux <> ?
     6083                                   THEN char-aux1 = string(cd-modalidade-aux).
     6084                                   ELSE char-aux1 = "nulo".
     6085                                   IF cd-plano-aux <> ?
     6086                                   THEN char-aux2 = string(cd-plano-aux).
     6087                                   ELSE char-aux2 = "nulo".
     6088                                   IF cd-tipo-plano-aux <> ?
     6089                                   THEN char-aux3 = string(cd-tipo-plano-aux).
     6090                                   ELSE char-aux3 = "nulo".
     6091                                   IF import-guia-movto.cd-modulo <> ?
     6092                                   THEN char-aux4 = string(import-guia-movto.cd-modulo).
     6093                                   ELSE char-aux4 = "nulo".
     6094                                   IF import-guia-movto.cod-movto-guia <> ?
     6095                                   THEN char-aux5 = import-guia-movto.cod-movto-guia.
     6096                                   ELSE char-aux5 = "nulo".
     6097                                   run grava-erro(input import-guia.num-seqcial-control,
     6098                                                  input "import-guia-movto",
     6099                                                  input "Tabela padrao de moedas e carencias (pl-mo-am ou plamodpr) nao encontrada para a estrutura neste modulo." ,
     6100                                                  input today,
     6101                                                  input " Tp.Guia(import-guia-movto.ind-tip-guia): "      + string(import-guia-movto.ind-tip-guia) + 
     6102                                                        " Nro.Seq.Guia(import-guia-movto.val-seq-guia): " + string(import-guia-movto.val-seq-guia) + 
     6103                                                        " Mod.: "     + char-aux1 + 
     6104                                                        " Plano: "    + char-aux2      + 
     6105                                                        " Tp.Plano: " + char-aux3 +
     6106                                                        " Modulo: "   + char-aux4 +
     6107                                                        " Servico: "  + char-aux5).
     6108                                   
     6109                                   assign lg-erro-par = yes.
     6110                                 end.
     6111                          end.
     6112                   end.
     6113              else do:
     6114                     assign cd-tipo-insumo-aux = 0
     6115                            /*cd-tipo-insumo-aux = int(substr(string(dec(import-guia-movto.cod-movto-guia),"9999999999"),1,2))*/
     6116                            cd-insumo-aux      = int(substr(string(dec(import-guia-movto.cod-movto-guia),"9999999999"),3,8)).
     6117              
     6118                     find first insumos where insumos.cd-insumo = int(import-guia-movto.cod-movto-guia) no-lock no-error.
     6119                     if not avail insumos
     6120                     then do:
     6121                            run grava-erro(input import-guia.num-seqcial-control,
     6122                                           input "import-guia-movto",
     6123                                           input "Insumo nao cadastrado: " + import-guia-movto.cod-movto-guia + 
     6124                                                 " Tp.Guia(import-guia-movto.ind-tip-guia): "      + string(import-guia-movto.ind-tip-guia) + 
     6125                                                 " Nro.Seq.Guia(import-guia-movto.val-seq-guia): " + string(import-guia-movto.val-seq-guia),
     6126                                           input today,
     6127                                           input "Informe um codigo de insumo valido.").
     6128              
     6129                            assign lg-erro-par = yes.
     6130                          end.
     6131                     else do:
     6132                            ASSIGN cd-tipo-insumo-aux = insumos.cd-tipo-insumo.
     6133   
     6134                            if import-guia-movto.ind-tip-guia = "OPME"
     6135                            and not insumos.lg-opme
     6136                            then do:
     6137                                   run grava-erro(input import-guia.num-seqcial-control,
     6138                                                  input "import-guia-movto",
     6139                                                  input "Insumo nao e do tipo OPME: " + import-guia-movto.cod-movto-guia + 
     6140                                                        " Tp.Guia(import-guia-movto.ind-tip-guia): "      + string(import-guia-movto.ind-tip-guia) + 
     6141                                                        " Nro.Seq.Guia(import-guia-movto.val-seq-guia): " + string(import-guia-movto.val-seq-guia),
     6142                                                  input today,
     6143                                                  input "Para anexos OPME, os insumos informados deve ser do tipo OPME.").
     6144              
     6145                                   assign lg-erro-par = yes.
     6146                                 end.
     6147                          end.
     6148   
     6149                     if not can-find(partinsu where partinsu.cd-modalidade  = cd-modalidade-aux    
     6150                                                and partinsu.cd-plano       = cd-plano-aux         
     6151                                                and partinsu.cd-tipo-plano  = cd-tipo-plano-aux    
     6152                                                and partinsu.cd-modulo      = import-guia-movto.cd-modulo
     6153                                                AND partinsu.cd-tipo-insumo = cd-tipo-insumo-aux
     6154                                                and partinsu.cd-insumo      = int(import-guia-movto.cod-movto-guia))
     6155                     then do:
     6156                            if not can-find(partinsu where partinsu.cd-modalidade  = cd-modalidade-aux    
     6157                                                       and partinsu.cd-plano       = cd-plano-aux         
     6158                                                       and partinsu.cd-tipo-plano  = cd-tipo-plano-aux   
     6159                                                       and partinsu.cd-modulo      = import-guia-movto.cd-modulo
     6160                                                       AND partinsu.cd-tipo-insumo = cd-tipo-insumo-aux
     6161                                                       and partinsu.cd-insumo      = 0)
     6162                     then do:
     6163                            if not can-find(first plamodpr where plamodpr.cd-modalidade          = cd-modalidade-aux
     6164                                                             and plamodpr.cd-plano               = cd-plano-aux
     6165                                                             and plamodpr.cd-tipo-plano          = cd-tipo-plano-aux
     6166                                                             and plamodpr.in-procedimento-insumo = "I"
     6167                                                             and plamodpr.cd-modulo              = import-guia-movto.cd-modulo)
     6168                            then do:
     6169                                   IF cd-modalidade-aux <> ?
     6170                                   THEN char-aux1 = string(cd-modalidade-aux).
     6171                                   else char-aux1 = "nulo".
     6172                                   IF cd-plano-aux <> ?
     6173                                   THEN char-aux2 = string(cd-plano-aux).
     6174                                   ELSE char-aux2 = "nulo".
     6175                                   IF cd-tipo-plano-aux <> ?
     6176                                   THEN char-aux3 = string(cd-tipo-plano-aux).
     6177                                   ELSE char-aux3 = "nulo".
     6178                                   IF import-guia-movto.cd-modulo <> ?
     6179                                   THEN char-aux4 = string(import-guia-movto.cd-modulo).
     6180                                   ELSE char-aux4 = "nulo".
     6181                                   IF cd-tipo-insumo-aux <> ?
     6182                                   THEN char-aux5 = STRING(cd-tipo-insumo-aux).
     6183                                   ELSE char-aux5 = "nulo".
     6184                                   IF import-guia-movto.cod-movto-guia <> ?
     6185                                   THEN char-aux6 = STRING(import-guia-movto.cod-movto-guia).
     6186                                   ELSE char-aux6 = "nulo".
     6187                                   run grava-erro(input import-guia.num-seqcial-control,
     6188                                                  input "import-guia-movto",
     6189                                                  input "Tabela padrao de moedas e carencias (partinsu ou plamodpr) nao encontrada para a estrutura neste modulo." +
     6190                                                        " Tp.Guia(import-guia-movto.ind-tip-guia): "      + string(import-guia-movto.ind-tip-guia) + 
     6191                                                        " Nro.Seq.Guia(import-guia-movto.val-seq-guia): " + string(import-guia-movto.val-seq-guia) + 
     6192                                                        " Mod.: "     + char-aux1 + 
     6193                                                        " Plano: "    + char-aux2      + 
     6194                                                        " Tp.Plano: " + char-aux3 +
     6195                                                        " Modulo: "   + char-aux4 +
     6196                                                        " Tp.Insu: "  + char-aux5 +
     6197                                                        " Insumo: "   + char-aux6
     6198                                                        ,
     6199                                                  input today,
     6200                                                  input "Verifique PARTINSU e PLAMODPR").
     6201                          
     6202                                   assign lg-erro-par = yes.
     6203                                 end.
     6204                          end.
     6205                   end.
     6206       end.
     6207            END.
     6208   
     6209       /* -------------- QUANTIDADE SOLICITADA ---------------------------- */
     6210       if import-guia-movto.qtd-solicitad = ?
     6211       or import-guia-movto.qtd-solicitad = 0
     6212       then do:
     6213              run grava-erro(input import-guia.num-seqcial-control,
     6214                             input "import-guia-movto",
     6215                             input "Quantidade solicitada do movimento nao informada. " +
     6216                                   " Tp.Guia(import-guia-movto.ind-tip-guia): "      + string(import-guia-movto.ind-tip-guia) + 
     6217                                   " Nro.Seq.Guia(import-guia-movto.val-seq-guia): " + string(import-guia-movto.val-seq-guia),
     6218                             input today,
     6219                             input "Informe a quantidade solicitada do movimento").
     6220              
     6221              assign lg-erro-par = yes.
     6222            end.
     6223   
     6224       /* ------------------------------------------------------------- */
     6225       if import-guia-movto.num-livre-2 > 0 /* Classe de erro */
     6226       then do:
     6227              if not can-find(claserro where claserro.cd-classe-erro = import-guia-movto.num-livre-2)
     6228              then do:
     6229                     run grava-erro(input import-guia.num-seqcial-control,
     6230                                    input "import-guia-movto",
     6231                                    input "Classe de erro nao cadastrada (import-guia-movto.num-livre-2): " + string(import-guia-movto.num-livre-2) +
     6232                                          " Tp.Guia(import-guia-movto.ind-tip-guia): "      + string(import-guia-movto.ind-tip-guia) + 
     6233                                          " Nro.Seq.Guia(import-guia-movto.val-seq-guia): " + string(import-guia-movto.val-seq-guia),
     6234                                    input today,
     6235                                    input "Informe um codigo de classe de erro valido.").
     6236              
     6237                     assign lg-erro-par = yes.
     6238                   end.
     6239            end.
     6240   
     6241       /* ------------------------------------------------------------- */
     6242       if import-guia-movto.num-livre-1 > 0 /* Codigo da glosa */
     6243       then do:
     6244              if not can-find(first codiglos 
     6245                              where codiglos.cd-classe-erro = import-guia-movto.num-livre-2
     6246                                and codiglos.cd-cod-glo     = import-guia-movto.num-livre-1)
     6247              then do:
     6248                     run grava-erro(input import-guia.num-seqcial-control,
     6249                                    input "import-guia-movto",
     6250                                    input "Glosa nao cadastrada: " + string(import-guia-movto.num-livre-1) +
     6251                                          " Tp.Guia(import-guia-movto.ind-tip-guia): "      + string(import-guia-movto.ind-tip-guia) + 
     6252                                          " Nro.Seq.Guia(import-guia-movto.val-seq-guia): " + string(import-guia-movto.val-seq-guia) +
     6253                                          " Classe erro(import-guia-movto.num-livre-2): " + string(import-guia-movto.num-livre-2) + 
     6254                                          " Glosa(import-guia-movto.num-livre-1): " + string(import-guia-movto.num-livre-1),
     6255                                    input today,
     6256                                    input "Informe um codigo de glosa vinculado a classe de erro informada.").
     6257              
     6258                     assign lg-erro-par = yes.
     6259                   end.
     6260            end.
     6261   
     6262       /* ------------- VALIDACAO GLOSA COBRANCA ---------------------
     6263            import-guia-movto.num-livre-3:
     6264            0  COBRANCA CONFORME CONTRATO
     6265            1  COBRANCA POR CUSTO OPERACIONAL
     6266            2  COBRANCA POR USO INDEVIDO
     6267            3  DESCONSIDERAR COBRANCA
     6268            4  COBERTURA POR INTERCAMBIO
     6269            5  SUSPENSO POR VALIDACAO POSTERIOR
     6270            6  COBRAR SOMENTE PARTICIPACAO
     6271            7  DESCONSIDERAR COBRANCA PARTICIPACAO
     6272            8  PARTICIPACAO - INTERCAMBIO
     6273            99 COBRANCA CONFORME MOVIMENTO
     6274       */
     6275       if  import-guia-movto.num-livre-3 <> 0
     6276       and import-guia-movto.num-livre-3 <> 1
     6277       and import-guia-movto.num-livre-3 <> 3
     6278       and import-guia-movto.num-livre-3 <> 4
     6279       then do:
     6280              run grava-erro(input import-guia.num-seqcial-control,
     6281                             input "import-guia-movto",
     6282                             input "Validacao da glosa para cobranca invalida(import-guia-movto.num-livre-3 ): " + string(import-guia-movto.num-livre-3) +
     6283                                   " Tp.Guia(import-guia-movto.ind-tip-guia): "      + string(import-guia-movto.ind-tip-guia) + 
     6284                                   " Nro.Seq.Guia(import-guia-movto.val-seq-guia): " + string(import-guia-movto.val-seq-guia),
     6285                             input today,
     6286                             input "Informe 0, 1, 3, ou 4.").
     6287              
     6288              assign lg-erro-par = yes.
     6289            end.
     6290   
     6291       /* ------------- VALIDACAO GLOSA PAGAMENTO ---------------------
     6292            import-guia-movto.num-livre-4
     6293            0  PAGAMENTO CONFORME CONTRATO
     6294            1  DESCONSIDERAR PAGAMENTO
     6295       */
     6296       if  import-guia-movto.num-livre-4 <> 0
     6297       and import-guia-movto.num-livre-4 <> 1
     6298       then do:
     6299              run grava-erro(input import-guia.num-seqcial-control,
     6300                             input "import-guia-movto",
     6301                             input "Validacao da glosa para pagamento invalida (import-guia-movto.num-livre-4): "    + string(import-guia-movto.num-livre-4) +
     6302                                   " Tp.Guia(import-guia-movto.ind-tip-guia): "      + string(import-guia-movto.ind-tip-guia) + 
     6303                                   " Nro.Seq.Guia(import-guia-movto.val-seq-guia): " + string(import-guia-movto.val-seq-guia),
     6304                             input today,
     6305                             input "Informe 0 ou 1").
     6306   
     6307              assign lg-erro-par = yes.
     6308            end.
     6309   
     6310       /* ------------- VALIDACAO GLOSA ------------------------------- */
     6311       if  import-guia-movto.cd-validacao <> 0 
     6312       and import-guia-movto.cd-validacao <> 1
     6313       and import-guia-movto.cd-validacao <> 3
     6314       then do:
     6315              run grava-erro(input import-guia.num-seqcial-control,
     6316                             input "import-guia-movto",
     6317                             input "Indicador de validacao da glosa invalido(import-guia-movto.cd-validacao): " + string(import-guia-movto.cd-validacao) +
     6318                                   " Tp.Guia(import-guia-movto.ind-tip-guia): "      + string(import-guia-movto.ind-tip-guia) + 
     6319                                   " Nro.Seq.Guia(import-guia-movto.val-seq-guia): " + string(import-guia-movto.val-seq-guia),
     6320                             input today,
     6321                             input "Informe 0, 1 ou 3").
     6322              
     6323              assign lg-erro-par = yes.
     6324            end.
     6325   
     6326   end procedure.
     6327   
     6328   /* ----------------------------------------------------------------- */
     6329   procedure atualiza-import-guia:
     6330   
     6331       def input parameter ind-status-par          as char no-undo.
     6332       def input parameter cd-unidade-par          as int  no-undo.
     6333       def input parameter aa-guia-atendimento-par as int  no-undo.
     6334       def input parameter nr-guia-atendimento-par as int  no-undo.
     6335   
     6336       def buffer b-import-guia for import-guia.
     6337   
     6338       find b-import-guia where recid(b-import-guia) = recid(import-guia)
     6339                                exclusive-lock no-error.
     6340   
     6341       if avail b-import-guia
     6342       then do:
     6343              assign /*b-import-guia.cd-unimed           = cd-unidade-par         
     6344                     b-import-guia.aa-guia-atendimento = aa-guia-atendimento-par
     6345                     b-import-guia.nr-guia-atendimento = nr-guia-atendimento-par*/
     6346                     b-import-guia.ind-sit-import      = ind-status-par.
     6347            end.
     6348   
     6349       find control-migrac where control-migrac.num-seqcial = import-guia.num-seqcial-control
     6350                                 exclusive-lock no-error.
     6351   
     6352       if avail control-migrac
     6353       then assign control-migrac.ind-sit-import   = ind-status-par
     6354                   control-migrac.dat-integr       = today
     6355                   control-migrac.dt-processamento = today.
     6356   
     6357       validate b-import-guia.
     6358       release b-import-guia.
     6359   
     6360       validate control-migrac.
     6361       release control-migrac.
     6362   
     6363   end procedure.
     6364   
     6365   /* ----------------------------------------------------------------- */
     6366   procedure gera-rel-erro:
     6367       
     6368            6369   *** Encrypted Source ***
     6370   *** Encrypted Source ***
     6371   *** Encrypted Source ***
     6372   *** Encrypted Source ***
     6373   *** Encrypted Source ***
     6374   *** Encrypted Source ***
     6375   *** Encrypted Source ***
     6376   *** Encrypted Source ***
     6377   *** Encrypted Source ***
     6378   *** Encrypted Source ***
     6379   *** Encrypted Source ***
     6380   *** Encrypted Source ***
     6381   *** Encrypted Source ***
     6382   *** Encrypted Source ***
     6383   *** Encrypted Source ***
     6384   *** Encrypted Source ***
     6385   *** Encrypted Source ***
     6386   *** Encrypted Source ***
     6387   *** Encrypted Source ***
     6388   *** Encrypted Source ***
     6389   *** Encrypted Source ***
     6390   *** Encrypted Source ***
     6391   *** Encrypted Source ***
     6392   *** Encrypted Source ***
     6393   *** Encrypted Source ***
     6394   *** Encrypted Source ***
     6395   *** Encrypted Source ***
     6396   *** Encrypted Source ***
     6397   *** Encrypted Source ***
     6398   *** Encrypted Source ***
     6399   *** Encrypted Source ***
     6400   *** Encrypted Source ***
     6401   *** Encrypted Source ***
     6402   *** Encrypted Source ***
     6403   *** Encrypted Source ***
     6404   *** Encrypted Source ***
     6405   *** Encrypted Source ***
     6406   *** Encrypted Source ***
     6407   *** Encrypted Source ***
     6408   *** Encrypted Source ***
     6409   *** Encrypted Source ***
     6410   *** Encrypted Source ***
     6411   *** Encrypted Source ***
     6412   *** Encrypted Source ***
     6413   *** Encrypted Source ***
     6414   *** Encrypted Source ***
     6415   *** Encrypted Source ***
     6416   *** Encrypted Source ***
     6417   *** Encrypted Source ***
     6418   *** Encrypted Source ***
     6419   *** Encrypted Source ***
     6420   *** Encrypted Source ***
     6421   *** Encrypted Source ***
     6422   *** Encrypted Source ***
     6423   *** Encrypted Source ***
     6424   *** Encrypted Source ***
     6425   *** Encrypted Source ***
     6426   *** Encrypted Source ***
     6427   *** Encrypted Source ***
     6428   *** Encrypted Source ***
     6429   *** Encrypted Source ***
     6430   *** Encrypted Source ***
     6431   *** Encrypted Source ***
     6432   *** Encrypted Source ***
     6433   *** Encrypted Source ***
     6434   *** Encrypted Source ***
     6435   *** Encrypted Source ***
     6436   *** Encrypted Source ***
     6437   *** Encrypted Source ***
     6438   *** Encrypted Source ***
     6439   *** Encrypted Source ***
     6440   *** Encrypted Source ***
     6441   *** Encrypted Source ***
     6442   *** Encrypted Source ***
     6443   *** Encrypted Source ***
     6444   *** Encrypted Source ***
     6445   *** Encrypted Source ***
     6446    
     6447   
     6448       view frame f-cabecalho.
     6449       view frame f-rodape.
     6450   
     6451       for each tmp-erro no-lock:
     6452           disp tmp-erro.num-seqcial-control
     6453                tmp-erro.nom-tab-orig-erro  
     6454                tmp-erro.des-erro           
     6455                with frame f-rel.
     6456           down with frame f-rel.
     6457       end.
     6458   
     6459            6460   *** Encrypted Source ***
     6461   *** Encrypted Source ***
     6462   *** Encrypted Source ***
     6463   *** Encrypted Source ***
     6464   *** Encrypted Source ***
     6465   *** Encrypted Source ***
     6466   *** Encrypted Source ***
     6467   *** Encrypted Source ***
     6468   *** Encrypted Source ***
     6469   *** Encrypted Source ***
     6470   *** Encrypted Source ***
     6471   *** Encrypted Source ***
     6472   *** Encrypted Source ***
     6473   *** Encrypted Source ***
     6474   *** Encrypted Source ***
     6475   *** Encrypted Source ***
     6476   *** Encrypted Source ***
     6477   *** Encrypted Source ***
     6478   *** Encrypted Source ***
     6479   *** Encrypted Source ***
     6480   *** Encrypted Source ***
     6481   *** Encrypted Source ***
     6482   *** Encrypted Source ***
     6483   *** Encrypted Source ***
     6484   *** Encrypted Source ***
     6485   *** Encrypted Source ***
     6486   *** Encrypted Source ***
     6487   *** Encrypted Source ***
     6488   *** Encrypted Source ***
     6489   *** Encrypted Source ***
     6490   *** Encrypted Source ***
     6491   *** Encrypted Source ***
     6492   *** Encrypted Source ***
     6493   *** Encrypted Source ***
     6494   *** Encrypted Source ***
     6495   *** Encrypted Source ***
     6496   *** Encrypted Source ***
     6497   *** Encrypted Source ***
     6498   *** Encrypted Source ***
     6499   *** Encrypted Source ***
     6500   *** Encrypted Source ***
     6501   *** Encrypted Source ***
     6502   *** Encrypted Source ***
     6503   *** Encrypted Source ***
     6504   *** Encrypted Source ***
     6505   *** Encrypted Source ***
     6506   *** Encrypted Source ***
     6507   *** Encrypted Source ***
     6508   *** Encrypted Source ***
     6509   *** Encrypted Source ***
     6510   *** Encrypted Source ***
     6511   *** Encrypted Source ***
     6512   *** Encrypted Source ***
     6513   *** Encrypted Source ***
     6514   *** Encrypted Source ***
     6515   *** Encrypted Source ***
     6516   *** Encrypted Source ***
     6517   *** Encrypted Source ***
     6518   *** Encrypted Source ***
     6519   *** Encrypted Source ***
     6520   *** Encrypted Source ***
     6521   *** Encrypted Source ***
     6522   *** Encrypted Source ***
     6523   *** Encrypted Source ***
     6524   *** Encrypted Source ***
     6525   *** Encrypted Source ***
     6526   *** Encrypted Source ***
     6527   *** Encrypted Source ***
     6528   *** Encrypted Source ***
     6529   *** Encrypted Source ***
     6530   *** Encrypted Source ***
     6531   *** Encrypted Source ***
     6532   *** Encrypted Source ***
     6533   *** Encrypted Source ***
     6534   *** Encrypted Source ***
     6535   *** Encrypted Source ***
     6536   *** Encrypted Source ***
     6537   *** Encrypted Source ***
     6538   *** Encrypted Source ***
     6539   *** Encrypted Source ***
     6540   *** Encrypted Source ***
     6541   *** Encrypted Source ***
     6542   *** Encrypted Source ***
     6543   *** Encrypted Source ***
     6544   *** Encrypted Source ***
     6545   *** Encrypted Source ***
     6546   *** Encrypted Source ***
     6547   *** Encrypted Source ***
     6548   *** Encrypted Source ***
     6549   *** Encrypted Source ***
     6550   *** Encrypted Source ***
     6551   *** Encrypted Source ***
     6552   *** Encrypted Source ***
     6553   *** Encrypted Source ***
     6554   *** Encrypted Source ***
     6555   *** Encrypted Source ***
     6556   *** Encrypted Source ***
     6557   *** Encrypted Source ***
     6558   *** Encrypted Source ***
     6559   *** Encrypted Source ***
     6560   *** Encrypted Source ***
     6561   *** Encrypted Source ***
     6562   *** Encrypted Source ***
     6563   *** Encrypted Source ***
     6564   *** Encrypted Source ***
     6565   *** Encrypted Source ***
     6566   *** Encrypted Source ***
     6567   *** Encrypted Source ***
     6568   *** Encrypted Source ***
     6569   *** Encrypted Source ***
     6570   *** Encrypted Source ***
     6571   *** Encrypted Source ***
     6572   *** Encrypted Source ***
     6573   *** Encrypted Source ***
     6574   *** Encrypted Source ***
     6575   *** Encrypted Source ***
     6576   *** Encrypted Source ***
     6577   *** Encrypted Source ***
     6578   *** Encrypted Source ***
     6579   *** Encrypted Source ***
     6580   *** Encrypted Source ***
     6581   *** Encrypted Source ***
     6582   *** Encrypted Source ***
     6583   *** Encrypted Source ***
     6584   *** Encrypted Source ***
     6585   *** Encrypted Source ***
     6586   *** Encrypted Source ***
     6587   *** Encrypted Source ***
     6588   *** Encrypted Source ***
     6589   *** Encrypted Source ***
     6590   *** Encrypted Source ***
     6591   *** Encrypted Source ***
     6592   *** Encrypted Source ***
     6593   *** Encrypted Source ***
     6594   *** Encrypted Source ***
     6595   *** Encrypted Source ***
     6596   *** Encrypted Source ***
     6597   *** Encrypted Source ***
     6598   *** Encrypted Source ***
     6599   *** Encrypted Source ***
     6600   *** Encrypted Source ***
     6601   *** Encrypted Source ***
     6602   *** Encrypted Source ***
     6603   *** Encrypted Source ***
     6604   *** Encrypted Source ***
     6605   *** Encrypted Source ***
     6606   *** Encrypted Source ***
     6607   *** Encrypted Source ***
     6608   *** Encrypted Source ***
     6609   *** Encrypted Source ***
     6610   *** Encrypted Source ***
     6611   *** Encrypted Source ***
     6612   *** Encrypted Source ***
     6613   *** Encrypted Source ***
     6614   *** Encrypted Source ***
     6615   *** Encrypted Source ***
     6616   *** Encrypted Source ***
     6617   *** Encrypted Source ***
     6618    
     6619       hide message no-pause.
     6620   
     6621   end procedure.
     6622   
     6623   
     6624   procedure filtra-paproins:
     6625       define input  parameter cd-mod-par      like moviproc.cd-modalidade        no-undo.
     6626       define input  parameter nr-ter-par      like moviproc.nr-ter-adesao        no-undo.
     6627       define input  parameter cd-uni-cart-par like moviproc.cd-unidade-carteira  no-undo.
     6628       define input  parameter dt-realiza-par  like moviproc.dt-realiza           no-undo.
     6629       define input  parameter cd-pacote-par   like moviproc.cd-pacote            no-undo.
     6630       define input  parameter cd-uni-pres-par like moviproc.cd-unidade-prestador no-undo.
     6631       define input  parameter cd-prest-par    like moviproc.cd-prestador         no-undo.
     6632       
     6633   
     6634       if paramecp.cd-unimed = cd-uni-cart-par
     6635       then do:
     6636               find first propost where propost.cd-modalidade = cd-mod-par
     6637                                    and propost.nr-ter-adesao = nr-ter-par
     6638                                  no-lock no-error.
     6639   
     6640               if avail propost
     6641               then do:
     6642                       assign cd-modalidade-prop-aux = propost.cd-modalidade
     6643                              cd-plano-prop-aux      = propost.cd-plano
     6644                              cd-tipo-plano-prop-aux = propost.cd-tipo-plano.
     6645                    end.
     6646            end.
     6647       else do:
     6648              find first unicamco where unicamco.cd-unidade = cd-uni-cart-par
     6649                                    and unicamco.dt-limite >= dt-realiza-par
     6650                                    no-lock no-error.
     6651              if avail unicamco
     6652              then do:
     6653                     assign cd-modalidade-prop-aux = unicamco.cd-modalidade
     6654                            cd-plano-prop-aux      = unicamco.cd-plano
     6655                            cd-tipo-plano-prop-aux = unicamco.cd-tipo-plano.
     6656                   end.
     6657            end.
     6658   
     6659       find first paproins where paproins.cd-pacote = cd-pacote-par
     6660                       and paproins.cd-unidade      = cd-uni-pres-par
     6661                       and paproins.cd-prestador    = cd-prest-par
     6662                       and paproins.cd-modalidade   = cd-modalidade-prop-aux
     6663                       and paproins.cd-plano        = cd-plano-prop-aux
     6664                       and paproins.cd-tipo-plano   = cd-tipo-plano-prop-aux
     6665                       and paproins.dt-inicio-vigencia <= dt-realiza-par 
     6666                       and paproins.dt-limite /* dt-fim-vigencia*/     >= dt-realiza-par  
     6667                                                       no-lock no-error.
     6668       if not avail paproins
     6669       then find first paproins where paproins.cd-pacote     = cd-pacote-par
     6670                                  and paproins.cd-unidade    = cd-uni-pres-par
     6671                                  and paproins.cd-prestador  = cd-prest-par
     6672                                  and paproins.cd-modalidade = cd-modalidade-prop-aux
     6673                                  and paproins.cd-plano      = cd-plano-prop-aux
     6674                                  and paproins.cd-tipo-plano = 0
     6675                                  and paproins.dt-inicio-vigencia <= dt-realiza-par 
     6676                                  and paproins.dt-limite /* dt-fim-vigencia*/     >= dt-realiza-par  
     6677                                                            no-lock no-error.
     6678       if not  avail paproins 
     6679       then find first paproins where paproins.cd-pacote     = cd-pacote-par
     6680                                  and paproins.cd-unidade    = cd-uni-pres-par
     6681                                  and paproins.cd-prestador  = cd-prest-par
     6682                                  and paproins.cd-modalidade = cd-modalidade-prop-aux
     6683                                  and paproins.cd-plano      = 0
     6684                                  and paproins.cd-tipo-plano = 0
     6685                                  and paproins.dt-inicio-vigencia <= dt-realiza-par 
     6686                                  and paproins.dt-limite /* dt-fim-vigencia*/     >= dt-realiza-par  
     6687                                                            no-lock no-error.
     6688       if not avail paproins
     6689       then find first paproins where paproins.cd-pacote     = cd-pacote-par
     6690                                  and paproins.cd-unidade    = cd-uni-pres-par
     6691                                  and paproins.cd-prestador  = cd-prest-par
     6692                                  and paproins.cd-modalidade = 0
     6693                                  and paproins.cd-plano      = 0
     6694                                  and paproins.cd-tipo-plano = 0
     6695                                  and paproins.dt-inicio-vigencia <= dt-realiza-par 
     6696                                  and paproins.dt-limite /* dt-fim-vigencia*/     >= dt-realiza-par 
     6697                                                            no-lock no-error.
     6698       if not  avail paproins 
     6699       then find first paproins where paproins.cd-pacote     = cd-pacote-par
     6700                                  and paproins.cd-unidade    = cd-uni-pres-par
     6701                                  and paproins.cd-prestador  = cd-prest-par
     6702                                  and paproins.cd-modalidade = cd-modalidade-prop-aux
     6703                                  and paproins.cd-plano      = 0
     6704                                  and paproins.cd-tipo-plano = 0
     6705                                  and paproins.dt-inicio-vigencia <= dt-realiza-par 
     6706                                  and paproins.dt-limite /* dt-fim-vigencia*/     >= dt-realiza-par 
     6707                                                            no-lock no-error.
     6708   
     6709        if not  avail paproins                                                                                     
     6710        then find first paproins where paproins.cd-pacote     = cd-pacote-par                                      
     6711                                   and paproins.cd-unidade    = cd-uni-pres-par                                    
     6712                                   and paproins.cd-prestador  = 0                                                  
     6713                                   and paproins.cd-modalidade = 0                                                  
     6714                                   and paproins.cd-plano      = 0                                                  
     6715                                   and paproins.cd-tipo-plano = 0                                                  
     6716                                   and paproins.dt-inicio-vigencia <= dt-realiza-par                               
     6717                                   and paproins.dt-limite /* dt-fim-vigencia*/     >= dt-realiza-par  /* bueno*/             
     6718                                                            no-lock no-error.    
     6719   
     6720       if not avail paproins
     6721       then find first paproins where paproins.cd-pacote     = cd-pacote-par
     6722                                  and paproins.cd-unidade    = 0
     6723                                  and paproins.cd-prestador  = 0
     6724                                  and paproins.cd-modalidade = 0
     6725                                  and paproins.cd-plano      = 0
     6726                                  and paproins.cd-tipo-plano = 0
     6727                                  and paproins.dt-inicio-vigencia <= dt-realiza-par 
     6728                                  and paproins.dt-limite /* dt-fim-vigencia*/     >= dt-realiza-par 
     6729                                                            no-lock no-error.
     6730       if avail paproins
     6731       then assign r-paproins = rowid(paproins).
     6732       else assign r-paproins = ?.
     6733   end procedure.
     6734   
     6735   PROCEDURE escrever-log:
     6736       DEF INPUT PARAM ds-par AS CHAR NO-UNDO.
     6737   END PROCEDURE.
     6738   
